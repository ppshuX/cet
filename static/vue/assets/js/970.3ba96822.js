"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[970],{2970:function(a,e,s){s.r(e),s.d(e,{default:function(){return sa}});var t=s(6768),l=s(4232),n=s(5130);const r={class:"user-center-wrapper"},o={class:"user-center-container"},i={class:"container py-5"},c={key:0,class:"text-center py-5"},d={key:1,class:"row"},u={class:"col-md-4 mb-4"},m={class:"card shadow-sm"},v={class:"card-body text-center p-4"},b={class:"avatar-container mb-3"},k=["src"],p={class:"username-display mb-1"},L={class:"email-display mb-3"},g={class:"mb-3"},h={key:0,class:"badge bg-danger"},f={key:1,class:"badge bg-primary"},y={class:"text-muted"},w={class:"col-md-8"},_={class:"card shadow-sm mb-4"},x={class:"card-body"},C={class:"mb-3"},I=["disabled"],E={class:"mb-3"},F=["disabled"],W=["disabled"],A={key:0,class:"spinner-border spinner-border-sm me-2"},U={class:"card shadow-sm"},X={class:"card-body"},B={class:"row text-center"},D={class:"col-4"},K={class:"stat-box"},N={class:"text-primary"},R={class:"col-4"},$={class:"stat-box"},V={class:"text-success"},z={class:"col-4"},J={class:"stat-box"},S={class:"text-warning"};function j(a,e,s,j,M,Q){const T=(0,t.g2)("NavBar");return(0,t.uX)(),(0,t.CE)("div",r,[(0,t.bF)(T),(0,t.Lk)("div",o,[(0,t.Lk)("button",{class:"back-btn",onClick:e[0]||(e[0]=(...a)=>j.goBack&&j.goBack(...a)),title:"返回首页"}," 🏠 "),(0,t.Lk)("div",i,[e[16]||(e[16]=(0,t.Lk)("h2",{class:"mb-4"},"个人中心",-1)),j.loading?((0,t.uX)(),(0,t.CE)("div",c,[...e[7]||(e[7]=[(0,t.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,t.Lk)("span",{class:"visually-hidden"},"加载中...")],-1)])])):((0,t.uX)(),(0,t.CE)("div",d,[(0,t.Lk)("div",u,[(0,t.Lk)("div",m,[(0,t.Lk)("div",v,[(0,t.Lk)("div",b,[(0,t.Lk)("img",{src:j.userAvatar,alt:"头像",class:"rounded-circle",width:"120",height:"120"},null,8,k),(0,t.Lk)("button",{class:"btn btn-sm btn-light avatar-upload-btn",onClick:e[1]||(e[1]=(...a)=>j.triggerFileInput&&j.triggerFileInput(...a))},[...e[8]||(e[8]=[(0,t.Lk)("i",{class:"bi bi-camera"},null,-1)])]),(0,t.Lk)("input",{ref:"avatarInput",type:"file",accept:"image/*",style:{display:"none"},onChange:e[2]||(e[2]=(...a)=>j.handleAvatarChange&&j.handleAvatarChange(...a))},null,544)]),(0,t.Lk)("h4",p,(0,l.v_)(j.username),1),(0,t.Lk)("p",L,(0,l.v_)(j.email||"未设置邮箱"),1),(0,t.Lk)("div",g,[j.isAdmin?((0,t.uX)(),(0,t.CE)("span",h,"管理员")):((0,t.uX)(),(0,t.CE)("span",f,"普通用户"))]),(0,t.Lk)("small",y," 注册时间："+(0,l.v_)(j.formatDate(j.userInfo?.date_joined)),1)])]),(0,t.Lk)("button",{class:"btn btn-outline-danger w-100 mt-3",onClick:e[3]||(e[3]=(...a)=>j.handleLogout&&j.handleLogout(...a))}," 退出登录 ")]),(0,t.Lk)("div",w,[(0,t.Lk)("div",_,[e[11]||(e[11]=(0,t.Lk)("div",{class:"card-header bg-white"},[(0,t.Lk)("h5",{class:"mb-0"},"基本信息")],-1)),(0,t.Lk)("div",x,[(0,t.Lk)("form",{onSubmit:e[6]||(e[6]=(0,n.D$)((...a)=>j.handleUpdateInfo&&j.handleUpdateInfo(...a),["prevent"]))},[(0,t.Lk)("div",C,[e[9]||(e[9]=(0,t.Lk)("label",{class:"form-label"},"用户名",-1)),(0,t.bo)((0,t.Lk)("input",{type:"text",class:"form-control","onUpdate:modelValue":e[4]||(e[4]=a=>j.editForm.username=a),disabled:j.updating},null,8,I),[[n.Jo,j.editForm.username]])]),(0,t.Lk)("div",E,[e[10]||(e[10]=(0,t.Lk)("label",{class:"form-label"},"邮箱",-1)),(0,t.bo)((0,t.Lk)("input",{type:"email",class:"form-control","onUpdate:modelValue":e[5]||(e[5]=a=>j.editForm.email=a),disabled:j.updating},null,8,F),[[n.Jo,j.editForm.email]])]),(0,t.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:j.updating},[j.updating?((0,t.uX)(),(0,t.CE)("span",A)):(0,t.Q3)("",!0),(0,t.eW)(" "+(0,l.v_)(j.updating?"保存中...":"保存修改"),1)],8,W)],32)])]),(0,t.Lk)("div",U,[e[15]||(e[15]=(0,t.Lk)("div",{class:"card-header bg-white"},[(0,t.Lk)("h5",{class:"mb-0"},"我的统计")],-1)),(0,t.Lk)("div",X,[(0,t.Lk)("div",B,[(0,t.Lk)("div",D,[(0,t.Lk)("div",K,[(0,t.Lk)("h3",N,(0,l.v_)(j.stats.comments_count),1),e[12]||(e[12]=(0,t.Lk)("p",{class:"text-muted mb-0"},"评论数",-1))])]),(0,t.Lk)("div",R,[(0,t.Lk)("div",$,[(0,t.Lk)("h3",V,(0,l.v_)(j.stats.likes_count||0),1),e[13]||(e[13]=(0,t.Lk)("p",{class:"text-muted mb-0"},"获赞数",-1))])]),(0,t.Lk)("div",z,[(0,t.Lk)("div",J,[(0,t.Lk)("h3",S,(0,l.v_)(j.stats.views_count||0),1),e[14]||(e[14]=(0,t.Lk)("p",{class:"text-muted mb-0"},"浏览数",-1))])])])])])])]))])])])}s(4114);var M=s(144),Q=s(8512),T=s(1516),q=s(7277);const G=(a,e)=>q.A.patch(`/users/${a}/`,e),H=G,O=(a,e)=>q.A.post(`/users/${a}/upload_avatar/`,e,{headers:{"Content-Type":"multipart/form-data"}}),P=a=>q.A.get(`/users/${a}/stats/`);var Y=s(5824),Z={name:"UserCenterView",components:{NavBar:Y.A},setup(){const a=(0,Q.rd)(),e=(0,T.k)(),s=(0,M.KR)(!1),l=(0,M.KR)(!1),n=(0,M.KR)({comments_count:0,likes_count:0,views_count:0}),r=(0,M.KR)(null),o=(0,M.KR)({username:"",email:""}),i=(0,t.EW)(()=>e.userInfo),c=(0,t.EW)(()=>e.username),d=(0,t.EW)(()=>i.value?.email),u=(0,t.EW)(()=>e.isAdmin),m=(0,t.EW)(()=>e.avatar),v=a=>{if(!a)return"未知";const e=new Date(a);return e.toLocaleDateString("zh-CN")},b=async()=>{if(i.value?.id)try{const a=await P(i.value.id);n.value=a}catch(a){console.error("加载统计失败:",a)}},k=()=>{o.value={username:i.value?.username||"",email:i.value?.email||""}},p=async()=>{l.value=!0;try{await H(i.value.id,o.value),await e.fetchUserInfo(),alert("更新成功！")}catch(a){console.error("更新失败:",a),alert("更新失败，请稍后重试")}finally{l.value=!1}},L=()=>{r.value?.click()},g=async a=>{const s=a.target.files?.[0];if(s)if(s.type.startsWith("image/"))if(s.size>5242880)alert("图片大小不能超过5MB");else try{const a=new FormData;a.append("avatar",s),await O(i.value.id,a),await e.fetchUserInfo(),alert("头像上传成功！")}catch(t){console.error("头像上传失败:",t),alert("头像上传失败，请稍后重试")}else alert("请选择图片文件")},h=()=>{a.push("/")},f=async()=>{if(confirm("确定要退出登录吗？"))try{await e.logout(),a.push("/login")}catch(s){console.error("退出失败:",s)}};return(0,t.sV)(async()=>{if(e.isLoggedIn){s.value=!0;try{await b(),k()}catch(t){console.error("加载失败:",t)}finally{s.value=!1}}else a.push("/login")}),{loading:s,updating:l,stats:n,avatarInput:r,editForm:o,userInfo:i,username:c,email:d,isAdmin:u,userAvatar:m,formatDate:v,goBack:h,handleUpdateInfo:p,triggerFileInput:L,handleAvatarChange:g,handleLogout:f}}},aa=s(1241);const ea=(0,aa.A)(Z,[["render",j],["__scopeId","data-v-c5f27610"]]);var sa=ea},5824:function(a,e,s){s.d(e,{A:function(){return _}});var t=s(6768),l=s(4232),n=s(5130);const r={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},o={class:"container-fluid"},i={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},c={class:"navbar-nav me-auto"},d={class:"nav-item"},u={class:"nav-item"},m={class:"d-flex align-items-center"},v={key:0,class:"dropdown dropdown-end"},b={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},k=["src"],p={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function L(a,e,s,L,g,h){const f=(0,t.g2)("router-link");return(0,t.uX)(),(0,t.CE)("nav",r,[(0,t.Lk)("div",o,[(0,t.bF)(f,{to:"/",class:"navbar-brand"},{default:(0,t.k6)(()=>[...e[1]||(e[1]=[(0,t.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),e[9]||(e[9]=(0,t.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,t.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,t.Lk)("div",i,[(0,t.Lk)("ul",c,[(0,t.Lk)("li",d,[(0,t.bF)(f,{to:"/",class:"nav-link"},{default:(0,t.k6)(()=>[...e[2]||(e[2]=[(0,t.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,t.eW)(" 旅行列表 ",-1)])]),_:1})]),(0,t.Lk)("li",u,[(0,t.bF)(f,{to:"/my-trips",class:"nav-link"},{default:(0,t.k6)(()=>[...e[3]||(e[3]=[(0,t.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,t.eW)(" 我的旅行 ",-1)])]),_:1})])]),(0,t.Lk)("div",m,[L.isLoggedIn?((0,t.uX)(),(0,t.CE)("div",v,[(0,t.Lk)("a",b,[(0,t.Lk)("img",{src:L.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,k),(0,t.Lk)("span",null,(0,l.v_)(L.username),1)]),(0,t.Lk)("ul",p,[(0,t.Lk)("li",null,[(0,t.bF)(f,{to:"/user/center",class:"dropdown-item"},{default:(0,t.k6)(()=>[...e[4]||(e[4]=[(0,t.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,t.eW)("个人中心 ",-1)])]),_:1})]),e[6]||(e[6]=(0,t.Lk)("li",null,[(0,t.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,t.Lk)("li",null,[(0,t.Lk)("a",{href:"#",class:"dropdown-item",onClick:e[0]||(e[0]=(0,n.D$)((...a)=>L.handleLogout&&L.handleLogout(...a),["prevent"]))},[...e[5]||(e[5]=[(0,t.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,t.eW)("退出登录 ",-1)])])])])])):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.bF)(f,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,t.k6)(()=>[...e[7]||(e[7]=[(0,t.eW)(" 登录 ",-1)])]),_:1}),(0,t.bF)(f,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,t.k6)(()=>[...e[8]||(e[8]=[(0,t.eW)(" 注册 ",-1)])]),_:1})],64))])])])])}s(4114);var g=s(8512),h=s(1516),f={name:"NavBar",setup(){const a=(0,g.rd)(),e=(0,h.k)(),s=(0,t.EW)(()=>e.isLoggedIn),l=(0,t.EW)(()=>e.username),n=(0,t.EW)(()=>e.avatar),r=async()=>{if(confirm("确定要退出登录吗？"))try{await e.logout(),a.push("/login")}catch(s){console.error("退出失败:",s)}};return{isLoggedIn:s,username:l,avatar:n,handleLogout:r}}},y=s(1241);const w=(0,y.A)(f,[["render",L],["__scopeId","data-v-8cff0656"]]);var _=w}}]);
//# sourceMappingURL=970.3ba96822.js.map