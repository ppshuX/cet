"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[492],{5492:function(e,t,a){a.r(t),a.d(t,{default:function(){return $}});var s=a(6768),n=a(4232);const l={class:"my-trips-wrapper"},i={class:"container py-5"},r={class:"d-flex justify-content-between align-items-center mb-4"},o={key:0,class:"text-center py-5"},c={key:1,class:"row"},d={class:"trip-card"},u={class:"trip-icon"},b={class:"trip-meta"},p={class:"trip-body"},k={class:"trip-title"},v={class:"trip-desc text-muted"},m={class:"trip-info"},L={class:"text-muted"},g={class:"text-muted ms-3"},f={class:"trip-actions"},y=["onClick"],w=["onClick"],h=["onClick"],_=["onClick"],C={key:2,class:"empty-state text-center py-5"};function x(e,t,a,x,W,T){const A=(0,s.g2)("NavBar");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.bF)(A),(0,s.Lk)("div",i,[(0,s.Lk)("div",r,[t[3]||(t[3]=(0,s.Lk)("h2",null,"我的旅行计划",-1)),(0,s.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>x.createNew&&x.createNew(...e))},[...t[2]||(t[2]=[(0,s.Lk)("i",{class:"bi bi-plus-circle me-2"},null,-1),(0,s.eW)("创建新旅行 ",-1)])])]),x.loading?((0,s.uX)(),(0,s.CE)("div",o,[...t[4]||(t[4]=[(0,s.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"加载中...")],-1)])])):x.trips.length>0?((0,s.uX)(),(0,s.CE)("div",c,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(x.trips,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"col-md-6 col-lg-4 mb-4"},[(0,s.Lk)("div",d,[(0,s.Lk)("div",{class:"trip-header",style:(0,n.Tr)({background:e.theme_color||"#f0e68c"})},[(0,s.Lk)("div",u,(0,n.v_)(e.icon),1),(0,s.Lk)("div",b,[(0,s.Lk)("span",{class:(0,n.C4)(["badge","published"===e.status?"bg-success":"bg-secondary"])},(0,n.v_)("published"===e.status?"已发布":"草稿"),3),(0,s.Lk)("span",{class:(0,n.C4)(["badge ms-2","public"===e.visibility?"bg-info":"bg-warning"])},(0,n.v_)("public"===e.visibility?"公开":"私有"),3)])],4),(0,s.Lk)("div",p,[(0,s.Lk)("h5",k,(0,n.v_)(e.title),1),(0,s.Lk)("p",v,(0,n.v_)(e.description||"暂无描述"),1),(0,s.Lk)("div",m,[(0,s.Lk)("small",L,[t[5]||(t[5]=(0,s.Lk)("i",{class:"bi bi-calendar me-1"},null,-1)),(0,s.eW)((0,n.v_)(e.days_count||0)+"天 ",1)]),(0,s.Lk)("small",g,[t[6]||(t[6]=(0,s.Lk)("i",{class:"bi bi-clock me-1"},null,-1)),(0,s.eW)((0,n.v_)(x.formatDate(e.updated_at)),1)])])]),(0,s.Lk)("div",f,[(0,s.Lk)("button",{class:"btn btn-sm btn-outline-primary",onClick:t=>x.editTrip(e.slug)},[...t[7]||(t[7]=[(0,s.Lk)("i",{class:"bi bi-pencil me-1"},null,-1),(0,s.eW)("编辑 ",-1)])],8,y),(0,s.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:t=>x.viewTrip(e.slug)},[...t[8]||(t[8]=[(0,s.Lk)("i",{class:"bi bi-eye me-1"},null,-1),(0,s.eW)("预览 ",-1)])],8,w),(0,s.Lk)("button",{class:"btn btn-sm btn-success",onClick:t=>x.addToTree(e.slug)},[...t[9]||(t[9]=[(0,s.Lk)("i",{class:"bi bi-tree me-1"},null,-1),(0,s.eW)("运用到旅行树 ",-1)])],8,h),(0,s.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:t=>x.deleteTrip(e.slug)},[...t[10]||(t[10]=[(0,s.Lk)("i",{class:"bi bi-trash"},null,-1)])],8,_)])])]))),128))])):((0,s.uX)(),(0,s.CE)("div",C,[t[12]||(t[12]=(0,s.Lk)("div",{class:"empty-icon mb-3"},"📝",-1)),t[13]||(t[13]=(0,s.Lk)("h4",null,"还没有旅行计划",-1)),t[14]||(t[14]=(0,s.Lk)("p",{class:"text-muted mb-4"},"开始创建你的第一个旅行计划吧！",-1)),(0,s.Lk)("button",{class:"btn btn-primary btn-lg",onClick:t[1]||(t[1]=(...e)=>x.createNew&&x.createNew(...e))},[...t[11]||(t[11]=[(0,s.Lk)("i",{class:"bi bi-plus-circle me-2"},null,-1),(0,s.eW)("创建新旅行 ",-1)])])]))])])}a(4114);var W=a(144),T=a(8512),A=a(1516),E=a(7682),N=a(5824),F={name:"MyTripsView",components:{NavBar:N.A},setup(){const e=(0,T.rd)(),t=(0,A.k)(),a=(0,W.KR)([]),n=(0,W.KR)(!0),l=async()=>{n.value=!0;try{const e=await(0,E.To)();a.value=e.results||e||[]}catch(e){console.error("获取旅行列表失败:",e),alert("加载失败")}finally{n.value=!1}},i=()=>{e.push("/editor/new")},r=t=>{e.push(`/editor/${t}`)},o=t=>{e.push(`/trip/${t}/`)},c=async e=>{if(confirm("确定要删除这个旅行计划吗？此操作无法撤销。"))try{await(0,E.Au)(e),alert("删除成功"),await l()}catch(t){console.error("删除失败:",t),alert("删除失败")}},d=async e=>{if(confirm("确定要将此旅行计划添加到旅行树吗？它将显示在首页的旅行树上。"))try{const t=await(0,E.Ol)(e);alert(t.detail||"成功添加到旅行树！")}catch(t){console.error("添加到旅行树失败:",t),alert("添加到旅行树失败，请稍后重试")}},u=e=>{if(!e)return"暂无";const t=new Date(e);return t.toLocaleDateString("zh-CN")};return(0,s.sV)(()=>{if(!t.isLoggedIn)return alert("请先登录"),void e.push("/login");l()}),{trips:a,loading:n,createNew:i,editTrip:r,viewTrip:o,deleteTrip:c,addToTree:d,formatDate:u}}},X=a(1241);const I=(0,X.A)(F,[["render",x],["__scopeId","data-v-229e601c"]]);var $=I},5824:function(e,t,a){a.d(t,{A:function(){return _}});var s=a(6768),n=a(4232),l=a(5130);const i={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},r={class:"container-fluid"},o={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},c={class:"navbar-nav me-auto"},d={class:"nav-item"},u={class:"nav-item"},b={class:"d-flex align-items-center"},p={key:0,class:"dropdown dropdown-end"},k={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},v=["src"],m={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function L(e,t,a,L,g,f){const y=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("nav",i,[(0,s.Lk)("div",r,[(0,s.bF)(y,{to:"/",class:"navbar-brand"},{default:(0,s.k6)(()=>[...t[1]||(t[1]=[(0,s.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),t[9]||(t[9]=(0,s.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,s.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,s.Lk)("div",o,[(0,s.Lk)("ul",c,[(0,s.Lk)("li",d,[(0,s.bF)(y,{to:"/",class:"nav-link"},{default:(0,s.k6)(()=>[...t[2]||(t[2]=[(0,s.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,s.eW)(" 旅行列表 ",-1)])]),_:1})]),(0,s.Lk)("li",u,[(0,s.bF)(y,{to:"/my-trips",class:"nav-link"},{default:(0,s.k6)(()=>[...t[3]||(t[3]=[(0,s.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,s.eW)(" 我的旅行 ",-1)])]),_:1})])]),(0,s.Lk)("div",b,[L.isLoggedIn?((0,s.uX)(),(0,s.CE)("div",p,[(0,s.Lk)("a",k,[(0,s.Lk)("img",{src:L.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,v),(0,s.Lk)("span",null,(0,n.v_)(L.username),1)]),(0,s.Lk)("ul",m,[(0,s.Lk)("li",null,[(0,s.bF)(y,{to:"/user/center",class:"dropdown-item"},{default:(0,s.k6)(()=>[...t[4]||(t[4]=[(0,s.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,s.eW)("个人中心 ",-1)])]),_:1})]),t[6]||(t[6]=(0,s.Lk)("li",null,[(0,s.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,s.Lk)("li",null,[(0,s.Lk)("a",{href:"#",class:"dropdown-item",onClick:t[0]||(t[0]=(0,l.D$)((...e)=>L.handleLogout&&L.handleLogout(...e),["prevent"]))},[...t[5]||(t[5]=[(0,s.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,s.eW)("退出登录 ",-1)])])])])])):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.bF)(y,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,s.k6)(()=>[...t[7]||(t[7]=[(0,s.eW)(" 登录 ",-1)])]),_:1}),(0,s.bF)(y,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,s.k6)(()=>[...t[8]||(t[8]=[(0,s.eW)(" 注册 ",-1)])]),_:1})],64))])])])])}a(4114);var g=a(8512),f=a(1516),y={name:"NavBar",setup(){const e=(0,g.rd)(),t=(0,f.k)(),a=(0,s.EW)(()=>t.isLoggedIn),n=(0,s.EW)(()=>t.username),l=(0,s.EW)(()=>t.avatar),i=async()=>{if(confirm("确定要退出登录吗？"))try{await t.logout(),e.push("/login")}catch(a){console.error("退出失败:",a)}};return{isLoggedIn:a,username:n,avatar:l,handleLogout:i}}},w=a(1241);const h=(0,w.A)(y,[["render",L],["__scopeId","data-v-8cff0656"]]);var _=h},7682:function(e,t,a){a.d(t,{Au:function(){return o},Ol:function(){return c},Tn:function(){return i},To:function(){return n},Vt:function(){return l},q:function(){return r}});var s=a(7277);const n=e=>s.A.get("/trip-plans/my_trips/",{params:e}),l=e=>s.A.get(`/trip-plans/${e}/`),i=e=>s.A.post("/trip-plans/",e),r=(e,t)=>s.A.patch(`/trip-plans/${e}/`,t),o=e=>s.A.delete(`/trip-plans/${e}/`),c=e=>s.A.post(`/trip-plans/${e}/add_to_tree/`)}}]);
//# sourceMappingURL=492.72063008.js.map