"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[797],{432:function(a,e,s){s.d(e,{A:function(){return _}});var n=s(6768),r=s(4232),o=s(5130);const l={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},t={class:"container-fluid"},i={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},d={class:"navbar-nav me-auto"},c={class:"nav-item"},u={key:0,class:"nav-item"},b={class:"d-flex align-items-center"},p={key:0,class:"dropdown dropdown-end"},v={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},g=["src"],k={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function m(a,e,s,m,L,f){const w=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("nav",l,[(0,n.Lk)("div",t,[(0,n.bF)(w,{to:"/",class:"navbar-brand"},{default:(0,n.k6)(()=>[...e[1]||(e[1]=[(0,n.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),e[9]||(e[9]=(0,n.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,n.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,n.Lk)("div",i,[(0,n.Lk)("ul",d,[(0,n.Lk)("li",c,[(0,n.bF)(w,{to:"/",class:"nav-link"},{default:(0,n.k6)(()=>[...e[2]||(e[2]=[(0,n.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,n.eW)(" 旅行大厅 ",-1)])]),_:1})]),m.isLoggedIn?((0,n.uX)(),(0,n.CE)("li",u,[(0,n.bF)(w,{to:"/my-trips/",class:"nav-link"},{default:(0,n.k6)(()=>[...e[3]||(e[3]=[(0,n.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,n.eW)(" 我的旅行 ",-1)])]),_:1})])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",b,[m.isLoggedIn?((0,n.uX)(),(0,n.CE)("div",p,[(0,n.Lk)("a",v,[(0,n.Lk)("img",{src:m.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,g),(0,n.Lk)("span",null,(0,r.v_)(m.username),1)]),(0,n.Lk)("ul",k,[(0,n.Lk)("li",null,[(0,n.bF)(w,{to:"/user/center",class:"dropdown-item"},{default:(0,n.k6)(()=>[...e[4]||(e[4]=[(0,n.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,n.eW)("个人中心 ",-1)])]),_:1})]),e[6]||(e[6]=(0,n.Lk)("li",null,[(0,n.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,n.Lk)("li",null,[(0,n.Lk)("a",{href:"#",class:"dropdown-item",onClick:e[0]||(e[0]=(0,o.D$)((...a)=>m.handleLogout&&m.handleLogout(...a),["prevent"]))},[...e[5]||(e[5]=[(0,n.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,n.eW)("退出登录 ",-1)])])])])])):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bF)(w,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,n.k6)(()=>[...e[7]||(e[7]=[(0,n.eW)(" 登录 ",-1)])]),_:1}),(0,n.bF)(w,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,n.k6)(()=>[...e[8]||(e[8]=[(0,n.eW)(" 注册 ",-1)])]),_:1})],64))])])])])}s(4114);var L=s(8512),f=s(3459),w={name:"NavBar",setup(){const a=(0,L.rd)(),e=(0,f.k)(),s=(0,n.EW)(()=>e.isLoggedIn),r=(0,n.EW)(()=>e.username),o=(0,n.EW)(()=>e.avatar),l=async()=>{if(confirm("确定要退出登录吗？"))try{await e.logout(),a.push("/login")}catch(s){console.error("退出失败:",s)}};return{isLoggedIn:s,username:r,avatar:o,handleLogout:l}}},h=s(1241);const y=(0,h.A)(w,[["render",m],["__scopeId","data-v-a6dd4bee"]]);var _=y},946:function(a,e,s){a.exports=s.p+"assets/img/qq_logo.666e5ea1.png"},3797:function(a,e,s){s.r(e),s.d(e,{default:function(){return R}});var n=s(6768),r=s(5130),o=s(4232),l=s(946);const t={class:"auth-wrapper"},i={class:"login-container"},d={class:"container"},c={class:"row justify-content-center"},u={class:"col-md-6 col-lg-4"},b={class:"card shadow-lg"},p={class:"card-body p-5"},v={class:"mb-3"},g={class:"mb-3"},k={key:0,class:"alert alert-danger",role:"alert"},m=["disabled"],L={key:0,class:"spinner-border spinner-border-sm me-2"},f={class:"text-end mb-3"},w={class:"text-center mb-3"},h=["disabled"],y={key:0},_={key:1},x={class:"text-center"};function Q(a,e,s,Q,q,C){const E=(0,n.g2)("NavBar"),W=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("div",t,[(0,n.bF)(E),(0,n.Lk)("div",i,[(0,n.Lk)("div",d,[(0,n.Lk)("div",c,[(0,n.Lk)("div",u,[(0,n.Lk)("div",b,[(0,n.Lk)("div",p,[e[11]||(e[11]=(0,n.Lk)("h2",{class:"text-center mb-2"},"用户登录",-1)),e[12]||(e[12]=(0,n.Lk)("p",{class:"login-slogan text-center mb-4"},"Hello Roamioer!",-1)),(0,n.Lk)("form",{onSubmit:e[3]||(e[3]=(0,r.D$)((...a)=>Q.handleLogin&&Q.handleLogin(...a),["prevent"]))},[(0,n.Lk)("div",v,[e[4]||(e[4]=(0,n.Lk)("label",{for:"username",class:"form-label"},"用户名",-1)),(0,n.bo)((0,n.Lk)("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":e[0]||(e[0]=a=>Q.form.username=a),required:"",placeholder:"请输入用户名"},null,512),[[r.Jo,Q.form.username]])]),(0,n.Lk)("div",g,[e[5]||(e[5]=(0,n.Lk)("label",{for:"password",class:"form-label"},"密码",-1)),(0,n.bo)((0,n.Lk)("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":e[1]||(e[1]=a=>Q.form.password=a),required:"",placeholder:"请输入密码"},null,512),[[r.Jo,Q.form.password]])]),Q.error?((0,n.uX)(),(0,n.CE)("div",k,(0,o.v_)(Q.error),1)):(0,n.Q3)("",!0),(0,n.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mb-2",disabled:Q.loading},[Q.loading?((0,n.uX)(),(0,n.CE)("span",L)):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,o.v_)(Q.loading?"登录中...":"登录"),1)],8,m),(0,n.Lk)("div",f,[(0,n.bF)(W,{to:"/forgot-password/",class:"text-decoration-none small text-primary"},{default:(0,n.k6)(()=>[...e[6]||(e[6]=[(0,n.eW)(" 忘记密码？ ",-1)])]),_:1})]),(0,n.Lk)("div",w,[e[8]||(e[8]=(0,n.Lk)("div",{class:"divider"},[(0,n.Lk)("span",{class:"divider-text"},"或")],-1)),(0,n.Lk)("button",{type:"button",class:"btn btn-outline-secondary w-100 qq-login-btn",disabled:Q.qqLoginLoading,onClick:e[2]||(e[2]=(...a)=>Q.handleQQLogin&&Q.handleQQLogin(...a))},[e[7]||(e[7]=(0,n.Lk)("img",{src:l,alt:"QQ登录",class:"qq-login-icon",width:"20",height:"20"},null,-1)),Q.qqLoginLoading?((0,n.uX)(),(0,n.CE)("span",y,"跳转中...")):((0,n.uX)(),(0,n.CE)("span",_,"使用QQ登录"))],8,h)]),(0,n.Lk)("div",x,[e[10]||(e[10]=(0,n.Lk)("span",{class:"text-muted"},"还没有账号？",-1)),(0,n.bF)(W,{to:"/register",class:"text-decoration-none"},{default:(0,n.k6)(()=>[...e[9]||(e[9]=[(0,n.eW)("立即注册",-1)])]),_:1})])],32)])])])])])])])}s(4114);var q=s(144),C=s(8512),E=s(3459),W=s(2636),A=s(432),F={name:"LoginView",components:{NavBar:A.A},setup(){const a=(0,C.rd)(),e=(0,E.k)(),s=(0,q.KR)({username:"",password:""}),n=(0,q.KR)(!1),r=(0,q.KR)(""),o=(0,q.KR)(!1),l=async()=>{n.value=!0,r.value="";try{await e.login(s.value),a.push("/")}catch(o){if(o.response?.data){const a=o.response.data;a.username&&Array.isArray(a.username)?r.value=a.username[0]:a.password&&Array.isArray(a.password)?r.value=a.password[0]:a.non_field_errors&&Array.isArray(a.non_field_errors)?r.value=a.non_field_errors[0]:"string"===typeof a?r.value=a:a.detail?r.value=a.detail:r.value="登录失败，请检查用户名和密码"}else r.value=o.message||"登录失败，请检查用户名和密码"}finally{n.value=!1}},t=async()=>{o.value=!0;try{const a=await(0,W.jg)();a.authorize_url&&a.state?(sessionStorage.setItem("qq_oauth_state",a.state),window.location.href=a.authorize_url):(r.value="获取QQ登录链接失败，请重试",o.value=!1)}catch(a){r.value=a.response?.data?.error||"QQ登录失败，请重试",o.value=!1}};return{form:s,loading:n,error:r,qqLoginLoading:o,handleLogin:l,handleQQLogin:t}}},X=s(1241);const I=(0,X.A)(F,[["render",Q],["__scopeId","data-v-12b6a1f2"]]);var R=I}}]);
//# sourceMappingURL=797.ec3d676a.js.map