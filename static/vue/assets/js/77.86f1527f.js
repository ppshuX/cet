"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[77],{432:function(e,a,s){s.d(a,{A:function(){return h}});var r=s(6768),o=s(4232),l=s(5130);const i={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},n={class:"container-fluid"},t={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},d={class:"navbar-nav me-auto"},c={class:"nav-item"},u={key:0,class:"nav-item"},v={class:"d-flex align-items-center"},m={key:0,class:"dropdown dropdown-end"},p={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},f=["src"],b={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function k(e,a,s,k,g,y){const w=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("nav",i,[(0,r.Lk)("div",n,[(0,r.bF)(w,{to:"/",class:"navbar-brand"},{default:(0,r.k6)(()=>[...a[1]||(a[1]=[(0,r.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),a[9]||(a[9]=(0,r.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,r.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,r.Lk)("div",t,[(0,r.Lk)("ul",d,[(0,r.Lk)("li",c,[(0,r.bF)(w,{to:"/",class:"nav-link"},{default:(0,r.k6)(()=>[...a[2]||(a[2]=[(0,r.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,r.eW)(" 旅行大厅 ",-1)])]),_:1})]),k.isLoggedIn?((0,r.uX)(),(0,r.CE)("li",u,[(0,r.bF)(w,{to:"/my-trips/",class:"nav-link"},{default:(0,r.k6)(()=>[...a[3]||(a[3]=[(0,r.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,r.eW)(" 我的旅行 ",-1)])]),_:1})])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",v,[k.isLoggedIn?((0,r.uX)(),(0,r.CE)("div",m,[(0,r.Lk)("a",p,[(0,r.Lk)("img",{src:k.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,f),(0,r.Lk)("span",null,(0,o.v_)(k.username),1)]),(0,r.Lk)("ul",b,[(0,r.Lk)("li",null,[(0,r.bF)(w,{to:"/user/center",class:"dropdown-item"},{default:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,r.eW)("个人中心 ",-1)])]),_:1})]),a[6]||(a[6]=(0,r.Lk)("li",null,[(0,r.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,r.Lk)("li",null,[(0,r.Lk)("a",{href:"#",class:"dropdown-item",onClick:a[0]||(a[0]=(0,l.D$)((...e)=>k.handleLogout&&k.handleLogout(...e),["prevent"]))},[...a[5]||(a[5]=[(0,r.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,r.eW)("退出登录 ",-1)])])])])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(w,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)(" 登录 ",-1)])]),_:1}),(0,r.bF)(w,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.eW)(" 注册 ",-1)])]),_:1})],64))])])])])}s(4114);var g=s(8512),y=s(3459),w={name:"NavBar",setup(){const e=(0,g.rd)(),a=(0,y.k)(),s=(0,r.EW)(()=>a.isLoggedIn),o=(0,r.EW)(()=>a.username),l=(0,r.EW)(()=>a.avatar),i=async()=>{if(confirm("确定要退出登录吗？"))try{await a.logout(),e.push("/login")}catch(s){console.error("退出失败:",s)}};return{isLoggedIn:s,username:o,avatar:l,handleLogout:i}}},L=s(1241);const _=(0,L.A)(w,[["render",k],["__scopeId","data-v-a6dd4bee"]]);var h=_},946:function(e,a,s){e.exports=s.p+"assets/img/qq_logo.666e5ea1.png"},3458:function(e,a,s){s.r(a),s.d(a,{default:function(){return le}});var r=s(6768),o=s(4232),l=s(5130),i=s(946);const n={class:"auth-wrapper"},t={class:"register-container"},d={class:"container py-5"},c={class:"row justify-content-center"},u={class:"col-md-6 col-lg-5"},v={class:"card shadow"},m={class:"card-body p-5"},p={key:0,class:"alert alert-danger"},f={key:1,class:"alert alert-success"},b={class:"mb-3"},k=["disabled"],g={key:0,class:"text-danger small mt-1"},y={class:"mb-3"},w={class:"input-group"},L=["disabled"],_=["disabled"],h={key:0,class:"spinner-border spinner-border-sm me-1"},C={key:1},x={key:2},E={key:0,class:"text-danger small mt-1"},Q={key:1,class:"text-success small mt-1"},X={key:0,class:"mb-3"},A={class:"input-group"},q=["disabled"],V=["disabled"],R={key:0,class:"spinner-border spinner-border-sm me-1"},D={key:1},W={key:2},K={key:0,class:"text-danger small mt-1"},I={key:1,class:"text-success small mt-1"},F={class:"mb-3"},S=["disabled"],U={key:0,class:"text-danger small mt-1"},J={class:"mb-4"},M=["disabled"],N={key:0,class:"text-danger small mt-1"},B=["disabled"],$={key:0,class:"spinner-border spinner-border-sm me-2"},j={class:"text-center mb-3"},z=["disabled"],H={key:0},T={key:1},G={class:"text-center"};function O(e,a,s,O,P,Y){const Z=(0,r.g2)("NavBar"),ee=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",n,[(0,r.bF)(Z),(0,r.Lk)("div",t,[(0,r.Lk)("div",d,[(0,r.Lk)("div",c,[(0,r.Lk)("div",u,[(0,r.Lk)("div",v,[(0,r.Lk)("div",m,[a[19]||(a[19]=(0,r.Lk)("h2",{class:"text-center mb-2"},"用户注册",-1)),a[20]||(a[20]=(0,r.Lk)("p",{class:"register-slogan text-center mb-4"},"Become a Roamioer today.",-1)),O.errorMessage?((0,r.uX)(),(0,r.CE)("div",p,(0,o.v_)(O.errorMessage),1)):(0,r.Q3)("",!0),O.successMessage?((0,r.uX)(),(0,r.CE)("div",f,(0,o.v_)(O.successMessage),1)):(0,r.Q3)("",!0),(0,r.Lk)("form",{onSubmit:a[8]||(a[8]=(0,l.D$)((...e)=>O.handleRegister&&O.handleRegister(...e),["prevent"]))},[(0,r.Lk)("div",b,[a[9]||(a[9]=(0,r.Lk)("label",{for:"username",class:"form-label"},"用户名",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":a[0]||(a[0]=e=>O.formData.username=e),required:"",disabled:O.submitting,placeholder:"请输入用户名"},null,8,k),[[l.Jo,O.formData.username]]),O.errors.username?((0,r.uX)(),(0,r.CE)("div",g,(0,o.v_)(O.errors.username),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",y,[a[10]||(a[10]=(0,r.Lk)("label",{for:"email",class:"form-label"},[(0,r.eW)("邮箱 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",w,[(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":a[1]||(a[1]=e=>O.formData.email=e),required:"",disabled:O.submitting||O.codeVerified,placeholder:"请输入邮箱"},null,8,L),[[l.Jo,O.formData.email]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",disabled:!O.formData.email||O.sendingCode||O.codeVerified||O.countdown>0,onClick:a[2]||(a[2]=(...e)=>O.handleSendCode&&O.handleSendCode(...e))},[O.sendingCode?((0,r.uX)(),(0,r.CE)("span",h)):O.countdown>0?((0,r.uX)(),(0,r.CE)("span",C,(0,o.v_)(O.countdown)+"s",1)):((0,r.uX)(),(0,r.CE)("span",x,"发送验证码"))],8,_)]),O.errors.email?((0,r.uX)(),(0,r.CE)("div",E,(0,o.v_)(O.errors.email),1)):(0,r.Q3)("",!0),O.codeSent&&!O.codeVerified?((0,r.uX)(),(0,r.CE)("div",Q," 验证码已发送，请查收邮箱 ")):(0,r.Q3)("",!0)]),O.codeSent?((0,r.uX)(),(0,r.CE)("div",X,[a[11]||(a[11]=(0,r.Lk)("label",{for:"verification_code",class:"form-label"},[(0,r.eW)("验证码 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",A,[(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"verification_code","onUpdate:modelValue":a[3]||(a[3]=e=>O.formData.verification_code=e),required:"",disabled:O.submitting||O.codeVerified,placeholder:"请输入验证码",maxlength:"6"},null,8,q),[[l.Jo,O.formData.verification_code]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-primary",disabled:!O.formData.verification_code||O.verifyingCode||O.codeVerified,onClick:a[4]||(a[4]=(...e)=>O.handleVerifyCode&&O.handleVerifyCode(...e))},[O.verifyingCode?((0,r.uX)(),(0,r.CE)("span",R)):O.codeVerified?((0,r.uX)(),(0,r.CE)("span",D,"✓ 已验证")):((0,r.uX)(),(0,r.CE)("span",W,"验证"))],8,V)]),O.errors.verification_code?((0,r.uX)(),(0,r.CE)("div",K,(0,o.v_)(O.errors.verification_code),1)):(0,r.Q3)("",!0),O.codeVerified?((0,r.uX)(),(0,r.CE)("div",I," ✓ 邮箱验证成功 ")):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),(0,r.Lk)("div",F,[a[12]||(a[12]=(0,r.Lk)("label",{for:"password",class:"form-label"},"密码",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":a[5]||(a[5]=e=>O.formData.password=e),required:"",disabled:O.submitting,placeholder:"请输入密码"},null,8,S),[[l.Jo,O.formData.password]]),O.errors.password?((0,r.uX)(),(0,r.CE)("div",U,(0,o.v_)(O.errors.password),1)):(0,r.Q3)("",!0),a[13]||(a[13]=(0,r.Lk)("small",{class:"text-muted"}," 密码至少8位，包含字母和数字 ",-1))]),(0,r.Lk)("div",J,[a[14]||(a[14]=(0,r.Lk)("label",{for:"password2",class:"form-label"},"确认密码",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"password2","onUpdate:modelValue":a[6]||(a[6]=e=>O.formData.password2=e),required:"",disabled:O.submitting,placeholder:"请再次输入密码"},null,8,M),[[l.Jo,O.formData.password2]]),O.errors.password2?((0,r.uX)(),(0,r.CE)("div",N,(0,o.v_)(O.errors.password2),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:O.submitting||!O.codeVerified},[O.submitting?((0,r.uX)(),(0,r.CE)("span",$)):(0,r.Q3)("",!0),(0,r.eW)(" "+(0,o.v_)(O.submitting?"注册中...":O.codeVerified?"完成注册":"请先验证邮箱"),1)],8,B),(0,r.Lk)("div",j,[a[16]||(a[16]=(0,r.Lk)("div",{class:"divider"},[(0,r.Lk)("span",{class:"divider-text"},"或")],-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary w-100 qq-login-btn",disabled:O.qqLoginLoading,onClick:a[7]||(a[7]=(...e)=>O.handleQQLogin&&O.handleQQLogin(...e))},[a[15]||(a[15]=(0,r.Lk)("img",{src:i,alt:"QQ登录",class:"qq-login-icon",width:"20",height:"20"},null,-1)),O.qqLoginLoading?((0,r.uX)(),(0,r.CE)("span",H,"跳转中...")):((0,r.uX)(),(0,r.CE)("span",T,"使用QQ登录"))],8,z)]),(0,r.Lk)("div",G,[a[18]||(a[18]=(0,r.Lk)("span",{class:"text-muted"},"已有账号？",-1)),(0,r.bF)(ee,{to:"/login",class:"text-decoration-none"},{default:(0,r.k6)(()=>[...a[17]||(a[17]=[(0,r.eW)(" 立即登录 ",-1)])]),_:1})])],32)])])])])])])])}s(4114);var P=s(144),Y=s(8512),Z=s(3459),ee=s(2636),ae=s(432),se={name:"RegisterView",components:{NavBar:ae.A},setup(){const e=(0,Y.rd)(),a=(0,Z.k)(),s=(0,P.KR)({username:"",email:"",password:"",password2:"",verification_code:"",verification_token:""}),o=(0,P.KR)({}),l=(0,P.KR)(""),i=(0,P.KR)(""),n=(0,P.KR)(!1),t=(0,P.KR)(!1),d=(0,P.KR)(!1),c=(0,P.KR)(!1),u=(0,P.KR)(!1),v=(0,P.KR)(!1),m=(0,P.KR)(0);let p=null;const f=()=>{if(o.value={},!s.value.username)return o.value.username="请输入用户名",!1;if(s.value.username.length<3)return o.value.username="用户名至少3个字符",!1;if(!s.value.email)return o.value.email="请输入邮箱",!1;const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(s.value.email)?v.value?s.value.password?s.value.password.length<8?(o.value.password="密码至少8位",!1):s.value.password2?s.value.password===s.value.password2||(o.value.password2="两次密码不一致",!1):(o.value.password2="请再次输入密码",!1):(o.value.password="请输入密码",!1):(o.value.verification_token="请先完成邮箱验证",!1):(o.value.email="请输入有效的邮箱地址",!1)},b=async()=>{if(o.value.email="",l.value="",!s.value.email)return void(o.value.email="请先输入邮箱");const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(e.test(s.value.email)){d.value=!0;try{await(0,ee.J2)({email:s.value.email,type:"register"}),u.value=!0,m.value=60,g()}catch(a){if(console.error("发送验证码失败:",a),a.response?.data){const e=a.response.data;e.error?l.value=e.error:e.email?o.value.email=Array.isArray(e.email)?e.email[0]:e.email:l.value="发送验证码失败，请稍后重试"}else l.value="网络错误，请检查网络连接"}finally{d.value=!1}}else o.value.email="请输入有效的邮箱地址"},k=async()=>{if(o.value.verification_code="",l.value="",s.value.verification_code)if(6===s.value.verification_code.length){c.value=!0;try{const e=await(0,ee.HR)({email:s.value.email,code:s.value.verification_code,type:"register"});e.success&&e.verification_token?(s.value.verification_token=e.verification_token,v.value=!0,i.value="邮箱验证成功！可以完成注册了"):o.value.verification_code="验证失败，请检查验证码"}catch(e){if(console.error("验证码验证失败:",e),e.response?.data){const a=e.response.data;a.error?o.value.verification_code=a.error:a.code?o.value.verification_code=Array.isArray(a.code)?a.code[0]:a.code:o.value.verification_code="验证码无效或已过期"}else o.value.verification_code="验证失败，请稍后重试"}finally{c.value=!1}}else o.value.verification_code="验证码为6位数字";else o.value.verification_code="请输入验证码"},g=()=>{p&&clearInterval(p),p=setInterval(()=>{m.value>0?m.value--:(clearInterval(p),p=null)},1e3)};(0,r.hi)(()=>{p&&clearInterval(p)});const y=async()=>{if(l.value="",i.value="",f()){n.value=!0;try{await a.register({username:s.value.username,email:s.value.email,password:s.value.password,password2:s.value.password2,verification_token:s.value.verification_token}),i.value="注册成功！正在跳转...",setTimeout(()=>{e.push("/")},2e3)}catch(r){if(console.error("注册失败:",r),r.response?.data){const e=r.response.data;"object"===typeof e?(e.username&&(o.value.username=Array.isArray(e.username)?e.username[0]:e.username),e.email&&(o.value.email=Array.isArray(e.email)?e.email[0]:e.email),e.password&&(o.value.password=Array.isArray(e.password)?e.password[0]:e.password),e.password2&&(o.value.password2=Array.isArray(e.password2)?e.password2[0]:e.password2),e.verification_code&&(o.value.verification_code=Array.isArray(e.verification_code)?e.verification_code[0]:e.verification_code),e.non_field_errors&&(l.value=Array.isArray(e.non_field_errors)?e.non_field_errors[0]:e.non_field_errors),e.verification_token&&(o.value.verification_token=Array.isArray(e.verification_token)?e.verification_token[0]:e.verification_token,l.value||(l.value="注册需要邮箱验证，请先完成邮箱验证")),!l.value&&(e.detail||e.message||e.error)&&(l.value=e.detail||e.message||e.error),l.value||(l.value="注册失败，请稍后重试")):l.value="注册失败，请稍后重试"}else l.value="网络错误，请检查网络连接"}finally{n.value=!1}}},w=async()=>{t.value=!0;try{const e=await(0,ee.jg)();e.authorize_url&&e.state?(sessionStorage.setItem("qq_oauth_state",e.state),window.location.href=e.authorize_url):(l.value="获取QQ登录链接失败，请重试",t.value=!1)}catch(e){l.value=e.response?.data?.error||"QQ登录失败，请重试",t.value=!1}};return{formData:s,errors:o,errorMessage:l,successMessage:i,submitting:n,qqLoginLoading:t,sendingCode:d,verifyingCode:c,codeSent:u,codeVerified:v,countdown:m,handleRegister:y,handleQQLogin:w,handleSendCode:b,handleVerifyCode:k}}},re=s(1241);const oe=(0,re.A)(se,[["render",O],["__scopeId","data-v-08a93b78"]]);var le=oe}}]);
//# sourceMappingURL=77.86f1527f.js.map