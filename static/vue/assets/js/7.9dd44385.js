"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[7],{432:function(e,a,s){s.d(a,{A:function(){return h}});var r=s(6768),o=s(4232),l=s(5130);const i={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},n={class:"container-fluid"},t={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},d={class:"navbar-nav me-auto"},c={class:"nav-item"},u={key:0,class:"nav-item"},v={class:"d-flex align-items-center"},m={key:0,class:"dropdown dropdown-end"},p={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},f=["src"],b={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function k(e,a,s,k,g,y){const w=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("nav",i,[(0,r.Lk)("div",n,[(0,r.bF)(w,{to:"/",class:"navbar-brand"},{default:(0,r.k6)(()=>[...a[1]||(a[1]=[(0,r.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),a[9]||(a[9]=(0,r.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,r.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,r.Lk)("div",t,[(0,r.Lk)("ul",d,[(0,r.Lk)("li",c,[(0,r.bF)(w,{to:"/",class:"nav-link"},{default:(0,r.k6)(()=>[...a[2]||(a[2]=[(0,r.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,r.eW)(" 旅行大厅 ",-1)])]),_:1})]),k.isLoggedIn?((0,r.uX)(),(0,r.CE)("li",u,[(0,r.bF)(w,{to:"/my-trips/",class:"nav-link"},{default:(0,r.k6)(()=>[...a[3]||(a[3]=[(0,r.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,r.eW)(" 我的旅行 ",-1)])]),_:1})])):(0,r.Q3)("",!0)]),(0,r.Lk)("div",v,[k.isLoggedIn?((0,r.uX)(),(0,r.CE)("div",m,[(0,r.Lk)("a",p,[(0,r.Lk)("img",{src:k.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,f),(0,r.Lk)("span",null,(0,o.v_)(k.username),1)]),(0,r.Lk)("ul",b,[(0,r.Lk)("li",null,[(0,r.bF)(w,{to:"/user/center",class:"dropdown-item"},{default:(0,r.k6)(()=>[...a[4]||(a[4]=[(0,r.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,r.eW)("个人中心 ",-1)])]),_:1})]),a[6]||(a[6]=(0,r.Lk)("li",null,[(0,r.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,r.Lk)("li",null,[(0,r.Lk)("a",{href:"#",class:"dropdown-item",onClick:a[0]||(a[0]=(0,l.D$)((...e)=>k.handleLogout&&k.handleLogout(...e),["prevent"]))},[...a[5]||(a[5]=[(0,r.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,r.eW)("退出登录 ",-1)])])])])])):((0,r.uX)(),(0,r.CE)(r.FK,{key:1},[(0,r.bF)(w,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,r.k6)(()=>[...a[7]||(a[7]=[(0,r.eW)(" 登录 ",-1)])]),_:1}),(0,r.bF)(w,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,r.k6)(()=>[...a[8]||(a[8]=[(0,r.eW)(" 注册 ",-1)])]),_:1})],64))])])])])}s(4114);var g=s(8512),y=s(3459),w={name:"NavBar",setup(){const e=(0,g.rd)(),a=(0,y.k)(),s=(0,r.EW)(()=>a.isLoggedIn),o=(0,r.EW)(()=>a.username),l=(0,r.EW)(()=>a.avatar),i=async()=>{if(confirm("确定要退出登录吗？"))try{await a.logout(),e.push("/login")}catch(s){console.error("退出失败:",s)}};return{isLoggedIn:s,username:o,avatar:l,handleLogout:i}}},L=s(1241);const _=(0,L.A)(w,[["render",k],["__scopeId","data-v-a6dd4bee"]]);var h=_},946:function(e,a,s){e.exports=s.p+"assets/img/qq_logo.666e5ea1.png"},8007:function(e,a,s){s.r(a),s.d(a,{default:function(){return oe}});var r=s(6768),o=s(4232),l=s(5130),i=s(946);const n={class:"register-container"},t={class:"container py-5"},d={class:"row justify-content-center"},c={class:"col-md-6 col-lg-5"},u={class:"card shadow"},v={class:"card-body p-5"},m={key:0,class:"alert alert-danger"},p={key:1,class:"alert alert-success"},f={class:"mb-3"},b=["disabled"],k={key:0,class:"text-danger small mt-1"},g={class:"mb-3"},y={class:"input-group"},w=["disabled"],L=["disabled"],_={key:0,class:"spinner-border spinner-border-sm me-1"},h={key:1},C={key:2},x={key:0,class:"text-danger small mt-1"},E={key:1,class:"text-success small mt-1"},Q={key:0,class:"mb-3"},X={class:"input-group"},A=["disabled"],q=["disabled"],V={key:0,class:"spinner-border spinner-border-sm me-1"},R={key:1},D={key:2},W={key:0,class:"text-danger small mt-1"},K={key:1,class:"text-success small mt-1"},I={class:"mb-3"},F=["disabled"],S={key:0,class:"text-danger small mt-1"},U={class:"mb-4"},J=["disabled"],M={key:0,class:"text-danger small mt-1"},N=["disabled"],B={key:0,class:"spinner-border spinner-border-sm me-2"},$={class:"text-center mb-3"},j=["disabled"],z={key:0},H={key:1},T={class:"text-center"};function G(e,a,s,G,O,P){const Y=(0,r.g2)("NavBar"),Z=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",n,[(0,r.bF)(Y),(0,r.Lk)("div",t,[(0,r.Lk)("div",d,[(0,r.Lk)("div",c,[(0,r.Lk)("div",u,[(0,r.Lk)("div",v,[a[19]||(a[19]=(0,r.Lk)("h2",{class:"text-center mb-2"},"用户注册",-1)),a[20]||(a[20]=(0,r.Lk)("p",{class:"register-slogan text-center mb-4"},"Become a Roamioer today.",-1)),G.errorMessage?((0,r.uX)(),(0,r.CE)("div",m,(0,o.v_)(G.errorMessage),1)):(0,r.Q3)("",!0),G.successMessage?((0,r.uX)(),(0,r.CE)("div",p,(0,o.v_)(G.successMessage),1)):(0,r.Q3)("",!0),(0,r.Lk)("form",{onSubmit:a[8]||(a[8]=(0,l.D$)((...e)=>G.handleRegister&&G.handleRegister(...e),["prevent"]))},[(0,r.Lk)("div",f,[a[9]||(a[9]=(0,r.Lk)("label",{for:"username",class:"form-label"},"用户名",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":a[0]||(a[0]=e=>G.formData.username=e),required:"",disabled:G.submitting,placeholder:"请输入用户名"},null,8,b),[[l.Jo,G.formData.username]]),G.errors.username?((0,r.uX)(),(0,r.CE)("div",k,(0,o.v_)(G.errors.username),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",g,[a[10]||(a[10]=(0,r.Lk)("label",{for:"email",class:"form-label"},[(0,r.eW)("邮箱 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",y,[(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":a[1]||(a[1]=e=>G.formData.email=e),required:"",disabled:G.submitting||G.codeVerified,placeholder:"请输入邮箱"},null,8,w),[[l.Jo,G.formData.email]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",disabled:!G.formData.email||G.sendingCode||G.codeVerified||G.countdown>0,onClick:a[2]||(a[2]=(...e)=>G.handleSendCode&&G.handleSendCode(...e))},[G.sendingCode?((0,r.uX)(),(0,r.CE)("span",_)):G.countdown>0?((0,r.uX)(),(0,r.CE)("span",h,(0,o.v_)(G.countdown)+"s",1)):((0,r.uX)(),(0,r.CE)("span",C,"发送验证码"))],8,L)]),G.errors.email?((0,r.uX)(),(0,r.CE)("div",x,(0,o.v_)(G.errors.email),1)):(0,r.Q3)("",!0),G.codeSent&&!G.codeVerified?((0,r.uX)(),(0,r.CE)("div",E," 验证码已发送，请查收邮箱 ")):(0,r.Q3)("",!0)]),G.codeSent?((0,r.uX)(),(0,r.CE)("div",Q,[a[11]||(a[11]=(0,r.Lk)("label",{for:"verification_code",class:"form-label"},[(0,r.eW)("验证码 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",X,[(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"verification_code","onUpdate:modelValue":a[3]||(a[3]=e=>G.formData.verification_code=e),required:"",disabled:G.submitting||G.codeVerified,placeholder:"请输入验证码",maxlength:"6"},null,8,A),[[l.Jo,G.formData.verification_code]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-primary",disabled:!G.formData.verification_code||G.verifyingCode||G.codeVerified,onClick:a[4]||(a[4]=(...e)=>G.handleVerifyCode&&G.handleVerifyCode(...e))},[G.verifyingCode?((0,r.uX)(),(0,r.CE)("span",V)):G.codeVerified?((0,r.uX)(),(0,r.CE)("span",R,"✓ 已验证")):((0,r.uX)(),(0,r.CE)("span",D,"验证"))],8,q)]),G.errors.verification_code?((0,r.uX)(),(0,r.CE)("div",W,(0,o.v_)(G.errors.verification_code),1)):(0,r.Q3)("",!0),G.codeVerified?((0,r.uX)(),(0,r.CE)("div",K," ✓ 邮箱验证成功 ")):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),(0,r.Lk)("div",I,[a[12]||(a[12]=(0,r.Lk)("label",{for:"password",class:"form-label"},"密码",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":a[5]||(a[5]=e=>G.formData.password=e),required:"",disabled:G.submitting,placeholder:"请输入密码"},null,8,F),[[l.Jo,G.formData.password]]),G.errors.password?((0,r.uX)(),(0,r.CE)("div",S,(0,o.v_)(G.errors.password),1)):(0,r.Q3)("",!0),a[13]||(a[13]=(0,r.Lk)("small",{class:"text-muted"}," 密码至少8位，包含字母和数字 ",-1))]),(0,r.Lk)("div",U,[a[14]||(a[14]=(0,r.Lk)("label",{for:"password2",class:"form-label"},"确认密码",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"password2","onUpdate:modelValue":a[6]||(a[6]=e=>G.formData.password2=e),required:"",disabled:G.submitting,placeholder:"请再次输入密码"},null,8,J),[[l.Jo,G.formData.password2]]),G.errors.password2?((0,r.uX)(),(0,r.CE)("div",M,(0,o.v_)(G.errors.password2),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:G.submitting||!G.codeVerified},[G.submitting?((0,r.uX)(),(0,r.CE)("span",B)):(0,r.Q3)("",!0),(0,r.eW)(" "+(0,o.v_)(G.submitting?"注册中...":G.codeVerified?"完成注册":"请先验证邮箱"),1)],8,N),(0,r.Lk)("div",$,[a[16]||(a[16]=(0,r.Lk)("div",{class:"divider"},[(0,r.Lk)("span",{class:"divider-text"},"或")],-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary w-100 qq-login-btn",disabled:G.qqLoginLoading,onClick:a[7]||(a[7]=(...e)=>G.handleQQLogin&&G.handleQQLogin(...e))},[a[15]||(a[15]=(0,r.Lk)("img",{src:i,alt:"QQ登录",class:"qq-login-icon",width:"20",height:"20"},null,-1)),G.qqLoginLoading?((0,r.uX)(),(0,r.CE)("span",z,"跳转中...")):((0,r.uX)(),(0,r.CE)("span",H,"使用QQ登录"))],8,j)]),(0,r.Lk)("div",T,[a[18]||(a[18]=(0,r.Lk)("span",{class:"text-muted"},"已有账号？",-1)),(0,r.bF)(Z,{to:"/login",class:"text-decoration-none"},{default:(0,r.k6)(()=>[...a[17]||(a[17]=[(0,r.eW)(" 立即登录 ",-1)])]),_:1})])],32)])])])])])])}s(4114);var O=s(144),P=s(8512),Y=s(3459),Z=s(2636),ee=s(432),ae={name:"RegisterView",components:{NavBar:ee.A},setup(){const e=(0,P.rd)(),a=(0,Y.k)(),s=(0,O.KR)({username:"",email:"",password:"",password2:"",verification_code:"",verification_token:""}),o=(0,O.KR)({}),l=(0,O.KR)(""),i=(0,O.KR)(""),n=(0,O.KR)(!1),t=(0,O.KR)(!1),d=(0,O.KR)(!1),c=(0,O.KR)(!1),u=(0,O.KR)(!1),v=(0,O.KR)(!1),m=(0,O.KR)(0);let p=null;const f=()=>{if(o.value={},!s.value.username)return o.value.username="请输入用户名",!1;if(s.value.username.length<3)return o.value.username="用户名至少3个字符",!1;if(!s.value.email)return o.value.email="请输入邮箱",!1;const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(s.value.email)?v.value?s.value.password?s.value.password.length<8?(o.value.password="密码至少8位",!1):s.value.password2?s.value.password===s.value.password2||(o.value.password2="两次密码不一致",!1):(o.value.password2="请再次输入密码",!1):(o.value.password="请输入密码",!1):(o.value.verification_token="请先完成邮箱验证",!1):(o.value.email="请输入有效的邮箱地址",!1)},b=async()=>{if(o.value.email="",l.value="",!s.value.email)return void(o.value.email="请先输入邮箱");const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(e.test(s.value.email)){d.value=!0;try{await(0,Z.J2)({email:s.value.email,type:"register"}),u.value=!0,m.value=60,g()}catch(a){if(console.error("发送验证码失败:",a),a.response?.data){const e=a.response.data;e.error?l.value=e.error:e.email?o.value.email=Array.isArray(e.email)?e.email[0]:e.email:l.value="发送验证码失败，请稍后重试"}else l.value="网络错误，请检查网络连接"}finally{d.value=!1}}else o.value.email="请输入有效的邮箱地址"},k=async()=>{if(o.value.verification_code="",l.value="",s.value.verification_code)if(6===s.value.verification_code.length){c.value=!0;try{const e=await(0,Z.HR)({email:s.value.email,code:s.value.verification_code,type:"register"});e.success&&e.verification_token?(s.value.verification_token=e.verification_token,v.value=!0,i.value="邮箱验证成功！可以完成注册了"):o.value.verification_code="验证失败，请检查验证码"}catch(e){if(console.error("验证码验证失败:",e),e.response?.data){const a=e.response.data;a.error?o.value.verification_code=a.error:a.code?o.value.verification_code=Array.isArray(a.code)?a.code[0]:a.code:o.value.verification_code="验证码无效或已过期"}else o.value.verification_code="验证失败，请稍后重试"}finally{c.value=!1}}else o.value.verification_code="验证码为6位数字";else o.value.verification_code="请输入验证码"},g=()=>{p&&clearInterval(p),p=setInterval(()=>{m.value>0?m.value--:(clearInterval(p),p=null)},1e3)};(0,r.hi)(()=>{p&&clearInterval(p)});const y=async()=>{if(l.value="",i.value="",f()){n.value=!0;try{await a.register({username:s.value.username,email:s.value.email,password:s.value.password,password2:s.value.password2,verification_token:s.value.verification_token}),i.value="注册成功！正在跳转...",setTimeout(()=>{e.push("/")},2e3)}catch(r){if(console.error("注册失败:",r),r.response?.data){const e=r.response.data;"object"===typeof e?(e.username&&(o.value.username=Array.isArray(e.username)?e.username[0]:e.username),e.email&&(o.value.email=Array.isArray(e.email)?e.email[0]:e.email),e.password&&(o.value.password=Array.isArray(e.password)?e.password[0]:e.password),e.password2&&(o.value.password2=Array.isArray(e.password2)?e.password2[0]:e.password2),e.verification_code&&(o.value.verification_code=Array.isArray(e.verification_code)?e.verification_code[0]:e.verification_code),e.non_field_errors&&(l.value=Array.isArray(e.non_field_errors)?e.non_field_errors[0]:e.non_field_errors),e.verification_token&&(o.value.verification_token=Array.isArray(e.verification_token)?e.verification_token[0]:e.verification_token,l.value||(l.value="注册需要邮箱验证，请先完成邮箱验证")),!l.value&&(e.detail||e.message||e.error)&&(l.value=e.detail||e.message||e.error),l.value||(l.value="注册失败，请稍后重试")):l.value="注册失败，请稍后重试"}else l.value="网络错误，请检查网络连接"}finally{n.value=!1}}},w=async()=>{t.value=!0;try{const e=await(0,Z.jg)();e.authorize_url&&e.state?(sessionStorage.setItem("qq_oauth_state",e.state),window.location.href=e.authorize_url):(l.value="获取QQ登录链接失败，请重试",t.value=!1)}catch(e){l.value=e.response?.data?.error||"QQ登录失败，请重试",t.value=!1}};return{formData:s,errors:o,errorMessage:l,successMessage:i,submitting:n,qqLoginLoading:t,sendingCode:d,verifyingCode:c,codeSent:u,codeVerified:v,countdown:m,handleRegister:y,handleQQLogin:w,handleSendCode:b,handleVerifyCode:k}}},se=s(1241);const re=(0,se.A)(ae,[["render",G],["__scopeId","data-v-712c7e91"]]);var oe=re}}]);
//# sourceMappingURL=7.9dd44385.js.map