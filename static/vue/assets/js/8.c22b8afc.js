"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[8],{946:function(e,a,s){e.exports=s.p+"assets/img/qq_logo.666e5ea1.png"},8008:function(e,a,s){s.r(a),s.d(a,{default:function(){return re}});var r=s(6768),i=s(4232),o=s(5130),l=s(946);const t={class:"register-container"},n={class:"container py-5"},d={class:"row justify-content-center"},c={class:"col-md-6 col-lg-5"},u={class:"card shadow"},v={class:"card-body p-5"},m={key:0,class:"alert alert-danger"},p={key:1,class:"alert alert-success"},f={class:"mb-3"},b=["disabled"],k={key:0,class:"text-danger small mt-1"},y={class:"mb-3"},g={class:"input-group"},_=["disabled"],w=["disabled"],L={key:0,class:"spinner-border spinner-border-sm me-1"},h={key:1},C={key:2},Q={key:0,class:"text-danger small mt-1"},x={key:1,class:"text-success small mt-1"},E={key:0,class:"mb-3"},X={class:"input-group"},q=["disabled"],A=["disabled"],V={key:0,class:"spinner-border spinner-border-sm me-1"},R={key:1},D={key:2},K={key:0,class:"text-danger small mt-1"},S={key:1,class:"text-success small mt-1"},I={class:"mb-3"},J=["disabled"],M={key:0,class:"text-danger small mt-1"},U={class:"mb-4"},W=["disabled"],j={key:0,class:"text-danger small mt-1"},$=["disabled"],z={key:0,class:"spinner-border spinner-border-sm me-2"},B={class:"text-center mb-3"},F=["disabled"],H={key:0},T={key:1},G={class:"text-center"};function N(e,a,s,N,O,P){const Y=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",t,[(0,r.Lk)("div",n,[(0,r.Lk)("div",d,[(0,r.Lk)("div",c,[(0,r.Lk)("div",u,[(0,r.Lk)("div",v,[a[19]||(a[19]=(0,r.Lk)("h2",{class:"text-center mb-2"},"用户注册",-1)),a[20]||(a[20]=(0,r.Lk)("p",{class:"register-slogan text-center mb-4"},"Become a Roamioer today.",-1)),N.errorMessage?((0,r.uX)(),(0,r.CE)("div",m,(0,i.v_)(N.errorMessage),1)):(0,r.Q3)("",!0),N.successMessage?((0,r.uX)(),(0,r.CE)("div",p,(0,i.v_)(N.successMessage),1)):(0,r.Q3)("",!0),(0,r.Lk)("form",{onSubmit:a[8]||(a[8]=(0,o.D$)((...e)=>N.handleRegister&&N.handleRegister(...e),["prevent"]))},[(0,r.Lk)("div",f,[a[9]||(a[9]=(0,r.Lk)("label",{for:"username",class:"form-label"},"用户名",-1)),(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"username","onUpdate:modelValue":a[0]||(a[0]=e=>N.formData.username=e),required:"",disabled:N.submitting,placeholder:"请输入用户名"},null,8,b),[[o.Jo,N.formData.username]]),N.errors.username?((0,r.uX)(),(0,r.CE)("div",k,(0,i.v_)(N.errors.username),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("div",y,[a[10]||(a[10]=(0,r.Lk)("label",{for:"email",class:"form-label"},[(0,r.eW)("邮箱 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",g,[(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":a[1]||(a[1]=e=>N.formData.email=e),required:"",disabled:N.submitting||N.codeVerified,placeholder:"请输入邮箱"},null,8,_),[[o.Jo,N.formData.email]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",disabled:!N.formData.email||N.sendingCode||N.codeVerified||N.countdown>0,onClick:a[2]||(a[2]=(...e)=>N.handleSendCode&&N.handleSendCode(...e))},[N.sendingCode?((0,r.uX)(),(0,r.CE)("span",L)):N.countdown>0?((0,r.uX)(),(0,r.CE)("span",h,(0,i.v_)(N.countdown)+"s",1)):((0,r.uX)(),(0,r.CE)("span",C,"发送验证码"))],8,w)]),N.errors.email?((0,r.uX)(),(0,r.CE)("div",Q,(0,i.v_)(N.errors.email),1)):(0,r.Q3)("",!0),N.codeSent&&!N.codeVerified?((0,r.uX)(),(0,r.CE)("div",x," 验证码已发送，请查收邮箱 ")):(0,r.Q3)("",!0)]),N.codeSent?((0,r.uX)(),(0,r.CE)("div",E,[a[11]||(a[11]=(0,r.Lk)("label",{for:"verification_code",class:"form-label"},[(0,r.eW)("验证码 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",X,[(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"verification_code","onUpdate:modelValue":a[3]||(a[3]=e=>N.formData.verification_code=e),required:"",disabled:N.submitting||N.codeVerified,placeholder:"请输入验证码",maxlength:"6"},null,8,q),[[o.Jo,N.formData.verification_code]]),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-primary",disabled:!N.formData.verification_code||N.verifyingCode||N.codeVerified,onClick:a[4]||(a[4]=(...e)=>N.handleVerifyCode&&N.handleVerifyCode(...e))},[N.verifyingCode?((0,r.uX)(),(0,r.CE)("span",V)):N.codeVerified?((0,r.uX)(),(0,r.CE)("span",R,"✓ 已验证")):((0,r.uX)(),(0,r.CE)("span",D,"验证"))],8,A)]),N.errors.verification_code?((0,r.uX)(),(0,r.CE)("div",K,(0,i.v_)(N.errors.verification_code),1)):(0,r.Q3)("",!0),N.codeVerified?((0,r.uX)(),(0,r.CE)("div",S," ✓ 邮箱验证成功 ")):(0,r.Q3)("",!0)])):(0,r.Q3)("",!0),(0,r.Lk)("div",I,[a[12]||(a[12]=(0,r.Lk)("label",{for:"password",class:"form-label"},"密码",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"password","onUpdate:modelValue":a[5]||(a[5]=e=>N.formData.password=e),required:"",disabled:N.submitting,placeholder:"请输入密码"},null,8,J),[[o.Jo,N.formData.password]]),N.errors.password?((0,r.uX)(),(0,r.CE)("div",M,(0,i.v_)(N.errors.password),1)):(0,r.Q3)("",!0),a[13]||(a[13]=(0,r.Lk)("small",{class:"text-muted"}," 密码至少8位，包含字母和数字 ",-1))]),(0,r.Lk)("div",U,[a[14]||(a[14]=(0,r.Lk)("label",{for:"password2",class:"form-label"},"确认密码",-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"password2","onUpdate:modelValue":a[6]||(a[6]=e=>N.formData.password2=e),required:"",disabled:N.submitting,placeholder:"请再次输入密码"},null,8,W),[[o.Jo,N.formData.password2]]),N.errors.password2?((0,r.uX)(),(0,r.CE)("div",j,(0,i.v_)(N.errors.password2),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:N.submitting||!N.codeVerified},[N.submitting?((0,r.uX)(),(0,r.CE)("span",z)):(0,r.Q3)("",!0),(0,r.eW)(" "+(0,i.v_)(N.submitting?"注册中...":N.codeVerified?"完成注册":"请先验证邮箱"),1)],8,$),(0,r.Lk)("div",B,[a[16]||(a[16]=(0,r.Lk)("div",{class:"divider"},[(0,r.Lk)("span",{class:"divider-text"},"或")],-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary w-100 qq-login-btn",disabled:N.qqLoginLoading,onClick:a[7]||(a[7]=(...e)=>N.handleQQLogin&&N.handleQQLogin(...e))},[a[15]||(a[15]=(0,r.Lk)("img",{src:l,alt:"QQ登录",class:"qq-login-icon",width:"20",height:"20"},null,-1)),N.qqLoginLoading?((0,r.uX)(),(0,r.CE)("span",H,"跳转中...")):((0,r.uX)(),(0,r.CE)("span",T,"使用QQ登录"))],8,F)]),(0,r.Lk)("div",G,[a[18]||(a[18]=(0,r.Lk)("span",{class:"text-muted"},"已有账号？",-1)),(0,r.bF)(Y,{to:"/login",class:"text-decoration-none"},{default:(0,r.k6)(()=>[...a[17]||(a[17]=[(0,r.eW)(" 立即登录 ",-1)])]),_:1})])],32)])])])])])])}s(4114);var O=s(144),P=s(8512),Y=s(3459),Z=s(2636),ee={name:"RegisterView",setup(){const e=(0,P.rd)(),a=(0,Y.k)(),s=(0,O.KR)({username:"",email:"",password:"",password2:"",verification_code:"",verification_token:""}),i=(0,O.KR)({}),o=(0,O.KR)(""),l=(0,O.KR)(""),t=(0,O.KR)(!1),n=(0,O.KR)(!1),d=(0,O.KR)(!1),c=(0,O.KR)(!1),u=(0,O.KR)(!1),v=(0,O.KR)(!1),m=(0,O.KR)(0);let p=null;const f=()=>{if(i.value={},!s.value.username)return i.value.username="请输入用户名",!1;if(s.value.username.length<3)return i.value.username="用户名至少3个字符",!1;if(!s.value.email)return i.value.email="请输入邮箱",!1;const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return e.test(s.value.email)?v.value?s.value.password?s.value.password.length<8?(i.value.password="密码至少8位",!1):s.value.password2?s.value.password===s.value.password2||(i.value.password2="两次密码不一致",!1):(i.value.password2="请再次输入密码",!1):(i.value.password="请输入密码",!1):(i.value.verification_token="请先完成邮箱验证",!1):(i.value.email="请输入有效的邮箱地址",!1)},b=async()=>{if(i.value.email="",o.value="",!s.value.email)return void(i.value.email="请先输入邮箱");const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(e.test(s.value.email)){d.value=!0;try{await(0,Z.J2)({email:s.value.email,type:"register"}),u.value=!0,m.value=60,y()}catch(a){if(console.error("发送验证码失败:",a),a.response?.data){const e=a.response.data;e.error?o.value=e.error:e.email?i.value.email=Array.isArray(e.email)?e.email[0]:e.email:o.value="发送验证码失败，请稍后重试"}else o.value="网络错误，请检查网络连接"}finally{d.value=!1}}else i.value.email="请输入有效的邮箱地址"},k=async()=>{if(i.value.verification_code="",o.value="",s.value.verification_code)if(6===s.value.verification_code.length){c.value=!0;try{const e=await(0,Z.HR)({email:s.value.email,code:s.value.verification_code,type:"register"});e.success&&e.verification_token?(s.value.verification_token=e.verification_token,v.value=!0,l.value="邮箱验证成功！可以完成注册了"):i.value.verification_code="验证失败，请检查验证码"}catch(e){if(console.error("验证码验证失败:",e),e.response?.data){const a=e.response.data;a.error?i.value.verification_code=a.error:a.code?i.value.verification_code=Array.isArray(a.code)?a.code[0]:a.code:i.value.verification_code="验证码无效或已过期"}else i.value.verification_code="验证失败，请稍后重试"}finally{c.value=!1}}else i.value.verification_code="验证码为6位数字";else i.value.verification_code="请输入验证码"},y=()=>{p&&clearInterval(p),p=setInterval(()=>{m.value>0?m.value--:(clearInterval(p),p=null)},1e3)};(0,r.hi)(()=>{p&&clearInterval(p)});const g=async()=>{if(o.value="",l.value="",f()){t.value=!0;try{await a.register({username:s.value.username,email:s.value.email,password:s.value.password,password2:s.value.password2,verification_token:s.value.verification_token}),l.value="注册成功！正在跳转...",setTimeout(()=>{e.push("/")},2e3)}catch(r){if(console.error("注册失败:",r),r.response?.data){const e=r.response.data;"object"===typeof e?(e.username&&(i.value.username=Array.isArray(e.username)?e.username[0]:e.username),e.email&&(i.value.email=Array.isArray(e.email)?e.email[0]:e.email),e.password&&(i.value.password=Array.isArray(e.password)?e.password[0]:e.password),e.password2&&(i.value.password2=Array.isArray(e.password2)?e.password2[0]:e.password2),e.verification_code&&(i.value.verification_code=Array.isArray(e.verification_code)?e.verification_code[0]:e.verification_code),e.non_field_errors&&(o.value=Array.isArray(e.non_field_errors)?e.non_field_errors[0]:e.non_field_errors),e.verification_token&&(i.value.verification_token=Array.isArray(e.verification_token)?e.verification_token[0]:e.verification_token,o.value||(o.value="注册需要邮箱验证，请先完成邮箱验证")),!o.value&&(e.detail||e.message||e.error)&&(o.value=e.detail||e.message||e.error),o.value||(o.value="注册失败，请稍后重试")):o.value="注册失败，请稍后重试"}else o.value="网络错误，请检查网络连接"}finally{t.value=!1}}},_=async()=>{n.value=!0;try{const e=await(0,Z.jg)();e.authorize_url&&e.state?(sessionStorage.setItem("qq_oauth_state",e.state),window.location.href=e.authorize_url):(o.value="获取QQ登录链接失败，请重试",n.value=!1)}catch(e){o.value=e.response?.data?.error||"QQ登录失败，请重试",n.value=!1}};return{formData:s,errors:i,errorMessage:o,successMessage:l,submitting:t,qqLoginLoading:n,sendingCode:d,verifyingCode:c,codeSent:u,codeVerified:v,countdown:m,handleRegister:g,handleQQLogin:_,handleSendCode:b,handleVerifyCode:k}}},ae=s(1241);const se=(0,ae.A)(ee,[["render",N],["__scopeId","data-v-db1979d6"]]);var re=se}}]);
//# sourceMappingURL=8.c22b8afc.js.map