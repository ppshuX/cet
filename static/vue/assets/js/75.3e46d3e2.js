"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[75],{432:function(e,t,a){a.d(t,{A:function(){return w}});var n=a(6768),i=a(4232),s=a(5130);const l={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},o={class:"container-fluid"},r={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},c={class:"navbar-nav me-auto"},d={class:"nav-item"},u={key:0,class:"nav-item"},m={class:"d-flex align-items-center"},p={key:0,class:"dropdown dropdown-end"},v={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},g=["src"],k={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function b(e,t,a,b,y,h){const f=(0,n.g2)("router-link");return(0,n.uX)(),(0,n.CE)("nav",l,[(0,n.Lk)("div",o,[(0,n.bF)(f,{to:"/",class:"navbar-brand"},{default:(0,n.k6)(()=>[...t[1]||(t[1]=[(0,n.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),t[9]||(t[9]=(0,n.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,n.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,n.Lk)("div",r,[(0,n.Lk)("ul",c,[(0,n.Lk)("li",d,[(0,n.bF)(f,{to:"/",class:"nav-link"},{default:(0,n.k6)(()=>[...t[2]||(t[2]=[(0,n.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,n.eW)(" 旅行大厅 ",-1)])]),_:1})]),b.isLoggedIn?((0,n.uX)(),(0,n.CE)("li",u,[(0,n.bF)(f,{to:"/my-trips/",class:"nav-link"},{default:(0,n.k6)(()=>[...t[3]||(t[3]=[(0,n.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,n.eW)(" 我的旅行 ",-1)])]),_:1})])):(0,n.Q3)("",!0)]),(0,n.Lk)("div",m,[b.isLoggedIn?((0,n.uX)(),(0,n.CE)("div",p,[(0,n.Lk)("a",v,[(0,n.Lk)("img",{src:b.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,g),(0,n.Lk)("span",null,(0,i.v_)(b.username),1)]),(0,n.Lk)("ul",k,[(0,n.Lk)("li",null,[(0,n.bF)(f,{to:"/user/center",class:"dropdown-item"},{default:(0,n.k6)(()=>[...t[4]||(t[4]=[(0,n.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,n.eW)("个人中心 ",-1)])]),_:1})]),t[6]||(t[6]=(0,n.Lk)("li",null,[(0,n.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,n.Lk)("li",null,[(0,n.Lk)("a",{href:"#",class:"dropdown-item",onClick:t[0]||(t[0]=(0,s.D$)((...e)=>b.handleLogout&&b.handleLogout(...e),["prevent"]))},[...t[5]||(t[5]=[(0,n.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,n.eW)("退出登录 ",-1)])])])])])):((0,n.uX)(),(0,n.CE)(n.FK,{key:1},[(0,n.bF)(f,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,n.k6)(()=>[...t[7]||(t[7]=[(0,n.eW)(" 登录 ",-1)])]),_:1}),(0,n.bF)(f,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,n.k6)(()=>[...t[8]||(t[8]=[(0,n.eW)(" 注册 ",-1)])]),_:1})],64))])])])])}a(4114);var y=a(8512),h=a(3459),f={name:"NavBar",setup(){const e=(0,y.rd)(),t=(0,h.k)(),a=(0,n.EW)(()=>t.isLoggedIn),i=(0,n.EW)(()=>t.username),s=(0,n.EW)(()=>t.avatar),l=async()=>{if(confirm("确定要退出登录吗？"))try{await t.logout(),e.push("/login")}catch(a){console.error("退出失败:",a)}};return{isLoggedIn:a,username:i,avatar:s,handleLogout:l}}},C=a(1241);const L=(0,C.A)(f,[["render",b],["__scopeId","data-v-a6dd4bee"]]);var w=L},485:function(e,t,a){a.d(t,{B:function(){return s},Yf:function(){return i},jw:function(){return o},nN:function(){return l}});var n=a(7277);const i=e=>n.A.get("/trips/",{params:e}),s=async e=>{try{return await n.A.get(`/trip-plans/${e}/`)}catch(t){const a=t.response?.status||t.status,i=404===a||"ERR_BAD_REQUEST"===t.code||t.message?.includes("404")||!t.response;if(i)return await n.A.get(`/trips/${e}/`);throw t}},l=e=>n.A.post(`/trips/${e}/like/`),o=e=>n.A.post(`/trips/${e}/checkin/`)},6075:function(e,t,a){a.r(t),a.d(t,{default:function(){return Zt}});var n=a(6768),i=a(4232);const s=["title"],l={ref:"audioPlayer",loop:""},o=["src"],r={class:"container py-5"},c={key:0,class:"text-center"},d={key:1},u={class:"card shadow-lg mb-4"},m={class:"card-body p-5"},p={class:"mb-3"},v={class:"text-muted mb-0"},g={key:0,class:"basic-info-section"},k={class:"info-grid"},b={key:0,class:"info-item"},y={class:"info-value"},h={key:1,class:"info-item"},f={class:"info-value"},C={key:2,class:"info-item"},L={class:"info-value"},w={key:3,class:"info-item"},_={class:"info-value"},E={key:4,class:"info-item"},I={class:"info-value"},R={key:5,class:"info-item"},X={class:"info-value"},S={key:6,class:"info-item"},x={class:"info-value"},A={key:7,class:"info-item"},Q={class:"info-value"},D={class:"highlights-list"},M={class:"itinerary-section"},K={class:"itinerary-header"},W={class:"itinerary-day"},$={key:0,class:"itinerary-time"},F={class:"itinerary-content"},T={key:0,class:"itinerary-highlight"},B={key:1},U={class:"total-row"},N={key:2,class:"tips-section"},P={class:"tips-list"};function V(e,t,a,V,j,q){const G=(0,n.g2)("NavBar"),J=(0,n.g2)("TripStats"),O=(0,n.g2)("TripProgress"),Y=(0,n.g2)("TripOverview"),H=(0,n.g2)("CommentSection");return(0,n.uX)(),(0,n.CE)("div",{class:"trip-detail-container",style:(0,i.Tr)({background:V.trip&&V.trip.theme_color||"#f0e68c"})},[(0,n.bF)(G),(0,n.Lk)("button",{class:"back-btn",onClick:t[0]||(t[0]=(...e)=>V.goBack&&V.goBack(...e)),title:"返回首页"}," 🏠 "),(0,n.Lk)("button",{class:"music-btn",onClick:t[1]||(t[1]=(...e)=>V.toggleMusic&&V.toggleMusic(...e)),title:V.isPlaying?"暂停音乐":"播放音乐"},(0,i.v_)(V.isPlaying?"🔊":"🔇"),9,s),(0,n.Lk)("audio",l,[(0,n.Lk)("source",{src:V.musicSrc,type:"audio/mpeg"},null,8,o)],512),(0,n.Lk)("div",r,[V.loading?((0,n.uX)(),(0,n.CE)("div",c,[...t[2]||(t[2]=[(0,n.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,n.Lk)("span",{class:"visually-hidden"},"加载中...")],-1)])])):V.trip?((0,n.uX)(),(0,n.CE)("div",d,[(0,n.Lk)("div",u,[(0,n.Lk)("div",m,[(0,n.Lk)("h1",p,(0,i.v_)(V.trip.name||V.trip.title),1),(0,n.Lk)("p",v,(0,i.v_)(V.trip.description),1)])]),V.trip.stats?((0,n.uX)(),(0,n.Wv)(J,{key:0,views:V.trip.stats.views,likes:V.trip.stats.likes,onLike:V.handleLike},null,8,["views","likes","onLike"])):(0,n.Q3)("",!0),V.tripConfig&&V.tripConfig.dates||V.trip.start_date&&V.trip.end_date?((0,n.uX)(),(0,n.Wv)(O,{key:1,"start-date":V.tripConfig?.dates?.start||V.trip.start_date,"end-date":V.tripConfig?.dates?.end||V.trip.end_date},null,8,["start-date","end-date"])):(0,n.Q3)("",!0),V.tripConfig&&V.tripConfig.overview?((0,n.uX)(),(0,n.Wv)(Y,{key:2,title:"行程概览"},{default:(0,n.k6)(()=>[V.tripConfig.overview.basicInfo?((0,n.uX)(),(0,n.CE)("div",g,[t[11]||(t[11]=(0,n.Lk)("h4",null,"🧭 基本信息",-1)),(0,n.Lk)("div",k,[V.tripConfig.overview.basicInfo.participants?((0,n.uX)(),(0,n.CE)("div",b,[t[3]||(t[3]=(0,n.Lk)("span",{class:"info-label"},"👥 Roamioer：",-1)),(0,n.Lk)("span",y,(0,i.v_)(V.tripConfig.overview.basicInfo.participants),1)])):(0,n.Q3)("",!0),V.tripConfig.overview.basicInfo.departure?((0,n.uX)(),(0,n.CE)("div",h,[t[4]||(t[4]=(0,n.Lk)("span",{class:"info-label"},"🚩 出发地：",-1)),(0,n.Lk)("span",f,(0,i.v_)(V.tripConfig.overview.basicInfo.departure),1)])):(0,n.Q3)("",!0),V.tripConfig.overview.basicInfo.destination?((0,n.uX)(),(0,n.CE)("div",C,[t[5]||(t[5]=(0,n.Lk)("span",{class:"info-label"},"🎯 目的地：",-1)),(0,n.Lk)("span",L,(0,i.v_)(V.tripConfig.overview.basicInfo.destination),1)])):(0,n.Q3)("",!0),V.tripConfig.overview.basicInfo.transport?((0,n.uX)(),(0,n.CE)("div",w,[t[6]||(t[6]=(0,n.Lk)("span",{class:"info-label"},"🚗 交通方式：",-1)),(0,n.Lk)("span",_,(0,i.v_)(V.tripConfig.overview.basicInfo.transport),1)])):(0,n.Q3)("",!0),V.tripConfig.overview.basicInfo.accommodation?((0,n.uX)(),(0,n.CE)("div",E,[t[7]||(t[7]=(0,n.Lk)("span",{class:"info-label"},"🏨 住宿：",-1)),(0,n.Lk)("span",I,(0,i.v_)(V.tripConfig.overview.basicInfo.accommodation),1)])):(0,n.Q3)("",!0),V.tripConfig.overview.basicInfo.duration?((0,n.uX)(),(0,n.CE)("div",R,[t[8]||(t[8]=(0,n.Lk)("span",{class:"info-label"},"⏱️ 行程时长：",-1)),(0,n.Lk)("span",X,(0,i.v_)(V.tripConfig.overview.basicInfo.duration),1)])):(0,n.Q3)("",!0),V.tripConfig.overview.basicInfo.budget?((0,n.uX)(),(0,n.CE)("div",S,[t[9]||(t[9]=(0,n.Lk)("span",{class:"info-label"},"💰 预算：",-1)),(0,n.Lk)("span",x,(0,i.v_)(V.tripConfig.overview.basicInfo.budget),1)])):(0,n.Q3)("",!0),V.tripConfig.overview.basicInfo.theme?((0,n.uX)(),(0,n.CE)("div",A,[t[10]||(t[10]=(0,n.Lk)("span",{class:"info-label"},"🎨 主题：",-1)),(0,n.Lk)("span",Q,(0,i.v_)(V.tripConfig.overview.basicInfo.theme),1)])):(0,n.Q3)("",!0)])])):(0,n.Q3)("",!0),t[17]||(t[17]=(0,n.Lk)("h4",null,"📍 行程亮点",-1)),(0,n.Lk)("ul",D,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(V.tripConfig.overview.highlights,(e,t)=>((0,n.uX)(),(0,n.CE)("li",{key:t},(0,i.v_)(e),1))),128))]),t[18]||(t[18]=(0,n.Lk)("h4",null,"🗓️ 详细行程",-1)),(0,n.Lk)("div",M,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(V.tripConfig.overview.itinerary,(e,t)=>((0,n.uX)(),(0,n.CE)("div",{key:t,class:"itinerary-item"},[(0,n.Lk)("div",K,[(0,n.Lk)("strong",W,(0,i.v_)(e.day),1),e.time?((0,n.uX)(),(0,n.CE)("span",$,"⏰ "+(0,i.v_)(e.time),1)):(0,n.Q3)("",!0)]),(0,n.Lk)("div",F,(0,i.v_)(e.content),1),e.highlight?((0,n.uX)(),(0,n.CE)("div",T,(0,i.v_)(e.highlight),1)):(0,n.Q3)("",!0)]))),128))]),V.tripConfig.overview.budget&&V.tripConfig.overview.budget.items?((0,n.uX)(),(0,n.CE)("div",B,[t[15]||(t[15]=(0,n.Lk)("h4",null,"💰 预算参考",-1)),(0,n.Lk)("table",null,[t[14]||(t[14]=(0,n.Lk)("thead",null,[(0,n.Lk)("tr",null,[(0,n.Lk)("th",null,"项目"),(0,n.Lk)("th",null,"金额（元）"),(0,n.Lk)("th",null,"备注")])],-1)),(0,n.Lk)("tbody",null,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(V.tripConfig.overview.budget.items,(e,t)=>((0,n.uX)(),(0,n.CE)("tr",{key:t},[(0,n.Lk)("td",null,(0,i.v_)(e.name),1),(0,n.Lk)("td",null,"¥"+(0,i.v_)(e.amount),1),(0,n.Lk)("td",null,(0,i.v_)(e.note),1)]))),128)),(0,n.Lk)("tr",U,[t[12]||(t[12]=(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"总计")],-1)),(0,n.Lk)("td",null,[(0,n.Lk)("strong",null,"¥"+(0,i.v_)(V.tripConfig.overview.budget.total),1)]),t[13]||(t[13]=(0,n.Lk)("td",null,"人均预算",-1))])])])])):(0,n.Q3)("",!0),V.tripConfig.overview.tips&&V.tripConfig.overview.tips.length?((0,n.uX)(),(0,n.CE)("div",N,[t[16]||(t[16]=(0,n.Lk)("h4",null,"💡 实用提示",-1)),(0,n.Lk)("ul",P,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(V.tripConfig.overview.tips,(e,t)=>((0,n.uX)(),(0,n.CE)("li",{key:t},(0,i.v_)(e),1))),128))])])):(0,n.Q3)("",!0)]),_:1})):((0,n.uX)(),(0,n.Wv)(Y,{key:3,title:"行程概览"},{default:(0,n.k6)(()=>[...t[19]||(t[19]=[(0,n.Lk)("p",{class:"text-muted text-center"},"行程内容正在筹划中，敬请期待...",-1)])]),_:1})),(0,n.bF)(H,{ref:"commentSectionRef",comments:V.comments,"is-admin":V.isAdmin,"is-author":V.isAuthor,"has-checked-in":V.trip.stats?.checked_in||!1,"get-avatar-url":V.getAvatarUrl,onCheckin:V.handleCheckin,onSubmitComment:V.handleSubmitComment,onDeleteComment:V.handleDeleteComment,onAddImage:V.handleAddImage,onUpdateComment:V.handleUpdateComment,onSubmitReply:V.handleSubmitReply,onLoadReplies:V.handleLoadReplies},null,8,["comments","is-admin","is-author","has-checked-in","get-avatar-url","onCheckin","onSubmitComment","onDeleteComment","onAddImage","onUpdateComment","onSubmitReply","onLoadReplies"])])):(0,n.Q3)("",!0)])],4)}a(4114),a(8111),a(2489),a(116),a(3579);var j=a(144),q=a(8512),G=a(3459),J=a(485),O=a(7277);const Y=async e=>O.A.get("/comments/",{params:e}),H=e=>O.A.post("/comments/",e,{headers:{"Content-Type":"multipart/form-data"}}),z=e=>O.A.delete(`/comments/${e}/`),Z=(e,t)=>O.A.post(`/comments/${e}/add_image/`,t,{headers:{"Content-Type":"multipart/form-data"}}),ee=(e,t)=>O.A.patch(`/comments/${e}/`,t),te=e=>O.A.get(`/comments/${e}/replies/`);var ae=a(2674);const ne={trip:{title:"2025年厦门旅行计划",backgroundColor:"#f0e68c",dates:{start:"2025-06-22",end:"2025-06-24"},icon:"🏖️",overview:{basicInfo:{departure:"南昌",destination:"厦门",transport:"高铁往返（221元×2）",accommodation:"南枫云居酒店（近植物园，2晚）"},highlights:["🏝️ 厦门植物园 - 热带雨林奇观，傍晚光线柔和","🌊 鼓浪屿 - 文艺岛屿，海上花园漫步","🏖️ 曾厝垵 - 文艺小店探秘，体验海滨慢生活","🚴 环岛路 - 海边骑行，欣赏无敌海景","🌅 看日出日落 - 盼归塔/白城沙滩，捕捉最美时刻"],itinerary:[{day:"第一天（6月22日）",time:"14:04抵达",content:"14:04抵达厦门北站 → 入住酒店 → 16:00-18:00厦门植物园（学生票14.86元）→ 沙坡尾/曾厝垵晚餐 → 海边散步/集市",highlight:"🌿 植物园环境优美，适合拍照"},{day:"第二天（6月23日）",time:"05:21日出",content:"4:20起床看日出（盼归塔/白城沙滩）→ 09:00-13:00鼓浪屿 → 14:30-17:30八市+中山路步行街 → 傍晚海边看日落",highlight:"🏝️ 鼓浪屿文艺岛屿；🛍️ 八市烟火气浓厚"},{day:"第三天（6月24日）",time:"15:54返程",content:"上午鸿山公园 → 南普陀寺参拜 → 午餐 → 14:00前往厦门北站 → 15:54高铁返程",highlight:"🏯 普陀寺体验佛教文化"}],budget:{items:[{name:"往返高铁",amount:442,note:"南昌-厦门 221×2"},{name:"景点门票",amount:120,note:"学生票"},{name:"地铁+市内交通",amount:100,note:"含地铁、短打车"},{name:"住宿",amount:800,note:"南枫云居2晚"},{name:"餐饮",amount:600,note:"特色海鲜+小吃"},{name:"其他消费",amount:138,note:"零食、纪念品"}],total:2200},tips:["📸 最佳拍照时间：早晚光线柔和","🌅 日出时间05:21，建议4:20起床","🎫 提前购买学生票，节省费用","🏖️ 提前预定靠近植物园的酒店","🍜 必尝：沙茶面、海蛎煎、花生汤"]}},trip1:{title:"2025年7月三岔河一日游计划",backgroundColor:"#f0e68c",dates:{start:"2025-07-15",end:"2025-07-15"},icon:"🏞️",overview:{basicInfo:{participants:"J.Grigg 和 Leo_Winston",departure:"陆良",destination:"三岔河镇",transport:"自驾/包车",duration:"1天"},highlights:["🏞️ 龙海山·龙凤寺 - 徒步登山，俯瞰全景","💧 白水塘 - 赏荷花，野餐吹风","🌿 紫溪湿地公园 - 赏景拍照，轻松散步","🦢 观鸟胜地 - 邂逅野生鸟类","🌃 三岔河镇夜游 - 感受当地人文"],itinerary:[{day:"上午",time:"08:30-10:00",content:"龙海山·龙凤寺 - 徒步登山，拍照打卡"},{day:"上午",time:"10:00-11:30",content:"白水塘 - 欣赏荷花，野餐吹风"},{day:"中午",time:"11:30-13:00",content:"午饭+休息 - 回家吃饭或附近小吃"},{day:"下午",time:"13:30-15:00",content:"紫溪湿地公园 - 赏景、拍照、轻松散步"},{day:"下午",time:"15:00-16:00",content:"回程+小零食 - 买奶茶奖励一下自己"},{day:"晚上",time:"19:00-20:30",content:"逛三岔河镇 - 晚饭后散步、夜游、感受人文"}],budget:{items:[{name:"交通",amount:100,note:"往返车费/油费"},{name:"餐饮",amount:80,note:"午餐+零食+奶茶"},{name:"门票",amount:20,note:"湿地公园门票"}],total:200},tips:["📸 最佳拍照：清晨/傍晚光线柔和","🎒 建议携带：防晒霜、帽子、水","🌸 荷花最佳观赏期：7-8月","🦢 观鸟最佳时间：清晨或傍晚","🥾 穿舒适的鞋子，便于徒步"]}},trip2:{title:"曲靖市区两日游",backgroundColor:"#f0e68c",dates:{start:"2025-08-10",end:"2025-08-11"},icon:"🏙️",overview:{basicInfo:{participants:"J.Grigg 和 Leo_Winston",departure:"陆良",destination:"曲靖市区",transport:"大巴往返",departureTime:"2025年7月13日 08:00",budget:"约450元/2人"},highlights:["🏛️ 曲靖古城 - 探索历史文化，品味古韵","🍜 过桥米线 - 品尝曲靖地道美食","🌳 麒麟公园 - 城市绿肺，休闲漫步","🏔️ 珠江源风景区 - 探寻珠江之源","🛍️ 南城门商圈 - 特产采购，体验繁华"],itinerary:[{day:"第一天",time:"08:00出发",content:"08:00陆良出发（大巴）→ 抵达曲靖 → 入住酒店 → 曲靖古城游览 → 品尝过桥米线 → 麒麟公园散步 → 晚餐体验本地特色",highlight:"🏛️ 古城历史韵味浓厚"},{day:"第二天",time:"全天",content:"早餐 → 珠江源风景区游览 → 午餐 → 南城门商圈购物 → 采购特产 → 返程回陆良",highlight:"🏔️ 珠江源探秘，购物休闲"}],budget:{items:[{name:"交通",amount:150,note:"大巴往返"},{name:"住宿",amount:80,note:"1晚经济型酒店"},{name:"餐饮",amount:150,note:"过桥米线+特色菜"},{name:"门票",amount:50,note:"景点门票"},{name:"缓冲",amount:20,note:"应急备用"}],total:450},tips:["🍜 必尝：曲靖过桥米线、蒸饵丝","🏛️ 古城最佳游览时间：上午或傍晚","🎒 建议携带：雨伞、防晒用品","🛍️ 特产推荐：曲靖韭菜花、宣威火腿","💰 提前预定酒店，性价比更高"]}},trip3:{title:"昆明三天两夜旅行",backgroundColor:"#f0e68c",dates:{start:"2025-09-01",end:"2025-09-03"},icon:"🌸",overview:{basicInfo:{participants:"J.Grigg 和 Leo_Winston",departureTime:"2025年7月19日 08:00",returnTime:"第三天下午 14:30-18:00",transport:"以地铁/公交为主，步行为辅",budget:"总体不超过450元/人"},highlights:["🎓 西南联大旧址 - 感受历史底蕴，校园人文","🌸 翠湖公园 - 湖边漫步，冬季观红嘴鸥","🏔️ 西山风景区 - 索道俯瞰滇池，龙门石窟","🌊 滇池海埂公园 - 高原明珠，拍照圣地","🍄 野生菌火锅 - 云南特色，舌尖享受","🎡 公园1903 - 欧式建筑，摩天轮打卡"],itinerary:[{day:"第一天（城市文艺线）",time:"08:00-22:00",content:"08:00-12:00 出发+抵达昆明+地铁前往西南联大 → 12:00-13:00 文林街午餐（米线/烧烤）→ 13:00-15:00 西南联大旧址&云南大学 → 15:00-17:00 文林街+文化巷+翠湖公园 → 17:00-18:00 陆军讲武堂 → 18:00-19:30 晚餐 → 20:00-21:30 文林街周围散步 → 22:00入住酒店",highlight:"🎓 感受大学城文艺气息，历史建筑拍照"},{day:"第二天（山水自然线）",time:"07:00-22:00",content:"07:00-08:00 早餐（豆浆+烧饵块/小锅米线）→ 08:00-12:30 西山风景区（龙门），地铁3号线+索道俯瞰滇池 → 12:30-13:30 午餐 → 14:00-16:00 滇池海埂公园漫步拍照 → 16:30-18:00 公园1903（欧式建筑/摩天轮）→ 18:30-20:00 晚餐（炸洋芋/烧烤）→ 20:30-22:00 返回酒店休息",highlight:"🏔️ 西山龙门+滇池美景，自然风光满分"},{day:"第三天（悠闲市井线）",time:"07:30-18:00",content:"07:30-08:30 早餐+退房 → 09:00-11:00 东南亚风情市场+湖滨生态湿地公园 → 11:30-13:00 午饭 → 13:00-14:30 自由活动/补拍打卡/采购伴手礼 → 14:30-18:00 返程回陆良",highlight:"🛍️ 体验市井生活，采购云南特产"}],budget:{items:[{name:"交通",amount:150,note:"往返+地铁/公交"},{name:"住宿",amount:160,note:"2晚经济型酒店"},{name:"餐饮",amount:100,note:"米线+野生菌+小吃"},{name:"门票",amount:40,note:"西山龙门+公园"}],total:450},tips:["🚇 购买地铁一日票，更划算","🍄 野生菌季节（6-10月），必尝菌火锅","🌸 翠湖冬季（11月-3月）可观红嘴鸥","☀️ 昆明紫外线强，注意防晒","🏨 提前预定靠近地铁站的酒店","📸 西山龙门索道俯瞰滇池，最佳拍照点","💰 文林街小吃性价比高"]}},trip4:{title:"长沙3天2夜慢旅行",backgroundColor:"#f0e68c",dates:{start:"2025-10-01",end:"2025-10-03"},icon:"🌶️",customStyles:{specialBg:"linear-gradient(135deg, #e8f4fd 0%, #d1ecf1 100%)",dayBorderColor:"#ff6b6b"},overview:{basicInfo:{destination:"长沙",transport:"高铁往返",duration:"3天2夜",theme:"美食+文化+娱乐"},highlights:["🏮 橘子洲头 - 毛泽东青年艺术雕塑，湘江美景","🌶️ 太平街 - 长沙臭豆腐、糖油粑粑、小龙虾",'🏛️ 岳麓书院 - 千年学府，"惟楚有材，于斯为盛"',"🍂 爱晚亭 - 杜牧《山行》取景地","🎭 湖南卫视 - 娱乐之都，芒果台打卡","🏛️ 湖南省博物馆 - 马王堆汉墓，辛追夫人","🍜 解放西路 - 夜生活圣地，酒吧一条街"],itinerary:[{day:"第一天（城市初体验）",time:"全天",content:"抵达长沙 → 入住酒店 → 橘子洲头（地铁2号线）看湘江+毛泽东雕塑 → 太平街美食街（臭豆腐/糖油粑粑/茶颜悦色）→ 黄兴路步行街 → 解放西路酒吧街夜生活",highlight:"🏮 感受长沙烟火气，品尝地道小吃"},{day:"第二天（文化深度游）",time:"全天",content:"岳麓山徒步（索道上山，步行下山）→ 岳麓书院（门票50元）→ 爱晚亭拍照 → 湖南大学校园 → 河西大学城美食 → 湘江边散步看夜景",highlight:"🏛️ 千年学府文化熏陶，山水之间徒步"},{day:"第三天（博物馆+购物）",time:"返程前",content:"湖南省博物馆（马王堆汉墓，需预约）→ IFS国金中心/五一广场购物 → 打卡网红店 → 采购特产（酱板鸭/槟榔/辣条）→ 高铁返程",highlight:"🏛️ 探秘两千年古墓，现代与历史交融"}],budget:{items:[{name:"高铁往返",amount:800,note:"二等座"},{name:"住宿",amount:600,note:"2晚市中心酒店"},{name:"餐饮",amount:500,note:"湘菜+小吃+奶茶"},{name:"门票",amount:100,note:"岳麓书院50+索道"},{name:"市内交通",amount:50,note:"地铁+公交"}],total:2050},tips:["🌶️ 长沙菜偏辣，不吃辣提前说明","🎫 湖南省博物馆需提前3天预约","☕ 茶颜悦色是长沙特色奶茶，必打卡","🚇 办理长沙地铁3日卡更划算","🏨 住五一广场/黄兴路附近，交通便利","📸 橘子洲烟花：每周六晚20:30（夏季）","🍜 必吃：文和友、炊烟时代小炒黄牛肉"]}}},ie=e=>ne[e]||{title:"旅行计划",backgroundColor:"#f0e68c",dates:null,icon:"🗺️"};var se=a(432);const le={class:"card"},oe={class:"card-body"},re={class:"progress-container"},ce={key:0,class:"text-muted text-center mt-3 mb-0"};function de(e,t,a,s,l,o){return(0,n.uX)(),(0,n.CE)("div",le,[(0,n.Lk)("div",oe,[t[0]||(t[0]=(0,n.Lk)("h3",{class:"mb-3"},"🌊 旅行进度条",-1)),(0,n.Lk)("div",re,[(0,n.Lk)("div",{class:"progress-bar",style:(0,i.Tr)({width:s.progress+"%"})},(0,i.v_)(s.progress)+"% ",5)]),s.message?((0,n.uX)(),(0,n.CE)("p",ce,(0,i.v_)(s.message),1)):(0,n.Q3)("",!0)])])}var ue={name:"TripProgress",props:{startDate:{type:String,default:null},endDate:{type:String,default:null}},setup(e){const t=(0,j.KR)(0),a=(0,j.KR)(""),i=()=>{if(!e.startDate||!e.endDate)return t.value=50,void(a.value="旅行进度加载中...");const n=new Date,i=new Date(e.startDate),s=new Date(e.endDate);if(n<i)t.value=0,a.value="旅行即将开始！";else if(n>s)t.value=100,a.value="旅行已结束，期待下次旅程！";else{const e=s-i,l=n-i;t.value=Math.round(l/e*100),a.value=`旅行进行中，已完成 ${t.value}%`}};return(0,n.sV)(()=>{i()}),{progress:t,message:a}}},me=a(1241);const pe=(0,me.A)(ue,[["render",de],["__scopeId","data-v-3d7e4ff4"]]);var ve=pe;const ge={class:"stats-card"},ke={class:"stats-container"},be={class:"stat-item"},ye={class:"stat-text"},he={class:"stat-item"},fe={class:"stat-text"},Ce=["disabled"],Le={key:0,class:"spinner-border spinner-border-sm me-2"};function we(e,t,a,s,l,o){return(0,n.uX)(),(0,n.CE)("div",ge,[(0,n.Lk)("div",ke,[(0,n.Lk)("div",be,[t[2]||(t[2]=(0,n.Lk)("span",{class:"stat-icon"},"👁️",-1)),(0,n.Lk)("span",ye,[t[1]||(t[1]=(0,n.eW)("浏览量：",-1)),(0,n.Lk)("strong",null,(0,i.v_)(a.views),1)])]),t[5]||(t[5]=(0,n.Lk)("div",{class:"stat-divider"},"｜",-1)),(0,n.Lk)("div",he,[t[4]||(t[4]=(0,n.Lk)("span",{class:"stat-icon"},"❤️",-1)),(0,n.Lk)("span",fe,[t[3]||(t[3]=(0,n.eW)("点赞：",-1)),(0,n.Lk)("strong",null,(0,i.v_)(a.likes),1)])])]),(0,n.Lk)("button",{class:"like-btn",onClick:t[0]||(t[0]=(...e)=>s.handleLike&&s.handleLike(...e)),disabled:s.liking},[s.liking?((0,n.uX)(),(0,n.CE)("span",Le)):(0,n.Q3)("",!0),(0,n.eW)(" 👍 "+(0,i.v_)(s.liking?"点赞中...":"点赞"),1)],8,Ce)])}var _e={name:"TripStats",props:{views:{type:Number,default:0},likes:{type:Number,default:0}},emits:["like"],setup(e,{emit:t}){const a=(0,j.KR)(!1),n=async()=>{a.value=!0;try{await t("like")}finally{setTimeout(()=>{a.value=!1},500)}};return{liking:a,handleLike:n}}};const Ee=(0,me.A)(_e,[["render",we],["__scopeId","data-v-a55143a6"]]);var Ie=Ee;const Re={class:"card"},Xe={class:"card-body"},Se={class:"mb-3"};function xe(e,t,a,s,l,o){return(0,n.uX)(),(0,n.CE)("div",Re,[(0,n.Lk)("div",Xe,[(0,n.Lk)("h3",Se,"📋 "+(0,i.v_)(a.title),1),(0,n.RG)(e.$slots,"default",{},void 0,!0)])])}var Ae={name:"TripOverview",props:{title:{type:String,default:"行程概览"}}};const Qe=(0,me.A)(Ae,[["render",xe],["__scopeId","data-v-f357579e"]]);var De=Qe,Me=a(5130);const Ke={class:"card"},We={class:"card-body"},$e={class:"checkin-section mb-4"},Fe=["disabled"],Te={key:0,class:"spinner-border spinner-border-sm me-2"},Be={key:0,class:"text-success mt-2 mb-0"},Ue={class:"comment-list"},Ne={class:"d-flex justify-content-between align-items-center mb-3"},Pe={class:"mb-0"},Ve={key:0,class:"text-center text-muted py-4"},je=["onClick"],qe=["onClick"],Ge=["onClick","title"],Je=["onClick"],Oe=["onClick"],Ye=["src"];function He(e,t,a,s,l,o){const r=(0,n.g2)("CommentForm"),c=(0,n.g2)("ReplySection"),d=(0,n.g2)("CommentItem");return(0,n.uX)(),(0,n.CE)("div",Ke,[(0,n.Lk)("div",We,[t[5]||(t[5]=(0,n.Lk)("h3",{class:"mb-4"},"📍 打卡与留言",-1)),(0,n.Lk)("div",$e,[(0,n.Lk)("button",{class:"btn btn-success btn-lg",onClick:t[0]||(t[0]=(...e)=>s.handleCheckin&&s.handleCheckin(...e)),disabled:s.checking||a.hasCheckedIn},[s.checking?((0,n.uX)(),(0,n.CE)("span",Te)):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,i.v_)(s.checkinButtonText),1)],8,Fe),a.hasCheckedIn?((0,n.uX)(),(0,n.CE)("p",Be," ✅ 您已打卡成功！ ")):(0,n.Q3)("",!0)]),a.isAuthor?((0,n.uX)(),(0,n.Wv)(r,{key:0,submitting:s.submitting,onSubmit:s.handleSubmit},null,8,["submitting","onSubmit"])):(0,n.Q3)("",!0),(0,n.Lk)("div",Ue,[(0,n.Lk)("div",Ne,[(0,n.Lk)("h5",Pe,"评论列表 ("+(0,i.v_)(a.comments.length)+"条)",1),s.hasManageableComments?((0,n.uX)(),(0,n.CE)("button",{key:0,class:(0,i.C4)(["btn btn-sm",s.isManageMode?"btn-secondary":"btn-outline-secondary"]),onClick:t[1]||(t[1]=(...e)=>s.toggleManageMode&&s.toggleManageMode(...e)),title:"管理评论"},(0,i.v_)(s.isManageMode?"完成管理":"管理评论"),3)):(0,n.Q3)("",!0)]),0===a.comments.length?((0,n.uX)(),(0,n.CE)("div",Ve," 暂无评论，快来留下第一条评论吧！ ")):(0,n.Q3)("",!0),((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.comments,e=>((0,n.uX)(),(0,n.Wv)(d,{key:e.id,comment:e,editing:void 0!==s.editingComments[e.id]&&!1!==s.editingComments[e.id],"is-expanded":s.expandedReplies[e.id]||!1,"reply-count":(s.replyLists[e.id]||[]).length,replies:s.replyLists[e.id]||[],"get-avatar-url":a.getAvatarUrl,onShowImageModal:s.showImageModal,onToggleReply:s.toggleReplySection,"onUpdate:content":t=>s.updateLocalContent(e.id,t)},{actions:(0,n.k6)(()=>[s.isManageMode?((0,n.uX)(),(0,n.CE)(n.FK,{key:0},[e.can_delete&&!s.editingComments[e.id]?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-sm btn-outline-primary",onClick:t=>s.startEditing(e.id,e.content),title:"编辑评论"}," ✏️ ",8,je)):(0,n.Q3)("",!0),s.editingComments[e.id]?((0,n.uX)(),(0,n.CE)("button",{key:1,class:"btn btn-sm btn-success",onClick:t=>s.handleSaveComment(e.id),title:"保存修改"}," ✓ ",8,qe)):(0,n.Q3)("",!0),s.canAddImage(e)&&s.editingComments[e.id]?((0,n.uX)(),(0,n.CE)("button",{key:2,class:"btn btn-sm btn-outline-success",onClick:t=>s.handleAddImage(e.id),title:e.image?"替换图片":"添加图片"}," 📷 ",8,Ge)):(0,n.Q3)("",!0),s.editingComments[e.id]?((0,n.uX)(),(0,n.CE)("button",{key:3,class:"btn btn-sm btn-outline-secondary",onClick:t=>s.cancelEditing(e.id),title:"取消"}," ✕ ",8,Je)):(0,n.Q3)("",!0),e.can_delete?((0,n.uX)(),(0,n.CE)("button",{key:4,class:"btn btn-sm btn-outline-danger",onClick:t=>s.handleDelete(e.id),title:"删除这条评论"}," 🗑️ ",8,Oe)):(0,n.Q3)("",!0)],64)):(0,n.Q3)("",!0)]),replies:(0,n.k6)(()=>[s.expandedReplies[e.id]?((0,n.uX)(),(0,n.Wv)(c,{key:0,expanded:s.expandedReplies[e.id],replies:s.replyLists[e.id]||[],submitting:s.submittingReply[e.id]||!1,"get-avatar-url":a.getAvatarUrl,onSubmit:t=>s.handleSubmitReply(e.id,t),onCancel:()=>s.cancelReply(e.id),onDeleteReply:s.handleDeleteReply},null,8,["expanded","replies","submitting","get-avatar-url","onSubmit","onCancel","onDeleteReply"])):(0,n.Q3)("",!0)]),_:2},1032,["comment","editing","is-expanded","reply-count","replies","get-avatar-url","onShowImageModal","onToggleReply","onUpdate:content"]))),128))])]),s.showModal?((0,n.uX)(),(0,n.CE)("div",{key:0,class:"image-modal",onClick:t[4]||(t[4]=(...e)=>s.closeImageModal&&s.closeImageModal(...e))},[(0,n.Lk)("div",{class:"modal-content",onClick:t[3]||(t[3]=(0,Me.D$)(()=>{},["stop"]))},[(0,n.Lk)("button",{class:"close-button",onClick:t[2]||(t[2]=(...e)=>s.closeImageModal&&s.closeImageModal(...e))},"✕"),(0,n.Lk)("img",{src:s.modalImageUrl,alt:"放大图片"},null,8,Ye)])])):(0,n.Q3)("",!0)])}const ze={class:"comment-form mb-4"},Ze={class:"mb-3"},et={class:"row mb-3"},tt={class:"col-md-6 mb-2"},at={class:"col-md-6 mb-2"},nt=["disabled"],it={key:0,class:"spinner-border spinner-border-sm me-2"};function st(e,t,a,s,l,o){return(0,n.uX)(),(0,n.CE)("div",ze,[t[6]||(t[6]=(0,n.Lk)("h5",{class:"mb-3"},"发表评论",-1)),(0,n.Lk)("form",{onSubmit:t[3]||(t[3]=(0,Me.D$)((...e)=>s.handleSubmit&&s.handleSubmit(...e),["prevent"]))},[(0,n.Lk)("div",Ze,[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.formData.content=e),class:"form-control",rows:"4",placeholder:"分享你的旅行故事...",required:""},null,512),[[Me.Jo,s.formData.content]])]),(0,n.Lk)("div",et,[(0,n.Lk)("div",tt,[t[4]||(t[4]=(0,n.Lk)("label",{class:"form-label"},"上传图片",-1)),(0,n.Lk)("input",{type:"file",class:"form-control",accept:"image/*",onChange:t[1]||(t[1]=(...e)=>s.handleImageChange&&s.handleImageChange(...e))},null,32)]),(0,n.Lk)("div",at,[t[5]||(t[5]=(0,n.Lk)("label",{class:"form-label"},"上传视频",-1)),(0,n.Lk)("input",{type:"file",class:"form-control",accept:"video/*",onChange:t[2]||(t[2]=(...e)=>s.handleVideoChange&&s.handleVideoChange(...e))},null,32)])]),(0,n.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:a.submitting},[a.submitting?((0,n.uX)(),(0,n.CE)("span",it)):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,i.v_)(a.submitting?"发布中...":"发布评论"),1)],8,nt)],32)])}var lt={name:"CommentForm",props:{submitting:{type:Boolean,default:!1}},emits:["submit"],setup(e,{emit:t}){const a=(0,j.KR)({content:"",image:null,video:null}),n=e=>{a.value.image=e.target.files[0]},i=e=>{a.value.video=e.target.files[0]},s=()=>{t("submit",{content:a.value.content,image:a.value.image,video:a.value.video}),a.value={content:"",image:null,video:null}};return{formData:a,handleImageChange:n,handleVideoChange:i,handleSubmit:s}}};const ot=(0,me.A)(lt,[["render",st],["__scopeId","data-v-362e9ac8"]]);var rt=ot;const ct={class:"comment-item"},dt={class:"d-flex align-items-start"},ut=["src"],mt={class:"flex-grow-1"},pt={class:"d-flex justify-content-between align-items-center mb-2"},vt={class:"d-flex gap-2 align-items-center"},gt={class:"text-muted"},kt={key:0,class:"mb-2"},bt={key:1,class:"mb-2"},yt={key:2,class:"mb-2 comment-media"},ht=["src"],ft={key:3,class:"mb-2 comment-media"},Ct=["src"],Lt={class:"mt-3 pt-2 border-top border-light d-flex gap-2 align-items-center"},wt={key:0,class:"text-muted small"},_t={key:0,class:"replies-container"};function Et(e,t,a,s,l,o){return(0,n.uX)(),(0,n.CE)("div",ct,[(0,n.Lk)("div",dt,[(0,n.Lk)("img",{src:a.getAvatarUrl(a.comment.user.profile?.avatar_url),class:"rounded-circle me-3",width:"48",height:"48",alt:"avatar",onError:t[0]||(t[0]=e=>{console.log("头像加载失败:",a.comment.user),e.target.src="/static/images/default_avatar.png"})},null,40,ut),(0,n.Lk)("div",mt,[(0,n.Lk)("div",pt,[(0,n.Lk)("strong",null,(0,i.v_)(a.comment.user.username),1),(0,n.Lk)("div",vt,[(0,n.Lk)("small",gt,(0,i.v_)(s.formatDate(a.comment.timestamp)),1),(0,n.RG)(e.$slots,"actions",{},void 0,!0)])]),a.editing?((0,n.uX)(),(0,n.CE)("div",kt,[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[1]||(t[1]=e=>s.localContent=e),class:"form-control",rows:"3",placeholder:"编辑评论内容..."},null,512),[[Me.Jo,s.localContent]])])):((0,n.uX)(),(0,n.CE)("p",bt,(0,i.v_)(a.comment.content),1)),a.comment.image?((0,n.uX)(),(0,n.CE)("div",yt,[(0,n.Lk)("img",{src:a.comment.image,class:"comment-image rounded",style:{cursor:"pointer"},onClick:t[2]||(t[2]=t=>e.$emit("show-image-modal",a.comment.image)),alt:"评论图片"},null,8,ht)])):(0,n.Q3)("",!0),a.comment.video?((0,n.uX)(),(0,n.CE)("div",ft,[(0,n.Lk)("video",{src:a.comment.video,controls:"",class:"rounded"}," 您的浏览器不支持视频播放 ",8,Ct)])):(0,n.Q3)("",!0),(0,n.Lk)("div",Lt,[(0,n.Lk)("button",{class:"btn btn-sm btn-link text-primary p-0 reply-toggle-btn",onClick:t[3]||(t[3]=t=>e.$emit("toggle-reply",a.comment.id))}," 💬 "+(0,i.v_)(a.isExpanded?"收起回复":"回复"),1),a.replyCount?((0,n.uX)(),(0,n.CE)("span",wt," ("+(0,i.v_)(a.replyCount)+"条回复) ",1)):(0,n.Q3)("",!0)])])]),a.isExpanded?((0,n.uX)(),(0,n.CE)("div",_t,[(0,n.RG)(e.$slots,"replies",{},void 0,!0)])):(0,n.Q3)("",!0)])}var It={name:"CommentItem",props:{comment:{type:Object,required:!0},editing:{type:Boolean,default:!1},isExpanded:{type:Boolean,default:!1},replyCount:{type:Number,default:0},replies:{type:Array,default:()=>[]},getAvatarUrl:{type:Function,required:!0}},emits:["show-image-modal","toggle-reply","update:content"],setup(e,{emit:t}){const a=(0,j.KR)(e.comment.content);(0,n.wB)(()=>e.comment.content,e=>{a.value=e}),(0,n.wB)(a,e=>{t("update:content",e)});const i=e=>{const t=new Date(e),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return`${a}-${n}-${i} ${s}:${l}`};return{localContent:a,formatDate:i}}};const Rt=(0,me.A)(It,[["render",Et],["__scopeId","data-v-67f7ae3b"]]);var Xt=Rt;const St={key:0,class:"reply-section"},xt={class:"reply-form mb-3"},At={class:"mt-2 d-flex gap-2"},Qt=["disabled"],Dt={key:0,class:"spinner-border spinner-border-sm me-1"},Mt={key:0,class:"reply-list"},Kt={class:"d-flex align-items-start"},Wt=["src"],$t={class:"flex-grow-1"},Ft={class:"d-flex justify-content-between align-items-center mb-1"},Tt={class:"small"},Bt={class:"d-flex gap-2 align-items-center"},Ut={class:"text-muted"},Nt=["onClick"],Pt={class:"mb-0 small"};function Vt(e,t,a,s,l,o){return a.expanded?((0,n.uX)(),(0,n.CE)("div",St,[(0,n.Lk)("div",xt,[(0,n.bo)((0,n.Lk)("textarea",{"onUpdate:modelValue":t[0]||(t[0]=e=>s.replyContent=e),class:"form-control form-control-sm",rows:"2",placeholder:"写下你的回复..."},null,512),[[Me.Jo,s.replyContent]]),(0,n.Lk)("div",At,[(0,n.Lk)("button",{class:"btn btn-sm btn-primary",onClick:t[1]||(t[1]=(...e)=>s.handleSubmit&&s.handleSubmit(...e)),disabled:a.submitting},[a.submitting?((0,n.uX)(),(0,n.CE)("span",Dt)):(0,n.Q3)("",!0),(0,n.eW)(" "+(0,i.v_)(a.submitting?"提交中...":"提交回复"),1)],8,Qt),(0,n.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:t[2]||(t[2]=(...e)=>s.handleCancel&&s.handleCancel(...e))}," 取消 ")])]),a.replies&&a.replies.length>0?((0,n.uX)(),(0,n.CE)("div",Mt,[((0,n.uX)(!0),(0,n.CE)(n.FK,null,(0,n.pI)(a.replies,t=>((0,n.uX)(),(0,n.CE)("div",{key:t.id,class:"reply-item mt-2 ps-3 border-start border-secondary"},[(0,n.Lk)("div",Kt,[(0,n.Lk)("img",{src:a.getAvatarUrl(t.user.profile?.avatar_url),class:"rounded-circle me-2",width:"32",height:"32",alt:"avatar"},null,8,Wt),(0,n.Lk)("div",$t,[(0,n.Lk)("div",Ft,[(0,n.Lk)("strong",Tt,(0,i.v_)(t.user.username),1),(0,n.Lk)("div",Bt,[(0,n.Lk)("small",Ut,(0,i.v_)(s.formatDate(t.timestamp)),1),t.can_delete?((0,n.uX)(),(0,n.CE)("button",{key:0,class:"btn btn-sm p-0 text-danger",style:{border:"none",background:"none","font-size":"0.8rem"},onClick:a=>e.$emit("delete-reply",t.id),title:"删除此回复"}," 🗑️ ",8,Nt)):(0,n.Q3)("",!0)])]),(0,n.Lk)("p",Pt,(0,i.v_)(t.content),1)])])]))),128))])):(0,n.Q3)("",!0)])):(0,n.Q3)("",!0)}var jt={name:"ReplySection",props:{expanded:{type:Boolean,default:!1},replies:{type:Array,default:()=>[]},submitting:{type:Boolean,default:!1},getAvatarUrl:{type:Function,required:!0}},emits:["submit","cancel","delete-reply"],setup(e,{emit:t}){const a=(0,j.KR)("");(0,n.wB)(()=>e.expanded,e=>{e||(a.value="")});const i=()=>{const e=a.value.trim();e&&(t("submit",e),a.value="")},s=()=>{a.value="",t("cancel")},l=e=>{const t=new Date(e),a=t.getFullYear(),n=String(t.getMonth()+1).padStart(2,"0"),i=String(t.getDate()).padStart(2,"0"),s=String(t.getHours()).padStart(2,"0"),l=String(t.getMinutes()).padStart(2,"0");return`${a}-${n}-${i} ${s}:${l}`};return{replyContent:a,handleSubmit:i,handleCancel:s,formatDate:l}}};const qt=(0,me.A)(jt,[["render",Vt],["__scopeId","data-v-5253a071"]]);var Gt=qt,Jt={name:"CommentSection",components:{CommentForm:rt,CommentItem:Xt,ReplySection:Gt},props:{comments:{type:Array,default:()=>[]},isAdmin:{type:Boolean,default:!1},isAuthor:{type:Boolean,default:!1},hasCheckedIn:{type:Boolean,default:!1},getAvatarUrl:{type:Function,required:!0}},emits:["checkin","submit-comment","delete-comment","add-image","update-comment","submit-reply","load-replies"],setup(e,{emit:t}){const a=(0,j.KR)(!1),i=(0,j.KR)(!1),s=(0,j.KR)({}),l=(0,j.KR)(!1),o=(0,j.KR)(!1),r=(0,j.KR)(""),c=(0,j.KR)({}),d=(0,j.KR)({}),u=(0,j.KR)({}),m=(0,j.KR)({}),p=(0,j.KR)({}),v=(0,n.EW)(()=>e.comments.some(e=>e.can_delete)),g=(0,n.EW)(()=>e.hasCheckedIn?"✓ 已打卡":a.value?"打卡中...":"📍 我来过这里"),k=async()=>{a.value=!0;try{await t("checkin")}finally{setTimeout(()=>{a.value=!1},500)}},b=async e=>{i.value=!0;try{await t("submit-comment",e)}finally{i.value=!1}},y=e=>{t("delete-comment",e)},h=e=>{r.value=e,o.value=!0},f=()=>{o.value=!1,r.value=""},C=e=>!e.video&&e.can_delete,L=(e,t)=>{s.value[e]={isEditing:!0,content:t}},w=e=>{s.value[e]=!1},_=(e,t)=>{s.value[e]&&(s.value[e].content=t)},E=e=>{const a=s.value[e]?.content;a&&a.trim()&&(t("update-comment",{commentId:e,content:a.trim()}),s.value[e]=!1)},I=()=>{l.value=!l.value,l.value||(s.value={})},R=e=>{const a=document.createElement("input");a.type="file",a.accept="image/*",a.onchange=a=>{const n=a.target.files[0];n&&(t("add-image",{commentId:e,file:n}),s.value[e]=!1)},a.click()},X=e=>{c.value[e]=!c.value[e],c.value[e]&&(d.value[e]||(d.value[e]={content:""}),void 0===u.value[e]&&(u.value[e]=!1),m.value[e]||(m.value[e]=[],t("load-replies",e)))},S=async(e,a)=>{u.value[e]=!0;try{await t("submit-reply",{commentId:e,content:a}),d.value[e].content=""}catch(n){console.error("提交回复失败:",n),alert("提交回复失败")}finally{u.value[e]=!1}},x=e=>{d.value[e].content=""},A=e=>{t("delete-comment",e)},Q=(e,t)=>{m.value={...m.value,[e]:t||[]}};return{checking:a,submitting:i,editingComments:s,isManageMode:l,hasManageableComments:v,checkinButtonText:g,expandedReplies:c,replyForms:d,submittingReply:u,replyLists:m,replyCounts:p,showModal:o,modalImageUrl:r,handleCheckin:k,handleSubmit:b,handleDelete:y,showImageModal:h,closeImageModal:f,canAddImage:C,startEditing:L,cancelEditing:w,updateLocalContent:_,handleSaveComment:E,toggleManageMode:I,handleAddImage:R,toggleReplySection:X,handleSubmitReply:S,cancelReply:x,handleDeleteReply:A,updateReplyList:Q}}};const Ot=(0,me.A)(Jt,[["render",He],["__scopeId","data-v-c7c194aa"]]);var Yt=Ot,Ht={name:"TripDetailView",components:{NavBar:se.A,TripProgress:ve,TripStats:Ie,TripOverview:De,CommentSection:Yt},setup(){const e=(0,q.lq)(),t=(0,q.rd)(),a=(0,G.k)(),i=(0,j.KR)(null),s=(0,j.KR)([]),l=(0,j.KR)(!0),o=(0,j.KR)(null),r=(0,j.KR)(!1),c=(0,j.KR)(null),d=(0,n.EW)(()=>i.value?.background_music||"/static/music/rain.mp3"),u=(0,n.EW)(()=>a.isAdmin),m=(0,n.EW)(()=>i.value?.author?.id===a.userInfo?.id),p=async()=>{const a=e.params.slug;try{if(i.value=await(0,J.B)(a),i.value.overview){const e={...i.value.overview};e.budget&&e.budget.summary&&(e.budget.total=e.budget.summary),o.value={dates:{start:i.value.start_date,end:i.value.end_date},overview:e}}else o.value=ie(a);(i.value?.name||i.value?.title)&&(document.title=`${i.value.name||i.value.title}`)}catch(n){console.error("获取旅行详情失败:",n),404!==n.response?.status&&404!==n.status||(alert("旅行页面不存在"),t.push("/"))}},v=async()=>{const t=e.params.slug;try{const e=await Y({trip:t});s.value=e.results||e||[]}catch(a){console.error("获取评论列表失败:",a),s.value=[]}finally{l.value=!1}},g=async()=>{try{const t=await(0,J.nN)(e.params.slug);i.value.stats.likes=t.likes,alert("点赞成功！")}catch(t){console.error("点赞失败:",t),alert("点赞失败，请稍后重试")}},k=async()=>{try{await(0,J.jw)(e.params.slug),alert("打卡成功！"),await p()}catch(t){console.error("打卡失败:",t),alert("打卡失败，请稍后重试")}},b=async t=>{try{const a=new FormData;a.append("page",e.params.slug),t.content&&a.append("content",t.content),t.image&&a.append("image",t.image),t.video&&a.append("video",t.video),await H(a),alert("评论发表成功！"),await v()}catch(a){console.error("发表评论失败:",a),alert("发表评论失败："+a.message)}},y=async e=>{if(!confirm("确定要删除这条内容吗？删除后无法恢复。"))return;try{await z(e)}catch(l){console.error("删除评论失败:",l);const e=l.response?.data?.detail||l.message||"删除失败，请稍后重试";return void alert(e)}const t=s.value.find(t=>t.id===e);if(!t){for(const t of s.value)if(L.value&&L.value.replyLists){const a=L.value.replyLists[t.id];if(a&&a.some(t=>t.id===e)){const n=a.filter(t=>t.id!==e);return void(L.value.updateReplyList&&L.value.updateReplyList(t.id,n))}}return}const a=!!t.parent_id,n=t.parent_id;let i=null;a?(i=s.value.find(e=>e.id===n),i&&i.replies&&(i.replies=i.replies.filter(t=>t.id!==e),L.value&&L.value.updateReplyList&&L.value.updateReplyList(n,i.replies))):s.value=s.value.filter(t=>t.id!==e)},h=async({commentId:e,file:t})=>{try{const a=new FormData;a.append("image",t),await Z(e,a),alert("图片添加成功！"),await v()}catch(a){console.error("添加图片失败:",a),alert("添加图片失败："+(a.response?.data?.detail||a.message))}},f=async({commentId:e,content:t})=>{try{await ee(e,{content:t}),alert("评论更新成功！"),await v()}catch(a){console.error("更新评论失败:",a),alert("更新评论失败："+(a.response?.data?.detail||a.message))}},C=async({commentId:t,content:a})=>{try{const n=new FormData;n.append("content",a),n.append("page",e.params.slug),n.append("parent",t),await H(n),alert("回复成功！"),await w(t)}catch(n){console.error("提交回复失败:",n),alert("提交回复失败："+(n.response?.data?.detail||n.message))}},L=(0,j.KR)(null),w=async e=>{try{const t=await te(e),a=s.value.find(t=>t.id===e);a&&(a.replies=t||[]),await new Promise(e=>setTimeout(e,100)),L.value&&L.value.updateReplyList&&L.value.updateReplyList(e,t||[])}catch(t){console.error(`加载评论 ${e} 的回复列表失败:`,t)}},_=()=>{t.push("/")},E=async()=>{if(c.value){if(r.value)c.value.pause();else try{c.value.volume=.3,await c.value.play()}catch(e){console.error("播放音乐失败:",e)}r.value=!r.value}};return(0,n.sV)(async()=>{await p(),await v()}),{trip:i,comments:s,loading:l,tripConfig:o,isAdmin:u,isPlaying:r,audioPlayer:c,musicSrc:d,commentSectionRef:L,handleLike:g,handleCheckin:k,handleSubmitComment:b,handleDeleteComment:y,handleAddImage:h,handleUpdateComment:f,handleSubmitReply:C,handleLoadReplies:w,goBack:_,toggleMusic:E,getAvatarUrl:ae.TW,isAuthor:m}}};const zt=(0,me.A)(Ht,[["render",V],["__scopeId","data-v-82627388"]]);var Zt=zt}}]);
//# sourceMappingURL=75.3e46d3e2.js.map