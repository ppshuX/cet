"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[279,682],{432:function(e,t,n){n.d(t,{A:function(){return C}});var s=n(6768),a=n(4232),r=n(5130);const l={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},i={class:"container-fluid"},o={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},c={class:"navbar-nav me-auto"},u={class:"nav-item"},d={key:0,class:"nav-item"},p={class:"d-flex align-items-center"},b={key:0,class:"dropdown dropdown-end"},k={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},m=["src"],v={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function g(e,t,n,g,f,L){const y=(0,s.g2)("router-link");return(0,s.uX)(),(0,s.CE)("nav",l,[(0,s.Lk)("div",i,[(0,s.bF)(y,{to:"/",class:"navbar-brand"},{default:(0,s.k6)(()=>[...t[1]||(t[1]=[(0,s.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),t[9]||(t[9]=(0,s.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,s.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,s.Lk)("div",o,[(0,s.Lk)("ul",c,[(0,s.Lk)("li",u,[(0,s.bF)(y,{to:"/",class:"nav-link"},{default:(0,s.k6)(()=>[...t[2]||(t[2]=[(0,s.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,s.eW)(" æ—…è¡Œå¤§åŽ… ",-1)])]),_:1})]),g.isLoggedIn?((0,s.uX)(),(0,s.CE)("li",d,[(0,s.bF)(y,{to:"/my-trips/",class:"nav-link"},{default:(0,s.k6)(()=>[...t[3]||(t[3]=[(0,s.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,s.eW)(" æˆ‘çš„æ—…è¡Œ ",-1)])]),_:1})])):(0,s.Q3)("",!0)]),(0,s.Lk)("div",p,[g.isLoggedIn?((0,s.uX)(),(0,s.CE)("div",b,[(0,s.Lk)("a",k,[(0,s.Lk)("img",{src:g.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,m),(0,s.Lk)("span",null,(0,a.v_)(g.username),1)]),(0,s.Lk)("ul",v,[(0,s.Lk)("li",null,[(0,s.bF)(y,{to:"/user/center",class:"dropdown-item"},{default:(0,s.k6)(()=>[...t[4]||(t[4]=[(0,s.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,s.eW)("ä¸ªäººä¸­å¿ƒ ",-1)])]),_:1})]),t[6]||(t[6]=(0,s.Lk)("li",null,[(0,s.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,s.Lk)("li",null,[(0,s.Lk)("a",{href:"#",class:"dropdown-item",onClick:t[0]||(t[0]=(0,r.D$)((...e)=>g.handleLogout&&g.handleLogout(...e),["prevent"]))},[...t[5]||(t[5]=[(0,s.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,s.eW)("é€€å‡ºç™»å½• ",-1)])])])])])):((0,s.uX)(),(0,s.CE)(s.FK,{key:1},[(0,s.bF)(y,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,s.k6)(()=>[...t[7]||(t[7]=[(0,s.eW)(" ç™»å½• ",-1)])]),_:1}),(0,s.bF)(y,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,s.k6)(()=>[...t[8]||(t[8]=[(0,s.eW)(" æ³¨å†Œ ",-1)])]),_:1})],64))])])])])}n(4114);var f=n(8512),L=n(3459),y={name:"NavBar",setup(){const e=(0,f.rd)(),t=(0,L.k)(),n=(0,s.EW)(()=>t.isLoggedIn),a=(0,s.EW)(()=>t.username),r=(0,s.EW)(()=>t.avatar),l=async()=>{if(confirm("ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ"))try{await t.logout(),e.push("/login")}catch(n){console.error("é€€å‡ºå¤±è´¥:",n)}};return{isLoggedIn:n,username:a,avatar:r,handleLogout:l}}},w=n(1241);const h=(0,w.A)(y,[["render",g],["__scopeId","data-v-a6dd4bee"]]);var C=h},485:function(e,t,n){n.d(t,{B:function(){return r},Yf:function(){return a},aD:function(){return c},c7:function(){return u},lr:function(){return i},mb:function(){return o},nN:function(){return l}});var s=n(7277);const a=e=>s.A.get("/trips/",{params:e}),r=async e=>{try{return await s.A.get(`/trip-plans/${e}/`)}catch(t){const n=t.response?.status||t.status,a=404===n||"ERR_BAD_REQUEST"===t.code||t.message?.includes("404")||!t.response;if(a)return await s.A.get(`/trips/${e}/`);throw t}},l=e=>s.A.post(`/trips/${e}/like/`),i=e=>s.A.get(`/trips/${e}/stats/`),o=e=>s.A.get(`/trip-plans/${e}/stats/`),c=e=>s.A.post(`/trip-plans/${e}/like/`),u=e=>s.A.post(`/trip-plans/${e}/view/`)},1712:function(e,t,n){n.d(t,{A:function(){return g}});var s=n(6768),a=n(5130),r=n(4232);const l={class:"modal-header"},i={class:"modal-title"},o={class:"modal-body"},c={class:"alert alert-warning"},u={class:"mb-0"},d={class:"mb-0 mt-2"},p={class:"modal-footer"};function b(e,t,n,b,k,m){return n.show?((0,s.uX)(),(0,s.CE)("div",{key:0,class:"modal-overlay",onClick:t[4]||(t[4]=(...e)=>b.close&&b.close(...e))},[(0,s.Lk)("div",{class:"modal-content-advanced",onClick:t[3]||(t[3]=(0,a.D$)(()=>{},["stop"]))},[(0,s.Lk)("div",l,[(0,s.Lk)("h5",i,(0,r.v_)(n.title),1),(0,s.Lk)("button",{type:"button",class:"btn-close",onClick:t[0]||(t[0]=(...e)=>b.close&&b.close(...e))},"âœ•")]),(0,s.Lk)("div",o,[(0,s.Lk)("div",c,[t[5]||(t[5]=(0,s.Lk)("h6",{class:"alert-heading"},"âš ï¸ å±é™©æ“ä½œ",-1)),(0,s.Lk)("p",u,(0,r.v_)(n.warningText),1),(0,s.Lk)("ul",d,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(n.warningItems,e=>((0,s.uX)(),(0,s.CE)("li",{key:e},(0,r.v_)(e),1))),128))]),t[6]||(t[6]=(0,s.Lk)("p",{class:"mb-0 mt-2"},[(0,s.Lk)("strong",null,"æ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼")],-1))]),(0,s.Lk)("button",{class:"btn btn-danger w-100",onClick:t[1]||(t[1]=t=>e.$emit("confirm"))},(0,r.v_)(n.actionButtonText),1)]),(0,s.Lk)("div",p,[(0,s.Lk)("button",{type:"button",class:"btn btn-secondary",onClick:t[2]||(t[2]=(...e)=>b.close&&b.close(...e))},"å–æ¶ˆ")])])])):(0,s.Q3)("",!0)}var k={name:"AdvancedSettingsModal",props:{show:{type:Boolean,required:!0},title:{type:String,default:"âš™ï¸ é«˜çº§è®¾ç½®"},warningText:{type:String,required:!0},warningItems:{type:Array,required:!0},actionButtonText:{type:String,required:!0}},emits:["close","confirm"],setup(e,{emit:t}){const n=()=>{t("close")};return{close:n}}},m=n(1241);const v=(0,m.A)(k,[["render",b],["__scopeId","data-v-5977f88e"]]);var g=v},5279:function(e,t,n){n.r(t),n.d(t,{default:function(){return M}});var s=n(6768),a=n(4232),r=n(5130);const l={class:"my-trips-wrapper"},i={class:"container py-5"},o={class:"d-flex justify-content-between align-items-center mb-4"},c={key:0,class:"text-center py-5"},u={key:1,class:"row"},d=["onClick"],p={class:"trip-icon"},b={class:"trip-meta"},k={class:"trip-body"},m={class:"trip-title"},v={class:"trip-desc text-muted"},g={class:"trip-info"},f={class:"text-muted"},L={class:"text-muted ms-3"},y={class:"trip-actions"},w=["onClick"],h=["onClick"],C=["onClick"],T=["onClick"],_={key:2,class:"empty-state text-center py-5"};function A(e,t,n,A,x,E){const $=(0,s.g2)("NavBar"),W=(0,s.g2)("AdvancedSettingsModal");return(0,s.uX)(),(0,s.CE)("div",l,[(0,s.bF)($),(0,s.Lk)("div",i,[(0,s.Lk)("div",o,[t[4]||(t[4]=(0,s.Lk)("h2",null,"æˆ‘çš„æ—…è¡Œè®¡åˆ’",-1)),(0,s.Lk)("button",{class:"btn btn-primary",onClick:t[0]||(t[0]=(...e)=>A.createNew&&A.createNew(...e))},[...t[3]||(t[3]=[(0,s.Lk)("i",{class:"bi bi-plus-circle me-2"},null,-1),(0,s.eW)("åˆ›å»ºæ–°æ—…è¡Œ ",-1)])])]),A.loading?((0,s.uX)(),(0,s.CE)("div",c,[...t[5]||(t[5]=[(0,s.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,s.Lk)("span",{class:"visually-hidden"},"åŠ è½½ä¸­...")],-1)])])):A.trips.length>0?((0,s.uX)(),(0,s.CE)("div",u,[((0,s.uX)(!0),(0,s.CE)(s.FK,null,(0,s.pI)(A.trips,e=>((0,s.uX)(),(0,s.CE)("div",{key:e.id,class:"col-md-6 col-lg-4 mb-4"},[(0,s.Lk)("div",{class:"trip-card",onClick:t=>A.viewTrip(e.slug),style:{cursor:"pointer"}},[(0,s.Lk)("div",{class:"trip-header",style:(0,a.Tr)({background:e.theme_color||"#f0e68c"})},[(0,s.Lk)("div",p,(0,a.v_)(e.icon),1),(0,s.Lk)("div",b,[(0,s.Lk)("span",{class:(0,a.C4)(["badge","published"===e.status?"bg-success":"bg-secondary"])},(0,a.v_)("published"===e.status?"å·²å‘å¸ƒ":"è‰ç¨¿"),3),(0,s.Lk)("span",{class:(0,a.C4)(["badge ms-2","public"===e.visibility?"bg-info":"bg-warning"])},(0,a.v_)("public"===e.visibility?"å…¬å¼€":"ç§æœ‰"),3)])],4),(0,s.Lk)("div",k,[(0,s.Lk)("h5",m,(0,a.v_)(e.title),1),(0,s.Lk)("p",v,(0,a.v_)(e.description||"æš‚æ— æè¿°"),1),(0,s.Lk)("div",g,[(0,s.Lk)("small",f,[t[6]||(t[6]=(0,s.Lk)("i",{class:"bi bi-calendar me-1"},null,-1)),(0,s.eW)((0,a.v_)(e.days_count||0)+"å¤© ",1)]),(0,s.Lk)("small",L,[t[7]||(t[7]=(0,s.Lk)("i",{class:"bi bi-clock me-1"},null,-1)),(0,s.eW)((0,a.v_)(A.formatDate(e.updated_at)),1)])])]),(0,s.Lk)("div",y,[(0,s.Lk)("button",{class:"btn btn-sm btn-outline-primary",onClick:(0,r.D$)(t=>A.editTrip(e.slug),["stop"])},[...t[8]||(t[8]=[(0,s.Lk)("i",{class:"bi bi-pencil me-1"},null,-1),(0,s.eW)("ç¼–è¾‘ ",-1)])],8,w),A.userStore.isAdmin?((0,s.uX)(),(0,s.CE)(s.FK,{key:0},[e.isOnTree?((0,s.uX)(),(0,s.CE)("button",{key:0,class:"btn btn-sm btn-danger",onClick:(0,r.D$)(t=>A.removeFromTree(e.slug),["stop"])},[...t[9]||(t[9]=[(0,s.Lk)("i",{class:"bi bi-x-circle me-1"},null,-1),(0,s.eW)("æ‘˜ä¸‹æžœå®ž ",-1)])],8,h)):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"btn btn-sm btn-success",onClick:(0,r.D$)(t=>A.addToTree(e.slug),["stop"])},[...t[10]||(t[10]=[(0,s.Lk)("i",{class:"bi bi-tree me-1"},null,-1),(0,s.eW)("è¿ç”¨åˆ°æ—…è¡Œæ ‘ ",-1)])],8,C))],64)):((0,s.uX)(),(0,s.CE)("button",{key:1,class:"btn btn-sm btn-success",onClick:t[1]||(t[1]=(0,r.D$)(e=>A.requestApplyToTree(),["stop"]))},[...t[11]||(t[11]=[(0,s.Lk)("i",{class:"bi bi-tree me-1"},null,-1),(0,s.eW)("ç”³è¯·è¿ç”¨åˆ°æ—…è¡Œæ ‘ ",-1)])])),(0,s.Lk)("button",{class:"btn btn-sm btn-outline-secondary",onClick:(0,r.D$)(t=>A.showAdvancedSettings(e.slug),["stop"]),title:"é«˜çº§é€‰é¡¹"}," âš™ï¸ ",8,T)])],8,d)]))),128))])):((0,s.uX)(),(0,s.CE)("div",_,[t[13]||(t[13]=(0,s.Lk)("div",{class:"empty-icon mb-3"},"ðŸ“",-1)),t[14]||(t[14]=(0,s.Lk)("h4",null,"è¿˜æ²¡æœ‰æ—…è¡Œè®¡åˆ’",-1)),t[15]||(t[15]=(0,s.Lk)("p",{class:"text-muted mb-4"},"å¼€å§‹åˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ªæ—…è¡Œè®¡åˆ’å§ï¼",-1)),(0,s.Lk)("button",{class:"btn btn-primary btn-lg",onClick:t[2]||(t[2]=(...e)=>A.createNew&&A.createNew(...e))},[...t[12]||(t[12]=[(0,s.Lk)("i",{class:"bi bi-plus-circle me-2"},null,-1),(0,s.eW)("åˆ›å»ºæ–°æ—…è¡Œ ",-1)])])]))]),(0,s.bF)(W,{show:A.showModal,title:"âš™ï¸ é«˜çº§é€‰é¡¹","warning-text":"åˆ é™¤æ—…è¡Œè®¡åˆ’å°†ä¼šæ°¸ä¹…åˆ é™¤æ‚¨çš„æ‰€æœ‰æ•°æ®ï¼ŒåŒ…æ‹¬ï¼š","warning-items":["æ‰€æœ‰è¡Œç¨‹å®‰æŽ’","æ‰€æœ‰è¯„è®ºå’Œå›žå¤","æ‰€æœ‰ç»Ÿè®¡æ•°æ®","æ‰€æœ‰å›¾ç‰‡å’Œè§†é¢‘"],"action-button-text":"ðŸ—‘ï¸ åˆ é™¤æ—…è¡Œè®¡åˆ’",onClose:A.closeModal,onConfirm:A.confirmDeleteTrip},null,8,["show","onClose","onConfirm"])])}n(4114),n(8111),n(7588),n(1701),n(7642),n(8004),n(3853),n(5876),n(2475),n(5024),n(1698);var x=n(144),E=n(8512),$=n(3459),W=n(7682),X=n(485),F=n(432),D=n(1712),S={name:"MyTripsView",components:{NavBar:F.A,AdvancedSettingsModal:D.A},setup(){const e=(0,E.rd)(),t=(0,$.k)(),n=(0,x.KR)([]),a=(0,x.KR)(!0),r=(0,x.KR)(!1),l=(0,x.KR)(null),i=async()=>{a.value=!0;try{const e=await(0,W.getMyTrips)(),t=e.results||e||[];n.value=t,await f()}catch(e){console.error("èŽ·å–æ—…è¡Œå¤§åŽ…å¤±è´¥:",e),alert("åŠ è½½å¤±è´¥")}finally{a.value=!1}},o=()=>{e.push("/editor/new")},c=t=>{e.push(`/editor/${t}`)},u=t=>{e.push(`/trip/${t}/`)},d=e=>{e?(l.value=e,r.value=!0):alert("é”™è¯¯ï¼šè¯¥æ—…è¡Œè®¡åˆ’ç¼ºå°‘æ ‡è¯†ç¬¦")},p=()=>{r.value=!1,l.value=null},b=()=>{const e=l.value;if(!e)return alert("é”™è¯¯ï¼šæ— æ³•èŽ·å–æ—…è¡Œè®¡åˆ’æ ‡è¯†"),void p();confirm("âš ï¸ è¯·å†æ¬¡ç¡®è®¤ï¼šæ‚¨ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ—…è¡Œè®¡åˆ’å—ï¼Ÿ\n\næ­¤æ“ä½œæ— æ³•æ’¤é”€ï¼")&&(k(e),p())},k=async e=>{if(e)try{await(0,W.deleteTripPlan)(e),alert("åˆ é™¤æˆåŠŸ"),await i()}catch(t){console.error("åˆ é™¤å¤±è´¥:",t),alert("åˆ é™¤å¤±è´¥ï¼š"+(t.response?.data?.detail||t.message))}else alert("é”™è¯¯ï¼šæ— æ³•èŽ·å–æ—…è¡Œè®¡åˆ’æ ‡è¯†")},m=async e=>{if(confirm("ç¡®å®šè¦å°†æ­¤æ—…è¡Œè®¡åˆ’æ·»åŠ åˆ°æ—…è¡Œæ ‘å—ï¼Ÿå®ƒå°†æ˜¾ç¤ºåœ¨é¦–é¡µçš„æ—…è¡Œæ ‘ä¸Šã€‚"))try{const t=await(0,W.addTripToTree)(e);alert(t.detail||"æˆåŠŸæ·»åŠ åˆ°æ—…è¡Œæ ‘ï¼"),await i()}catch(t){console.error("æ·»åŠ åˆ°æ—…è¡Œæ ‘å¤±è´¥:",t),alert("æ·»åŠ åˆ°æ—…è¡Œæ ‘å¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},v=async e=>{if(confirm("ç¡®å®šè¦å°†æ­¤æ—…è¡Œè®¡åˆ’ä»Žæ—…è¡Œæ ‘æ‘˜ä¸‹å—ï¼Ÿå®ƒå°†ä¸å†æ˜¾ç¤ºåœ¨é¦–é¡µçš„æ—…è¡Œæ ‘ä¸Šã€‚"))try{const t=await(0,W.removeTripFromTree)(e);alert(t.detail||"æˆåŠŸæ‘˜ä¸‹æžœå®žï¼"),await i()}catch(t){console.error("æ‘˜ä¸‹æžœå®žå¤±è´¥:",t),alert("æ‘˜ä¸‹æžœå®žå¤±è´¥ï¼Œè¯·ç¨åŽé‡è¯•")}},g=()=>{alert("è¯¥åŠŸèƒ½æš‚æœªå¼€æ”¾")},f=async()=>{try{const e=await(0,X.Yf)(),t=new Set((e.results||e||[]).map(e=>e.slug));n.value.forEach(e=>{e.isOnTree=t.has(e.slug)})}catch(e){console.error("èŽ·å–æ—…è¡Œæ ‘çŠ¶æ€å¤±è´¥:",e)}},L=e=>{if(!e)return"æš‚æ— ";const t=new Date(e);return t.toLocaleDateString("zh-CN")};return(0,s.sV)(()=>{if(!t.isLoggedIn)return alert("è¯·å…ˆç™»å½•"),void e.push("/login");i()}),{trips:n,loading:a,showModal:r,userStore:t,createNew:o,editTrip:c,viewTrip:u,showAdvancedSettings:d,closeModal:p,confirmDeleteTrip:b,deleteTrip:k,addToTree:m,removeFromTree:v,requestApplyToTree:g,formatDate:L}}},I=n(1241);const N=(0,I.A)(S,[["render",A],["__scopeId","data-v-b4ac0dcc"]]);var M=N},7682:function(e,t,n){n.r(t),n.d(t,{addTripToTree:function(){return b},cloneTripPlan:function(){return c},createTripPlan:function(){return l},deleteTripPlan:function(){return o},getMyTrips:function(){return a},getTripPlan:function(){return r},makePrivate:function(){return p},makePublic:function(){return d},publishTripPlan:function(){return u},removeTripFromTree:function(){return k},updateTripPlan:function(){return i}});var s=n(7277);const a=e=>s.A.get("/trip-plans/my_trips/",{params:e}),r=e=>s.A.get(`/trip-plans/${e}/`),l=e=>s.A.post("/trip-plans/",e),i=(e,t)=>s.A.patch(`/trip-plans/${e}/`,t),o=e=>s.A.delete(`/trip-plans/${e}/`),c=e=>s.A.post(`/trip-plans/${e}/clone/`),u=e=>i(e,{status:"published"}),d=e=>i(e,{visibility:"public"}),p=e=>i(e,{visibility:"private"}),b=e=>s.A.post(`/trip-plans/${e}/add_to_tree/`),k=e=>s.A.post(`/trip-plans/${e}/remove_from_tree/`)}}]);
//# sourceMappingURL=279.e93d5da0.js.map