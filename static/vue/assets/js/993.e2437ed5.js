"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[993],{5824:function(e,l,a){a.d(l,{A:function(){return V}});var t=a(6768),s=a(4232),o=a(5130);const n={class:"navbar navbar-expand-lg navbar-dark bg-primary shadow-sm sticky-top"},i={class:"container-fluid"},d={class:"collapse navbar-collapse",id:"navbarNav",style:{overflow:"visible"}},c={class:"navbar-nav me-auto"},r={class:"nav-item"},u={class:"nav-item"},m={class:"d-flex align-items-center"},b={key:0,class:"dropdown dropdown-end"},p={href:"#",class:"d-flex align-items-center text-white text-decoration-none dropdown-toggle user-dropdown-btn",id:"dropdownUser","data-bs-toggle":"dropdown","aria-expanded":"false"},v=["src"],k={class:"dropdown-menu dropdown-menu-end text-small","aria-labelledby":"dropdownUser"};function g(e,l,a,g,L,h){const f=(0,t.g2)("router-link");return(0,t.uX)(),(0,t.CE)("nav",n,[(0,t.Lk)("div",i,[(0,t.bF)(f,{to:"/",class:"navbar-brand"},{default:(0,t.k6)(()=>[...l[1]||(l[1]=[(0,t.Lk)("span",{class:"brand-text"},"Roamio",-1)])]),_:1}),l[9]||(l[9]=(0,t.Lk)("button",{class:"navbar-toggler",type:"button","data-bs-toggle":"collapse","data-bs-target":"#navbarNav"},[(0,t.Lk)("span",{class:"navbar-toggler-icon"})],-1)),(0,t.Lk)("div",d,[(0,t.Lk)("ul",c,[(0,t.Lk)("li",r,[(0,t.bF)(f,{to:"/",class:"nav-link"},{default:(0,t.k6)(()=>[...l[2]||(l[2]=[(0,t.Lk)("i",{class:"bi bi-house-door me-1"},null,-1),(0,t.eW)(" 旅行列表 ",-1)])]),_:1})]),(0,t.Lk)("li",u,[(0,t.bF)(f,{to:"/my-trips",class:"nav-link"},{default:(0,t.k6)(()=>[...l[3]||(l[3]=[(0,t.Lk)("i",{class:"bi bi-folder me-1"},null,-1),(0,t.eW)(" 我的旅行 ",-1)])]),_:1})])]),(0,t.Lk)("div",m,[g.isLoggedIn?((0,t.uX)(),(0,t.CE)("div",b,[(0,t.Lk)("a",p,[(0,t.Lk)("img",{src:g.avatar,alt:"avatar",width:"32",height:"32",class:"rounded-circle me-2"},null,8,v),(0,t.Lk)("span",null,(0,s.v_)(g.username),1)]),(0,t.Lk)("ul",k,[(0,t.Lk)("li",null,[(0,t.bF)(f,{to:"/user/center",class:"dropdown-item"},{default:(0,t.k6)(()=>[...l[4]||(l[4]=[(0,t.Lk)("i",{class:"bi bi-person me-2"},null,-1),(0,t.eW)("个人中心 ",-1)])]),_:1})]),l[6]||(l[6]=(0,t.Lk)("li",null,[(0,t.Lk)("hr",{class:"dropdown-divider"})],-1)),(0,t.Lk)("li",null,[(0,t.Lk)("a",{href:"#",class:"dropdown-item",onClick:l[0]||(l[0]=(0,o.D$)((...e)=>g.handleLogout&&g.handleLogout(...e),["prevent"]))},[...l[5]||(l[5]=[(0,t.Lk)("i",{class:"bi bi-box-arrow-right me-2"},null,-1),(0,t.eW)("退出登录 ",-1)])])])])])):((0,t.uX)(),(0,t.CE)(t.FK,{key:1},[(0,t.bF)(f,{to:"/login",class:"btn btn-outline-light btn-sm me-2"},{default:(0,t.k6)(()=>[...l[7]||(l[7]=[(0,t.eW)(" 登录 ",-1)])]),_:1}),(0,t.bF)(f,{to:"/register",class:"btn btn-light btn-sm"},{default:(0,t.k6)(()=>[...l[8]||(l[8]=[(0,t.eW)(" 注册 ",-1)])]),_:1})],64))])])])])}a(4114);var L=a(8512),h=a(1516),f={name:"NavBar",setup(){const e=(0,L.rd)(),l=(0,h.k)(),a=(0,t.EW)(()=>l.isLoggedIn),s=(0,t.EW)(()=>l.username),o=(0,t.EW)(()=>l.avatar),n=async()=>{if(confirm("确定要退出登录吗？"))try{await l.logout(),e.push("/login")}catch(a){console.error("退出失败:",a)}};return{isLoggedIn:a,username:s,avatar:o,handleLogout:n}}},y=a(1241);const C=(0,y.A)(f,[["render",g],["__scopeId","data-v-8cff0656"]]);var V=C},6993:function(e,l,a){a.r(l),a.d(l,{default:function(){return wl}});var t=a(6768),s=a(4232);const o={class:"editor-wrapper"},n={class:"editor-container"},i={class:"editor-toolbar"},d={class:"container-fluid"},c={class:"d-flex justify-content-between align-items-center py-3"},r={class:"d-inline-block mb-0 ms-3"},u=["disabled"],m={key:0,class:"spinner-border spinner-border-sm me-1"},b={key:1,class:"bi bi-save me-1"},p=["disabled"],v={key:0,class:"spinner-border spinner-border-sm me-1"},k={key:1,class:"bi bi-send me-1"},g={class:"container py-4"},L={class:"row"},h={class:"col-lg-8"},f={class:"col-lg-4"};function y(e,l,a,y,C,V){const E=(0,t.g2)("NavBar"),w=(0,t.g2)("BasicInfoEditor"),_=(0,t.g2)("ModuleSelector"),I=(0,t.g2)("ContentEditor"),x=(0,t.g2)("EditorSidebar");return(0,t.uX)(),(0,t.CE)("div",o,[(0,t.bF)(E),(0,t.Lk)("div",n,[(0,t.Lk)("div",i,[(0,t.Lk)("div",d,[(0,t.Lk)("div",c,[(0,t.Lk)("div",null,[(0,t.Lk)("button",{class:"btn btn-outline-secondary me-2",onClick:l[0]||(l[0]=(...e)=>y.goBack&&y.goBack(...e))},[...l[6]||(l[6]=[(0,t.Lk)("i",{class:"bi bi-arrow-left me-1"},null,-1),(0,t.eW)("返回 ",-1)])]),(0,t.Lk)("h5",r,(0,s.v_)(y.isEditMode?"编辑旅行计划":"创建旅行计划"),1)]),(0,t.Lk)("div",null,[(0,t.Lk)("button",{class:"btn btn-outline-primary me-2",onClick:l[1]||(l[1]=(...e)=>y.handleSave&&y.handleSave(...e)),disabled:y.saving},[y.saving?((0,t.uX)(),(0,t.CE)("span",m)):((0,t.uX)(),(0,t.CE)("i",b)),l[7]||(l[7]=(0,t.eW)(" 保存草稿 ",-1))],8,u),(0,t.Lk)("button",{class:"btn btn-primary",onClick:l[2]||(l[2]=(...e)=>y.handlePublish&&y.handlePublish(...e)),disabled:y.publishing||!y.canPublish},[y.publishing?((0,t.uX)(),(0,t.CE)("span",v)):((0,t.uX)(),(0,t.CE)("i",k)),l[8]||(l[8]=(0,t.eW)(" 发布 ",-1))],8,p)])])])]),(0,t.Lk)("div",g,[(0,t.Lk)("div",L,[(0,t.Lk)("div",h,[(0,t.bF)(w,{modelValue:y.tripData,"onUpdate:modelValue":l[3]||(l[3]=e=>y.tripData=e)},null,8,["modelValue"]),(0,t.bF)(_,{modules:y.availableModules,"enabled-modules":y.tripData.config.enabledModules,onToggle:y.toggleModule},null,8,["modules","enabled-modules","onToggle"]),(0,t.bF)(I,{modelValue:y.tripData.overview,"onUpdate:modelValue":l[4]||(l[4]=e=>y.tripData.overview=e),"enabled-modules":y.tripData.config.enabledModules},null,8,["modelValue","enabled-modules"])]),(0,t.Lk)("div",f,[(0,t.bF)(x,{modelValue:y.tripData,"onUpdate:modelValue":l[5]||(l[5]=e=>y.tripData=e),"days-count":y.daysCount},null,8,["modelValue","days-count"])])])])])])}a(4114),a(8111),a(8237);var C=a(144),V=a(8512),E=a(1516),w=a(7682),_=a(5824);const I={class:"card mb-4"},x={class:"card-body"},X={class:"mb-3"},U=["value"],M={class:"mb-3"},W=["value"],A={class:"row mb-3"},F={class:"col-md-6"},D=["value"],$={class:"col-md-6"},B=["value"],T={class:"row mb-3"},J={class:"col-md-6"},Q={class:"icon-selector"},K=["onClick"],S={class:"col-md-6"},j=["value"];function q(e,l,a,o,n,i){return(0,t.uX)(),(0,t.CE)("div",I,[l[11]||(l[11]=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("h5",{class:"mb-0"},"📝 基本信息")],-1)),(0,t.Lk)("div",x,[(0,t.Lk)("div",X,[l[5]||(l[5]=(0,t.Lk)("label",{class:"form-label"},"旅行标题 *",-1)),(0,t.Lk)("input",{value:a.modelValue.title,onInput:l[0]||(l[0]=l=>e.$emit("update:modelValue",{...a.modelValue,title:l.target.value})),type:"text",class:"form-control",placeholder:"例如：厦门三天两夜游",required:""},null,40,U)]),(0,t.Lk)("div",M,[l[6]||(l[6]=(0,t.Lk)("label",{class:"form-label"},"简介描述",-1)),(0,t.Lk)("textarea",{value:a.modelValue.description,onInput:l[1]||(l[1]=l=>e.$emit("update:modelValue",{...a.modelValue,description:l.target.value})),class:"form-control",rows:"3",placeholder:"简单描述你的旅行计划..."},null,40,W)]),(0,t.Lk)("div",A,[(0,t.Lk)("div",F,[l[7]||(l[7]=(0,t.Lk)("label",{class:"form-label"},"开始日期",-1)),(0,t.Lk)("input",{value:a.modelValue.start_date,onInput:l[2]||(l[2]=l=>e.$emit("update:modelValue",{...a.modelValue,start_date:l.target.value})),type:"date",class:"form-control"},null,40,D)]),(0,t.Lk)("div",$,[l[8]||(l[8]=(0,t.Lk)("label",{class:"form-label"},"结束日期",-1)),(0,t.Lk)("input",{value:a.modelValue.end_date,onInput:l[3]||(l[3]=l=>e.$emit("update:modelValue",{...a.modelValue,end_date:l.target.value})),type:"date",class:"form-control"},null,40,B)])]),(0,t.Lk)("div",T,[(0,t.Lk)("div",J,[l[9]||(l[9]=(0,t.Lk)("label",{class:"form-label"},"旅行图标",-1)),(0,t.Lk)("div",Q,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.iconOptions,l=>((0,t.uX)(),(0,t.CE)("button",{key:l,type:"button",class:(0,s.C4)(["icon-btn",{active:a.modelValue.icon===l}]),onClick:t=>e.$emit("update:modelValue",{...a.modelValue,icon:l})},(0,s.v_)(l),11,K))),128))])]),(0,t.Lk)("div",S,[l[10]||(l[10]=(0,t.Lk)("label",{class:"form-label"},"主题颜色",-1)),(0,t.Lk)("input",{value:a.modelValue.theme_color,onInput:l[4]||(l[4]=l=>e.$emit("update:modelValue",{...a.modelValue,theme_color:l.target.value})),type:"color",class:"form-control form-control-color"},null,40,j)])])])])}var N={name:"BasicInfoEditor",props:{modelValue:{type:Object,required:!0}},emits:["update:modelValue"],setup(){const e=["🏖️","🌊","🏙️","🌄","🌇","🗺️","✈️","🚗","🏔️","🌴"];return{iconOptions:e}}},O=a(1241);const H=(0,O.A)(N,[["render",q],["__scopeId","data-v-13ca7677"]]);var P=H;const R={class:"card mb-4"},z={class:"card-body"},G={class:"modules-grid"},Y=["onClick"],Z={class:"module-icon"},ee={class:"module-name"},le={class:"module-desc"},ae={class:"module-check"},te={key:0,class:"bi bi-check-circle-fill text-success"},se={key:1,class:"bi bi-circle text-muted"};function oe(e,l,a,o,n,i){return(0,t.uX)(),(0,t.CE)("div",R,[l[1]||(l[1]=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("h5",{class:"mb-0"},"🧩 选择模块")],-1)),(0,t.Lk)("div",z,[l[0]||(l[0]=(0,t.Lk)("p",{class:"text-muted mb-3"},"选择你想在旅行计划中展示的内容模块",-1)),(0,t.Lk)("div",G,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(a.modules,l=>((0,t.uX)(),(0,t.CE)("div",{key:l.id,class:(0,s.C4)(["module-card",{active:o.isEnabled(l.id)}]),onClick:a=>e.$emit("toggle",l.id)},[(0,t.Lk)("div",Z,(0,s.v_)(l.icon),1),(0,t.Lk)("div",ee,(0,s.v_)(l.name),1),(0,t.Lk)("div",le,(0,s.v_)(l.description),1),(0,t.Lk)("div",ae,[o.isEnabled(l.id)?((0,t.uX)(),(0,t.CE)("i",te)):((0,t.uX)(),(0,t.CE)("i",se))])],10,Y))),128))])])])}var ne={name:"ModuleSelector",props:{modules:{type:Array,required:!0},enabledModules:{type:Array,default:()=>[]}},emits:["toggle"],setup(e){const l=l=>e.enabledModules.includes(l);return{isEnabled:l}}};const ie=(0,O.A)(ne,[["render",oe],["__scopeId","data-v-4fb81d10"]]);var de=ie,ce=a(5130);const re={key:0,class:"card mb-4"},ue={class:"card-body"},me={class:"row"},be={class:"col-md-6 mb-3"},pe={class:"col-md-6 mb-3"},ve={class:"col-md-6 mb-3"},ke={class:"col-md-6 mb-3"},ge={key:1,class:"card mb-4"},Le={class:"card-header d-flex justify-content-between align-items-center"},he={class:"card-body"},fe={class:"input-group"},ye=["onUpdate:modelValue"],Ce=["onClick"],Ve={key:0,class:"text-muted text-center py-3 mb-0"},Ee={key:2,class:"card mb-4"},we={class:"card-header d-flex justify-content-between align-items-center"},_e={class:"card-body"},Ie={class:"d-flex justify-content-between align-items-center mb-2"},xe=["onClick"],Xe={class:"mb-2"},Ue=["onUpdate:modelValue"],Me={class:"mb-2"},We=["onUpdate:modelValue"],Ae={class:"mb-2"},Fe=["onUpdate:modelValue"],De=["onUpdate:modelValue"],$e={key:0,class:"text-muted text-center py-3 mb-0"},Be={key:3,class:"card mb-4"},Te={class:"card-header d-flex justify-content-between align-items-center"},Je={class:"card-body"},Qe={class:"col-md-4"},Ke=["onUpdate:modelValue"],Se={class:"col-md-3"},je=["onUpdate:modelValue"],qe={class:"col-md-4"},Ne=["onUpdate:modelValue"],Oe={class:"col-md-1"},He=["onClick"],Pe={key:0,class:"alert alert-info mt-3"},Re={key:4,class:"card mb-4"},ze={class:"card-header d-flex justify-content-between align-items-center"},Ge={class:"card-body"},Ye={class:"input-group"},Ze=["onUpdate:modelValue"],el=["onClick"],ll={key:0,class:"text-muted text-center py-3 mb-0"};function al(e,l,a,o,n,i){return(0,t.uX)(),(0,t.CE)("div",null,[o.isModuleEnabled("basicInfo")?((0,t.uX)(),(0,t.CE)("div",re,[l[12]||(l[12]=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("h5",{class:"mb-0"},"ℹ️ 基本信息")],-1)),(0,t.Lk)("div",ue,[(0,t.Lk)("div",me,[(0,t.Lk)("div",be,[l[8]||(l[8]=(0,t.Lk)("label",{class:"form-label"},"出发地",-1)),(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l[0]||(l[0]=e=>o.content.basicInfo.departure=e),type:"text",class:"form-control"},null,512),[[ce.Jo,o.content.basicInfo.departure]])]),(0,t.Lk)("div",pe,[l[9]||(l[9]=(0,t.Lk)("label",{class:"form-label"},"目的地",-1)),(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l[1]||(l[1]=e=>o.content.basicInfo.destination=e),type:"text",class:"form-control"},null,512),[[ce.Jo,o.content.basicInfo.destination]])]),(0,t.Lk)("div",ve,[l[10]||(l[10]=(0,t.Lk)("label",{class:"form-label"},"交通方式",-1)),(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l[2]||(l[2]=e=>o.content.basicInfo.transport=e),type:"text",class:"form-control",placeholder:"例如：高铁往返"},null,512),[[ce.Jo,o.content.basicInfo.transport]])]),(0,t.Lk)("div",ke,[l[11]||(l[11]=(0,t.Lk)("label",{class:"form-label"},"住宿安排",-1)),(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l[3]||(l[3]=e=>o.content.basicInfo.accommodation=e),type:"text",class:"form-control"},null,512),[[ce.Jo,o.content.basicInfo.accommodation]])])])])])):(0,t.Q3)("",!0),o.isModuleEnabled("highlights")?((0,t.uX)(),(0,t.CE)("div",ge,[(0,t.Lk)("div",Le,[l[14]||(l[14]=(0,t.Lk)("h5",{class:"mb-0"},"✨ 行程亮点",-1)),(0,t.Lk)("button",{class:"btn btn-sm btn-light",onClick:l[4]||(l[4]=(...e)=>o.addHighlight&&o.addHighlight(...e))},[...l[13]||(l[13]=[(0,t.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,t.eW)("添加 ",-1)])])]),(0,t.Lk)("div",he,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.content.highlights,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"mb-3"},[(0,t.Lk)("div",fe,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":e=>o.content.highlights[a]=e,type:"text",class:"form-control",placeholder:"例如：🏖️ 厦门植物园 - 热带雨林奇观"},null,8,ye),[[ce.Jo,o.content.highlights[a]]]),(0,t.Lk)("button",{class:"btn btn-outline-danger",onClick:e=>o.removeHighlight(a)},[...l[15]||(l[15]=[(0,t.Lk)("i",{class:"bi bi-trash"},null,-1)])],8,Ce)])]))),128)),0===o.content.highlights.length?((0,t.uX)(),(0,t.CE)("p",Ve,' 暂无亮点，点击上方"添加"按钮 ')):(0,t.Q3)("",!0)])])):(0,t.Q3)("",!0),o.isModuleEnabled("itinerary")?((0,t.uX)(),(0,t.CE)("div",Ee,[(0,t.Lk)("div",we,[l[17]||(l[17]=(0,t.Lk)("h5",{class:"mb-0"},"📅 详细行程",-1)),(0,t.Lk)("button",{class:"btn btn-sm btn-light",onClick:l[5]||(l[5]=(...e)=>o.addItinerary&&o.addItinerary(...e))},[...l[16]||(l[16]=[(0,t.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,t.eW)("添加一天 ",-1)])])]),(0,t.Lk)("div",_e,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.content.itinerary,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"itinerary-item mb-4"},[(0,t.Lk)("div",Ie,[(0,t.Lk)("h6",null,"第"+(0,s.v_)(a+1)+"天",1),(0,t.Lk)("button",{class:"btn btn-sm btn-outline-danger",onClick:e=>o.removeItinerary(a)},[...l[18]||(l[18]=[(0,t.Lk)("i",{class:"bi bi-trash"},null,-1)])],8,xe)]),(0,t.Lk)("div",Xe,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l=>e.day=l,type:"text",class:"form-control form-control-sm",placeholder:"例如：第一天（6月22日）"},null,8,Ue),[[ce.Jo,e.day]])]),(0,t.Lk)("div",Me,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l=>e.time=l,type:"text",class:"form-control form-control-sm",placeholder:"例如：09:00-18:00"},null,8,We),[[ce.Jo,e.time]])]),(0,t.Lk)("div",Ae,[(0,t.bo)((0,t.Lk)("textarea",{"onUpdate:modelValue":l=>e.content=l,class:"form-control form-control-sm",rows:"3",placeholder:"详细的行程安排..."},null,8,Fe),[[ce.Jo,e.content]])]),(0,t.Lk)("div",null,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l=>e.highlight=l,type:"text",class:"form-control form-control-sm",placeholder:"例如：🏖️ 海滩美景"},null,8,De),[[ce.Jo,e.highlight]])])]))),128)),0===o.content.itinerary.length?((0,t.uX)(),(0,t.CE)("p",$e,' 暂无行程，点击上方"添加一天"按钮开始规划 ')):(0,t.Q3)("",!0)])])):(0,t.Q3)("",!0),o.isModuleEnabled("budget")?((0,t.uX)(),(0,t.CE)("div",Be,[(0,t.Lk)("div",Te,[l[20]||(l[20]=(0,t.Lk)("h5",{class:"mb-0"},"💰 预算参考",-1)),(0,t.Lk)("button",{class:"btn btn-sm btn-light",onClick:l[6]||(l[6]=(...e)=>o.addBudgetItem&&o.addBudgetItem(...e))},[...l[19]||(l[19]=[(0,t.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,t.eW)("添加 ",-1)])])]),(0,t.Lk)("div",Je,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.content.budget.items,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"row mb-3"},[(0,t.Lk)("div",Qe,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l=>e.name=l,type:"text",class:"form-control form-control-sm",placeholder:"项目名称"},null,8,Ke),[[ce.Jo,e.name]])]),(0,t.Lk)("div",Se,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l=>e.amount=l,type:"number",class:"form-control form-control-sm",placeholder:"金额"},null,8,je),[[ce.Jo,e.amount,void 0,{number:!0}]])]),(0,t.Lk)("div",qe,[(0,t.bo)((0,t.Lk)("input",{"onUpdate:modelValue":l=>e.note=l,type:"text",class:"form-control form-control-sm",placeholder:"备注"},null,8,Ne),[[ce.Jo,e.note]])]),(0,t.Lk)("div",Oe,[(0,t.Lk)("button",{class:"btn btn-sm btn-outline-danger w-100",onClick:e=>o.removeBudgetItem(a)},[...l[21]||(l[21]=[(0,t.Lk)("i",{class:"bi bi-trash"},null,-1)])],8,He)])]))),128)),o.content.budget.items.length>0?((0,t.uX)(),(0,t.CE)("div",Pe,[l[22]||(l[22]=(0,t.Lk)("strong",null,"总计：",-1)),(0,t.eW)("¥"+(0,s.v_)(o.budgetTotal),1)])):(0,t.Q3)("",!0)])])):(0,t.Q3)("",!0),o.isModuleEnabled("tips")?((0,t.uX)(),(0,t.CE)("div",Re,[(0,t.Lk)("div",ze,[l[24]||(l[24]=(0,t.Lk)("h5",{class:"mb-0"},"💡 实用提示",-1)),(0,t.Lk)("button",{class:"btn btn-sm btn-light",onClick:l[7]||(l[7]=(...e)=>o.addTip&&o.addTip(...e))},[...l[23]||(l[23]=[(0,t.Lk)("i",{class:"bi bi-plus-circle me-1"},null,-1),(0,t.eW)("添加 ",-1)])])]),(0,t.Lk)("div",Ge,[((0,t.uX)(!0),(0,t.CE)(t.FK,null,(0,t.pI)(o.content.tips,(e,a)=>((0,t.uX)(),(0,t.CE)("div",{key:a,class:"mb-3"},[(0,t.Lk)("div",Ye,[(0,t.bo)((0,t.Lk)("textarea",{"onUpdate:modelValue":e=>o.content.tips[a]=e,class:"form-control",rows:"2",placeholder:"输入一条实用提示..."},null,8,Ze),[[ce.Jo,o.content.tips[a]]]),(0,t.Lk)("button",{class:"btn btn-outline-danger",onClick:e=>o.removeTip(a)},[...l[25]||(l[25]=[(0,t.Lk)("i",{class:"bi bi-trash"},null,-1)])],8,el)])]))),128)),0===o.content.tips.length?((0,t.uX)(),(0,t.CE)("p",ll,' 暂无提示，点击上方"添加"按钮 ')):(0,t.Q3)("",!0)])])):(0,t.Q3)("",!0)])}var tl={name:"ContentEditor",props:{modelValue:{type:Object,required:!0},enabledModules:{type:Array,default:()=>[]}},emits:["update:modelValue"],setup(e,{emit:l}){const a=(0,t.EW)({get:()=>e.modelValue,set:e=>l("update:modelValue",e)}),s=l=>e.enabledModules.includes(l),o=(0,t.EW)(()=>a.value.budget.items.reduce((e,l)=>e+(l.amount||0),0)),n=()=>{a.value.highlights.push("")},i=e=>{a.value.highlights.splice(e,1)},d=()=>{a.value.itinerary.push({day:"",time:"",content:"",highlight:""})},c=e=>{a.value.itinerary.splice(e,1)},r=()=>{a.value.budget.items.push({name:"",amount:0,note:""})},u=e=>{a.value.budget.items.splice(e,1)},m=()=>{a.value.tips.push("")},b=e=>{a.value.tips.splice(e,1)};return{content:a,isModuleEnabled:s,budgetTotal:o,addHighlight:n,removeHighlight:i,addItinerary:d,removeItinerary:c,addBudgetItem:r,removeBudgetItem:u,addTip:m,removeTip:b}}};const sl=(0,O.A)(tl,[["render",al],["__scopeId","data-v-c4faf1d8"]]);var ol=sl;const nl={class:"card mb-4 sticky-top",style:{top:"140px"}},il={class:"card-body"},dl={class:"mb-3"},cl=["value"],rl={class:"mb-3"},ul=["value"],ml={class:"info-stats mt-4"},bl={key:0,class:"stat-item"},pl={class:"value"},vl={key:1,class:"stat-item"},kl={class:"value"},gl={key:2,class:"stat-item"},Ll={class:"value"};function hl(e,l,a,o,n,i){return(0,t.uX)(),(0,t.CE)("div",nl,[l[10]||(l[10]=(0,t.Lk)("div",{class:"card-header"},[(0,t.Lk)("h5",{class:"mb-0"},"⚙️ 设置")],-1)),(0,t.Lk)("div",il,[(0,t.Lk)("div",dl,[l[3]||(l[3]=(0,t.Lk)("label",{class:"form-label"},"状态",-1)),(0,t.Lk)("select",{value:a.modelValue.status,onChange:l[0]||(l[0]=l=>e.$emit("update:modelValue",{...a.modelValue,status:l.target.value})),class:"form-select"},[...l[2]||(l[2]=[(0,t.Lk)("option",{value:"draft"},"草稿",-1),(0,t.Lk)("option",{value:"published"},"已发布",-1)])],40,cl)]),(0,t.Lk)("div",rl,[l[5]||(l[5]=(0,t.Lk)("label",{class:"form-label"},"可见性",-1)),(0,t.Lk)("select",{value:a.modelValue.visibility,onChange:l[1]||(l[1]=l=>e.$emit("update:modelValue",{...a.modelValue,visibility:l.target.value})),class:"form-select"},[...l[4]||(l[4]=[(0,t.Lk)("option",{value:"private"},"私有",-1),(0,t.Lk)("option",{value:"public"},"公开",-1)])],40,ul),l[6]||(l[6]=(0,t.Lk)("small",{class:"text-muted"},"公开后其他人可以看到你的旅行计划",-1))]),(0,t.Lk)("div",ml,[a.modelValue.created_at?((0,t.uX)(),(0,t.CE)("div",bl,[l[7]||(l[7]=(0,t.Lk)("span",{class:"label"},"创建时间",-1)),(0,t.Lk)("span",pl,(0,s.v_)(o.formatDate(a.modelValue.created_at)),1)])):(0,t.Q3)("",!0),a.modelValue.updated_at?((0,t.uX)(),(0,t.CE)("div",vl,[l[8]||(l[8]=(0,t.Lk)("span",{class:"label"},"更新时间",-1)),(0,t.Lk)("span",kl,(0,s.v_)(o.formatDate(a.modelValue.updated_at)),1)])):(0,t.Q3)("",!0),a.daysCount>0?((0,t.uX)(),(0,t.CE)("div",gl,[l[9]||(l[9]=(0,t.Lk)("span",{class:"label"},"旅行天数",-1)),(0,t.Lk)("span",Ll,(0,s.v_)(a.daysCount)+"天",1)])):(0,t.Q3)("",!0)])])])}var fl={name:"EditorSidebar",props:{modelValue:{type:Object,required:!0},daysCount:{type:Number,default:0}},emits:["update:modelValue"],setup(){const e=e=>{if(!e)return"暂无";const l=new Date(e);return l.toLocaleString("zh-CN")};return{formatDate:e}}};const yl=(0,O.A)(fl,[["render",hl],["__scopeId","data-v-b78e5ed0"]]);var Cl=yl,Vl={name:"TripEditorView",components:{NavBar:_.A,BasicInfoEditor:P,ModuleSelector:de,ContentEditor:ol,EditorSidebar:Cl},setup(){const e=(0,V.lq)(),l=(0,V.rd)(),a=(0,E.k)(),s=(0,C.KR)(!1),o=(0,C.KR)(!1),n=[{id:"basicInfo",name:"基本信息",icon:"ℹ️",description:"出发地、目的地等"},{id:"highlights",name:"行程亮点",icon:"✨",description:"主要景点和活动"},{id:"itinerary",name:"详细行程",icon:"📅",description:"每日安排"},{id:"budget",name:"预算参考",icon:"💰",description:"费用明细"},{id:"tips",name:"实用提示",icon:"💡",description:"注意事项"}],i=(0,C.KR)({title:"",description:"",icon:"🗺️",start_date:null,end_date:null,status:"draft",visibility:"private",theme_color:"#f0e68c",background_music:"",config:{enabledModules:["basicInfo","highlights"]},overview:{basicInfo:{departure:"",destination:"",transport:"",accommodation:""},highlights:[],itinerary:[],budget:{items:[],total:0},tips:[]},created_at:null,updated_at:null}),d=(0,t.EW)(()=>{const l=e.params.slug;return l&&"new"!==l}),c=(0,t.EW)(()=>i.value.title&&i.value.title.trim().length>0),r=(0,t.EW)(()=>{if(!i.value.start_date||!i.value.end_date)return 0;const e=new Date(i.value.start_date),l=new Date(i.value.end_date);return Math.ceil((l-e)/864e5)+1}),u=e=>{const l=i.value.config.enabledModules.indexOf(e);l>-1?i.value.config.enabledModules.splice(l,1):i.value.config.enabledModules.push(e)},m=async()=>{if(c.value){s.value=!0;try{if(i.value.overview.budget.total=i.value.overview.budget.items.reduce((e,l)=>e+(l.amount||0),0),d.value)await(0,w.q)(e.params.slug,i.value),alert("保存成功！");else{const e=await(0,w.Tn)(i.value);alert("创建成功！"),l.push(`/editor/${e.slug}`)}}catch(a){console.error("保存失败:",a),alert("保存失败："+(a.response?.data?.detail||a.message))}finally{s.value=!1}}else alert("请至少填写标题")},b=async()=>{if(c.value){if(confirm("确定要发布这个旅行计划吗？发布后将可以被其他用户看到。")){o.value=!0;try{if(i.value.status="published",i.value.overview.budget.total=i.value.overview.budget.items.reduce((e,l)=>e+(l.amount||0),0),d.value)await(0,w.q)(e.params.slug,i.value);else{const e=await(0,w.Tn)(i.value);l.push(`/editor/${e.slug}`)}alert("发布成功！")}catch(a){console.error("发布失败:",a),alert("发布失败："+(a.response?.data?.detail||a.message))}finally{o.value=!1}}}else alert("请至少填写标题")},p=()=>{confirm("确定要离开吗？未保存的更改将丢失。")&&l.push("/my-trips")},v=async()=>{const a=e.params.slug;if(a&&"new"!==a)try{const e=await(0,w.Vt)(a);i.value={...i.value,...e,overview:e.overview||i.value.overview,config:e.config||i.value.config}}catch(t){console.error("加载失败:",t),alert("加载旅行计划失败"),l.push("/my-trips")}};return(0,t.sV)(()=>{if(!a.isLoggedIn)return alert("请先登录"),void l.push("/login");v()}),{tripData:i,saving:s,publishing:o,isEditMode:d,canPublish:c,daysCount:r,availableModules:n,toggleModule:u,handleSave:m,handlePublish:b,goBack:p}}};const El=(0,O.A)(Vl,[["render",y],["__scopeId","data-v-9e714c96"]]);var wl=El},7682:function(e,l,a){a.d(l,{Au:function(){return d},Ol:function(){return c},Tn:function(){return n},To:function(){return s},Vt:function(){return o},q:function(){return i}});var t=a(7277);const s=e=>t.A.get("/trip-plans/my_trips/",{params:e}),o=e=>t.A.get(`/trip-plans/${e}/`),n=e=>t.A.post("/trip-plans/",e),i=(e,l)=>t.A.patch(`/trip-plans/${e}/`,l),d=e=>t.A.delete(`/trip-plans/${e}/`),c=e=>t.A.post(`/trip-plans/${e}/add_to_tree/`)}}]);
//# sourceMappingURL=993.e2437ed5.js.map