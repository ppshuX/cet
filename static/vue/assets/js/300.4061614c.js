"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[300],{8300:function(e,a,s){s.r(a),s.d(a,{default:function(){return Y}});var r=s(6768),o=s(4232),t=s(5130);const l={class:"forgot-password-container"},n={class:"container py-5"},i={class:"row justify-content-center"},d={class:"col-md-6 col-lg-5"},c={class:"card shadow"},u={class:"card-body p-5"},v={key:0,class:"alert alert-danger"},p={key:1,class:"alert alert-success"},m={class:"mb-3"},w={class:"input-group"},b=["disabled"],f=["disabled"],k={key:0,class:"spinner-border spinner-border-sm me-1"},_={key:1},y={key:2},g={key:0,class:"text-danger small mt-1"},L={key:1,class:"text-success small mt-1"},C={class:"text-muted mb-4"},h={class:"mb-3"},x={class:"input-group"},E=["disabled"],X=["disabled"],D={key:0,class:"spinner-border spinner-border-sm me-1"},Q={key:1},R={key:2},K={key:0,class:"text-danger small mt-1"},V={key:1,class:"text-success small mt-1"},A={class:"d-flex gap-2"},S={class:"mb-3"},W=["disabled"],M={key:0,class:"text-danger small mt-1"},F={class:"mb-4"},I=["disabled"],J={key:0,class:"text-danger small mt-1"},T=["disabled"],q={key:0,class:"spinner-border spinner-border-sm me-2"},P=["disabled"],U={key:5,class:"text-center"},$={class:"text-center mt-4"};function j(e,a,s,j,z,H){const B=(0,r.g2)("router-link");return(0,r.uX)(),(0,r.CE)("div",l,[(0,r.Lk)("div",n,[(0,r.Lk)("div",i,[(0,r.Lk)("div",d,[(0,r.Lk)("div",c,[(0,r.Lk)("div",u,[a[26]||(a[26]=(0,r.Lk)("h2",{class:"text-center mb-4"},"🔑 找回密码",-1)),j.errorMessage?((0,r.uX)(),(0,r.CE)("div",v,(0,o.v_)(j.errorMessage),1)):(0,r.Q3)("",!0),j.successMessage?((0,r.uX)(),(0,r.CE)("div",p,(0,o.v_)(j.successMessage),1)):(0,r.Q3)("",!0),1===j.step?((0,r.uX)(),(0,r.CE)(r.FK,{key:2},[a[13]||(a[13]=(0,r.Lk)("p",{class:"text-muted mb-4"},"请输入您的注册邮箱，我们将发送验证码到您的邮箱",-1)),(0,r.Lk)("form",{onSubmit:a[2]||(a[2]=(0,t.D$)((...e)=>j.handleSendCode&&j.handleSendCode(...e),["prevent"]))},[(0,r.Lk)("div",m,[a[12]||(a[12]=(0,r.Lk)("label",{for:"email",class:"form-label"},[(0,r.eW)("邮箱地址 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",w,[(0,r.bo)((0,r.Lk)("input",{type:"email",class:"form-control",id:"email","onUpdate:modelValue":a[0]||(a[0]=e=>j.formData.email=e),required:"",disabled:j.submitting||j.sendingCode,placeholder:"请输入注册邮箱"},null,8,b),[[t.Jo,j.formData.email]]),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:!j.formData.email||j.sendingCode||j.countdown>0},[j.sendingCode?((0,r.uX)(),(0,r.CE)("span",k)):j.countdown>0?((0,r.uX)(),(0,r.CE)("span",_,(0,o.v_)(j.countdown)+"s",1)):((0,r.uX)(),(0,r.CE)("span",y,"发送验证码"))],8,f)]),j.errors.email?((0,r.uX)(),(0,r.CE)("div",g,(0,o.v_)(j.errors.email),1)):(0,r.Q3)("",!0),j.codeSent?((0,r.uX)(),(0,r.CE)("div",L," ✅ 验证码已发送到您的邮箱，请查收 ")):(0,r.Q3)("",!0)]),j.codeSent?((0,r.uX)(),(0,r.CE)("button",{key:0,type:"button",class:"btn btn-outline-primary w-100",onClick:a[1]||(a[1]=e=>j.step=2)}," 下一步：验证验证码 ")):(0,r.Q3)("",!0)],32)],64)):(0,r.Q3)("",!0),2===j.step?((0,r.uX)(),(0,r.CE)(r.FK,{key:3},[(0,r.Lk)("p",C,[a[14]||(a[14]=(0,r.eW)("请输入发送到 ",-1)),(0,r.Lk)("strong",null,(0,o.v_)(j.formData.email),1),a[15]||(a[15]=(0,r.eW)(" 的验证码",-1))]),(0,r.Lk)("form",{onSubmit:a[6]||(a[6]=(0,t.D$)((...e)=>j.handleVerifyCode&&j.handleVerifyCode(...e),["prevent"]))},[(0,r.Lk)("div",h,[a[16]||(a[16]=(0,r.Lk)("label",{for:"verification_code",class:"form-label"},[(0,r.eW)("验证码 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.Lk)("div",x,[(0,r.bo)((0,r.Lk)("input",{type:"text",class:"form-control",id:"verification_code","onUpdate:modelValue":a[3]||(a[3]=e=>j.formData.verification_code=e),required:"",disabled:j.submitting||j.verifyingCode||j.codeVerified,placeholder:"请输入6位验证码",maxlength:"6"},null,8,E),[[t.Jo,j.formData.verification_code]]),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary",disabled:!j.formData.verification_code||j.verifyingCode||j.codeVerified},[j.verifyingCode?((0,r.uX)(),(0,r.CE)("span",D)):j.codeVerified?((0,r.uX)(),(0,r.CE)("span",Q,"✓ 已验证")):((0,r.uX)(),(0,r.CE)("span",R,"验证"))],8,X)]),j.errors.verification_code?((0,r.uX)(),(0,r.CE)("div",K,(0,o.v_)(j.errors.verification_code),1)):(0,r.Q3)("",!0),j.codeVerified?((0,r.uX)(),(0,r.CE)("div",V," ✅ 验证成功！ ")):(0,r.Q3)("",!0)]),(0,r.Lk)("div",A,[(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary",onClick:a[4]||(a[4]=e=>j.step=1)}," 返回上一步 "),j.codeVerified?((0,r.uX)(),(0,r.CE)("button",{key:0,type:"button",class:"btn btn-primary flex-grow-1",onClick:a[5]||(a[5]=e=>j.step=3)}," 下一步：设置新密码 ")):(0,r.Q3)("",!0)])],32)],64)):(0,r.Q3)("",!0),3===j.step?((0,r.uX)(),(0,r.CE)(r.FK,{key:4},[a[20]||(a[20]=(0,r.Lk)("p",{class:"text-muted mb-4"},"请设置您的新密码",-1)),(0,r.Lk)("form",{onSubmit:a[10]||(a[10]=(0,t.D$)((...e)=>j.handleResetPassword&&j.handleResetPassword(...e),["prevent"]))},[(0,r.Lk)("div",S,[a[17]||(a[17]=(0,r.Lk)("label",{for:"new_password",class:"form-label"},[(0,r.eW)("新密码 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"new_password","onUpdate:modelValue":a[7]||(a[7]=e=>j.formData.new_password=e),required:"",disabled:j.submitting,placeholder:"请输入新密码（至少8位）",minlength:"8"},null,8,W),[[t.Jo,j.formData.new_password]]),j.errors.new_password?((0,r.uX)(),(0,r.CE)("div",M,(0,o.v_)(j.errors.new_password),1)):(0,r.Q3)("",!0),a[18]||(a[18]=(0,r.Lk)("small",{class:"text-muted"},"密码至少8位，建议包含字母和数字",-1))]),(0,r.Lk)("div",F,[a[19]||(a[19]=(0,r.Lk)("label",{for:"new_password2",class:"form-label"},[(0,r.eW)("确认新密码 "),(0,r.Lk)("span",{class:"text-danger"},"*")],-1)),(0,r.bo)((0,r.Lk)("input",{type:"password",class:"form-control",id:"new_password2","onUpdate:modelValue":a[8]||(a[8]=e=>j.formData.new_password2=e),required:"",disabled:j.submitting,placeholder:"请再次输入新密码",minlength:"8"},null,8,I),[[t.Jo,j.formData.new_password2]]),j.errors.new_password2?((0,r.uX)(),(0,r.CE)("div",J,(0,o.v_)(j.errors.new_password2),1)):(0,r.Q3)("",!0)]),(0,r.Lk)("button",{type:"submit",class:"btn btn-primary w-100 mb-3",disabled:j.submitting},[j.submitting?((0,r.uX)(),(0,r.CE)("span",q)):(0,r.Q3)("",!0),(0,r.eW)(" "+(0,o.v_)(j.submitting?"重置中...":"重置密码"),1)],8,T),(0,r.Lk)("button",{type:"button",class:"btn btn-outline-secondary w-100",onClick:a[9]||(a[9]=e=>j.step=2),disabled:j.submitting}," 返回上一步 ",8,P)],32)],64)):(0,r.Q3)("",!0),4===j.step?((0,r.uX)(),(0,r.CE)("div",U,[a[21]||(a[21]=(0,r.Lk)("div",{class:"mb-4"},[(0,r.Lk)("i",{class:"bi bi-check-circle-fill text-success",style:{"font-size":"4rem"}})],-1)),a[22]||(a[22]=(0,r.Lk)("h3",{class:"mb-3"},"密码重置成功！",-1)),a[23]||(a[23]=(0,r.Lk)("p",{class:"text-muted mb-4"},"您可以使用新密码登录了",-1)),(0,r.Lk)("button",{type:"button",class:"btn btn-primary w-100",onClick:a[11]||(a[11]=(...e)=>j.goToLogin&&j.goToLogin(...e))}," 前往登录 ")])):(0,r.Q3)("",!0),(0,r.Lk)("div",$,[a[25]||(a[25]=(0,r.Lk)("span",{class:"text-muted"},"想起密码了？",-1)),(0,r.bF)(B,{to:"/login/",class:"text-decoration-none ms-1"},{default:(0,r.k6)(()=>[...a[24]||(a[24]=[(0,r.eW)(" 返回登录 ",-1)])]),_:1})])])])])])])])}s(4114);var z=s(144),H=s(8512),B=s(2636),G={name:"ForgotPasswordView",setup(){const e=(0,H.rd)(),a=(0,z.KR)(1),s=(0,z.KR)({email:"",verification_code:"",verification_token:"",new_password:"",new_password2:""}),o=(0,z.KR)({}),t=(0,z.KR)(""),l=(0,z.KR)(""),n=(0,z.KR)(!1),i=(0,z.KR)(!1),d=(0,z.KR)(!1),c=(0,z.KR)(!1),u=(0,z.KR)(!1),v=(0,z.KR)(0);let p=null;const m=async()=>{if(o.value={},t.value="",!s.value.email)return void(o.value.email="请先输入邮箱");const e=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;if(e.test(s.value.email)){i.value=!0;try{await(0,B.J2)({email:s.value.email,type:"reset_password"}),c.value=!0,v.value=60,f(),l.value="验证码已发送到您的邮箱",setTimeout(()=>{l.value=""},3e3)}catch(a){if(console.error("发送验证码失败:",a),a.response?.data){const e=a.response.data;e.error?t.value=e.error:e.email?o.value.email=Array.isArray(e.email)?e.email[0]:e.email:t.value="发送验证码失败，请稍后重试"}else t.value="网络错误，请检查网络连接"}finally{i.value=!1}}else o.value.email="请输入有效的邮箱地址"},w=async()=>{if(o.value={},t.value="",s.value.verification_code)if(6===s.value.verification_code.length){d.value=!0;try{const e=await(0,B.HR)({email:s.value.email,code:s.value.verification_code,type:"reset_password"});e.success&&e.verification_token?(s.value.verification_token=e.verification_token,u.value=!0,l.value="验证成功！",setTimeout(()=>{a.value=3},1e3)):o.value.verification_code="验证失败，请检查验证码"}catch(e){if(console.error("验证码验证失败:",e),e.response?.data){const a=e.response.data;a.error?o.value.verification_code=a.error:a.code?o.value.verification_code=Array.isArray(a.code)?a.code[0]:a.code:o.value.verification_code="验证码无效或已过期"}else o.value.verification_code="验证失败，请稍后重试"}finally{d.value=!1}}else o.value.verification_code="验证码为6位数字";else o.value.verification_code="请输入验证码"},b=async()=>{if(o.value={},t.value="",s.value.new_password)if(s.value.new_password.length<8)o.value.new_password="密码长度至少为8位";else if(s.value.new_password===s.value.new_password2){n.value=!0;try{await(0,B.xw)({email:s.value.email,verification_token:s.value.verification_token,new_password:s.value.new_password,new_password2:s.value.new_password2}),a.value=4}catch(e){if(console.error("重置密码失败:",e),e.response?.data){const a=e.response.data;a.new_password&&(o.value.new_password=Array.isArray(a.new_password)?a.new_password[0]:a.new_password),a.new_password2&&(o.value.new_password2=Array.isArray(a.new_password2)?a.new_password2[0]:a.new_password2),a.verification_token&&(t.value="验证token无效，请重新验证邮箱"),a.error&&(t.value=a.error),t.value||o.value.new_password||o.value.new_password2||(t.value="重置密码失败，请稍后重试")}else t.value="网络错误，请检查网络连接"}finally{n.value=!1}}else o.value.new_password2="两次输入的密码不一致";else o.value.new_password="请输入新密码"},f=()=>{p&&clearInterval(p),p=setInterval(()=>{v.value>0?v.value--:(clearInterval(p),p=null)},1e3)},k=()=>{e.push("/login/")};return(0,r.hi)(()=>{p&&clearInterval(p)}),{step:a,formData:s,errors:o,errorMessage:t,successMessage:l,submitting:n,sendingCode:i,verifyingCode:d,codeSent:c,codeVerified:u,countdown:v,handleSendCode:m,handleVerifyCode:w,handleResetPassword:b,goToLogin:k}}},N=s(1241);const O=(0,N.A)(G,[["render",j],["__scopeId","data-v-df6b74f0"]]);var Y=O}}]);
//# sourceMappingURL=300.4061614c.js.map