"use strict";(self["webpackChunkroamio_web"]=self["webpackChunkroamio_web"]||[]).push([[105],{5105:function(e,s,t){t.r(s),t.d(s,{default:function(){return _}});var r=t(6768),a=t(4232);const o={class:"qq-callback-container"},n={class:"loading-spinner"},i={class:"mt-3"};function c(e,s,t,c,u,l){return(0,r.uX)(),(0,r.CE)("div",o,[(0,r.Lk)("div",n,[s[0]||(s[0]=(0,r.Lk)("div",{class:"spinner-border text-primary",role:"status"},[(0,r.Lk)("span",{class:"visually-hidden"},"处理中...")],-1)),(0,r.Lk)("p",i,(0,a.v_)(c.message),1)])])}t(4114);var u=t(144),l=t(8512),d=t(3459),m=t(2636),p={name:"QQCallbackView",setup(){const e=(0,l.rd)(),s=(0,l.lq)(),t=(0,d.k)(),a=(0,u.KR)("正在处理QQ登录...");return(0,r.sV)(async()=>{try{const r=s.query.code,o=s.query.state;if(!r||!o)return a.value="缺少必要的参数，请重新登录",void setTimeout(()=>{e.push("/login/")},2e3);a.value="正在验证QQ登录信息...";const n=await(0,m.UB)({code:r,state:o});n.success&&n.access?(t.token=n.access,t.refreshToken=n.refresh,t.userInfo=n.user,localStorage.setItem("access_token",n.access),localStorage.setItem("refresh_token",n.refresh),localStorage.setItem("user_info",JSON.stringify(n.user)),a.value="登录成功！正在跳转...",setTimeout(()=>{e.push("/")},1e3)):n.need_bind_email?(a.value="首次QQ登录，需要绑定邮箱",sessionStorage.setItem("qq_bind_info",JSON.stringify({qq_info:n.qq_info,temp_token:n.temp_token})),setTimeout(()=>{e.push({path:"/register/",query:{qq_bind:"true",code:r,state:o}})},1500)):(a.value=n.error||"QQ登录失败，请重试",setTimeout(()=>{e.push("/login/")},2e3))}catch(r){console.error("QQ登录处理失败:",r),a.value=r.response?.data?.error||r.message||"QQ登录失败，请重试",setTimeout(()=>{e.push("/login/")},2e3)}}),{message:a}}},f=t(1241);const k=(0,f.A)(p,[["render",c],["__scopeId","data-v-493eba71"]]);var _=k}}]);
//# sourceMappingURL=105.d647ecc1.js.map