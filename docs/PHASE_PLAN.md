# 📅 旅行平台开发阶段计划

> **产品愿景**：打造智能化、个性化的旅行规划平台，让每个人都能轻松设计和分享自己的旅行计划

---

## 🎯 阶段一：基础编辑器（已完成 ✅）

### 目标
让用户能在前端创建、编辑、保存和发布旅行计划

### 已实现功能

#### ✅ 1.1 基本信息编辑
- [x] 旅行标题输入
- [x] 开始/结束日期选择
- [x] 图标选择器（🏖️🌊🏙️🌄等）
- [x] 主题颜色设置
- [x] 简介描述
- [x] 旅行封面图片

#### 1.2 模块选择器（1周）
- [x] 勾选启用/禁用模块：
  - [x] 基本信息（出发地、目的地、交通方式等）
  - [x] 行程亮点（景点、活动列表）
  - [x] 详细行程（每日安排）
  - [x] 预算参考（费用明细表）
  - [x] 实用提示（注意事项）
  - [x] 旅行进度条（日期进度）
- [x] 实时预览模块显示效果

#### 1.3 内容编辑器（1.5周）
- [x] **基本信息编辑**
  - 旅行人员、出发地、目的地
  - 交通方式、住宿、行程时长、预算
  
- [x] **行程亮点编辑**
  - 添加/删除亮点项
  - 拖拽排序
  - Emoji + 文字描述

- [x] **详细行程编辑**
  - 添加/删除日程项
  - 每项包含：日期、时间、内容、亮点
  - 支持富文本（粗体、列表等）

- [x] **预算编辑**
  - 添加/删除预算项
  - 项目名称、金额、备注
  - 自动计算总计

- [x] **实用提示编辑**
  - 添加/删除提示
  - 支持多行文本

#### 1.4 保存与发布（0.5周）

- [x] 手动保存按钮
- [x] 隐私设置：
  - 私有（仅自己可见）
  - 公开（所有人可见）
- [x] 发布按钮
- [x] 实时预览
- [x] 运用到旅行树功能（仅管理员）

### 技术任务
- [x] 创建 `TripEditorView.vue` 页面
- [x] 创建子组件：
  - `ModuleSelector.vue` - 模块选择器
  - `BasicInfoEditor.vue` - 基本信息编辑
  - `ContentEditor.vue` - 内容编辑（亮点、行程、预算、提示）
  - `EditorSidebar.vue` - 编辑器侧边栏
- [x] 后端：扩展 `Trip` 模型
  - [x] 添加 `status` 字段（draft/published）
  - [x] 添加 `visibility` 字段（private/public）
  - [x] 添加 `config` JSON字段（存储enabledModules）
  - [x] 添加 `overview` JSON字段（存储内容）
  - [x] 添加 `theme_color` 字段
  - [x] 添加 `background_music` 字段
- [x] API接口：
  - [x] `POST /api/v1/trip-plans/` - 创建旅行
  - [x] `PATCH /api/v1/trip-plans/{slug}/` - 更新旅行
  - [x] `GET /api/v1/trip-plans/my-trips/` - 我的旅行列表
  - [x] `GET /api/v1/trip-plans/{slug}/` - 获取旅行详情
  - [x] `POST /api/v1/trip-plans/{slug}/clone/` - 复制旅行
- [x] 前端路由：
  - [x] `/editor/new` - 创建新旅行
  - [x] `/editor/:slug` - 编辑旅行
  - [x] `/my-trips` - 我的旅行列表
- [x] 技术改进：
  - [x] 用fetch替换axios，简化请求封装
  - [x] 支持新旧Trip模型API兼容
  - [x] 组件化编辑器，避免冗长代码

### 验收标准
✅ 用户可以从零开始创建一个完整的旅行计划  
✅ 可以选择启用/禁用不同模块  
✅ 所有内容可编辑、保存、预览  
✅ 可设置私有/公开  
✅ 发布后在旅行列表中显示

---

## 🎯 阶段二：模板市场（2周）

### 目标
提供官方模板和用户分享的旅行计划，快速开始

### 功能清单

#### 2.1 官方模板库（1周）
- [ ] 预设5-10个官方模板：
  - 周末城市游（2天1夜）
  - 小长假度假（3天2夜）
  - 一周深度游（7天6夜）
  - 海滨度假模板
  - 文化探索模板
- [ ] 模板详情页
- [ ] "使用此模板"按钮 → 复制到我的旅行

#### 2.2 旅行广场（1周）
- [ ] 展示所有公开的旅行计划
- [ ] 筛选功能：
  - 按天数（1天/2-3天/4-7天/7天以上）
  - 按预算（500/1000/2000/2000+）
  - 按类型（城市游/自然风光/海滨/文化）
- [ ] 排序：最新/最热/最受欢迎
- [ ] 搜索：关键词搜索
- [ ] 卡片展示：标题、封面图、天数、预算、浏览量、点赞数

### 技术任务
- [ ] 创建 `TripMarketplaceView.vue` 页面
- [ ] 创建 `TemplateCard.vue` 组件
- [ ] 后端：
  - `GET /api/v1/templates/` - 官方模板列表
  - `GET /api/v1/trips/public/` - 公开旅行列表（带筛选）
  - `POST /api/v1/trips/{id}/clone/` - 复制旅行
- [ ] 数据库：初始化官方模板数据

### 验收标准
✅ 用户可以浏览官方模板  
✅ 用户可以一键使用模板创建旅行  
✅ 用户可以浏览其他人公开的旅行计划  
✅ 筛选和搜索功能正常工作

---

## 🎯 阶段三：AI智能助手（4-6周）

### 目标
用AI帮助用户规划旅行，提供智能推荐

### 功能清单

#### 3.1 AI推荐目的地（1.5周）
- [ ] 用户输入表单：
  - 出发地
  - 预算范围
  - 天数
  - 偏好（自然/城市/海滨/文化/美食/购物）
- [ ] AI分析并推荐3-5个目的地
- [ ] 每个推荐包含：
  - 目的地名称
  - 匹配度评分
  - 推荐理由
  - 预估预算
  - 最佳季节

#### 3.2 AI生成行程（2周）
- [ ] 用户选择目的地+天数+兴趣点
- [ ] AI自动生成：
  - 每日详细行程
  - 时间安排
  - 景点推荐
  - 餐饮建议
  - 交通方式
- [ ] 生成后可手动调整
- [ ] "一键导入编辑器"功能

#### 3.3 智能预算计算（1周）
- [ ] 根据目的地+天数+类型自动估算：
  - 交通费用
  - 住宿费用
  - 餐饮费用
  - 门票费用
  - 其他费用
- [ ] 提供预算区间（最低/推荐/舒适）

#### 3.4 实时优化建议（1周）
- [ ] 检测行程问题：
  - 时间安排过紧
  - 景点距离太远
  - 预算超支
- [ ] 提供优化建议：
  - 调整顺序
  - 减少景点
  - 省钱tips

### 技术任务
- [ ] 创建 `AiAssistantView.vue` 页面
- [ ] 接入AI服务：
  - 方案A：OpenAI API（推荐）
  - 方案B：国内大模型（通义千问/文心一言）
- [ ] 后端接口：
  - `POST /api/v1/ai/recommend-destination/` - 推荐目的地
  - `POST /api/v1/ai/generate-itinerary/` - 生成行程
  - `POST /api/v1/ai/estimate-budget/` - 预算估算
  - `POST /api/v1/ai/optimize-trip/` - 优化建议
- [ ] Prompt工程：设计高质量提示词

### 验收标准
✅ 用户输入需求，AI能推荐合适的目的地  
✅ AI能生成合理的每日行程  
✅ 预算估算基本准确  
✅ 优化建议有实际价值

---

## 🎯 阶段四：社区与生态（持续）

### 目标
构建旅行社区，增强用户互动和粘性

### 功能清单（分批实施）

#### 4.1 基础社交（2周）
- [ ] 用户关注/粉丝系统
- [ ] 旅行计划点赞
- [ ] 旅行计划收藏
- [ ] 评论功能（增强现有）
- [ ] 通知系统（有人点赞/评论/关注）

#### 4.2 标签与分类（1周）
- [ ] 旅行标签（#海滨游 #美食游 #穷游）
- [ ] 标签搜索
- [ ] 热门标签排行

#### 4.3 排行榜与推荐（1周）
- [ ] 热门旅行排行榜（周榜/月榜）
- [ ] 推荐算法（基于浏览历史）
- [ ] 首页个性化推荐

#### 4.4 实际打卡（2周）
- [ ] 用户实际去旅行后，可以在原计划上打卡
- [ ] 上传实拍照片
- [ ] 写实际体验（对比计划与实际）
- [ ] 显示"XX人实际去过"

#### 4.5 旅行足迹（1周）
- [ ] 个人旅行地图
- [ ] 标注去过的城市/国家
- [ ] 统计旅行数据（总天数、总花费等）

#### 4.6 话题讨论（2周）
- [ ] 旅行圈子（海滨游圈/穷游圈等）
- [ ] 话题讨论区
- [ ] 用户发帖、回复

### 验收标准
✅ 用户可以关注其他用户  
✅ 可以点赞、收藏、评论旅行计划  
✅ 有热门排行榜  
✅ 可以打卡分享实际旅行  
✅ 有活跃的社区讨论

---

## 💰 阶段五：商业化（6个月后）

### 5.1 会员系统
- [ ] 基础免费版（限制3个旅行）
- [ ] 高级会员（¥9.9/月）：
  - 无限旅行
  - AI功能增强
  - 高级模板
  - 数据导出PDF
  - 去广告

### 5.2 B端服务
- [ ] 旅行社版本
- [ ] 企业定制
- [ ] API服务

### 5.3 佣金分成
- [ ] 酒店预订链接
- [ ] 景点门票链接
- [ ] 旅游保险推荐

---

## 📊 开发时间轴

### 第1-4周：阶段一（编辑器）
- Week 1: 基本信息 + 模块选择器
- Week 2: 内容编辑组件（亮点、行程）
- Week 3: 内容编辑组件（预算、提示）+ 后端扩展
- Week 4: 保存/发布功能 + 测试优化

### 第5-6周：阶段二（模板市场）
- Week 5: 官方模板库 + 模板数据
- Week 6: 旅行广场 + 筛选搜索

### 第7-12周：阶段三（AI助手）
- Week 7-8: AI推荐目的地
- Week 9-10: AI生成行程
- Week 11: 智能预算计算
- Week 12: 优化建议 + 整合测试

### 第13周+：阶段四（社区）
- 根据用户反馈持续迭代

---

## 🎯 里程碑目标

### 1个月后（MVP）
- ✅ 编辑器上线
- ✅ 可创建、编辑、发布旅行计划
- ✅ 至少10个用户使用

### 2个月后（模板市场）
- ✅ 模板系统上线
- ✅ 旅行广场上线
- ✅ 至少50个公开旅行计划

### 3个月后（AI功能）
- ✅ AI推荐和生成功能上线
- ✅ 至少100个活跃用户
- ✅ 用户反馈良好

### 6个月后（社区生态）
- ✅ 社区功能完善
- ✅ 至少500个注册用户
- ✅ 考虑商业化

---

## 🚀 本周行动计划（启动阶段一）

### Day 1-2：设计与准备
- [x] 阅读产品路线图
- [x] 设计编辑器UI草图
- [x] 确定数据结构

### Day 3-4：前端骨架
- [x] 创建 `TripEditorView.vue`
- [x] 创建 `ModuleSelector.vue`
- [x] 实现基本布局和路由

### Day 5-7：后端扩展
- [x] 扩展 `Trip` 模型（添加新字段）
- [x] 迁移数据库
- [x] 创建相关API接口
- [x] 测试接口

### 已完成（Week 1-2 进度更新）
- [x] 创建完整的Trip模型（含status, visibility, config, overview等字段）
- [x] 实现TripPlanViewSet（支持CRUD、my_trips、clone操作）
- [x] 完成前端编辑器页面布局
- [x] 实现所有内容编辑组件（基本信息、亮点、行程、预算、提示）
- [x] 实现模块选择和预览功能
- [x] 实现保存和发布功能
- [x] 优化代码结构，使用组件化避免冗长
- [x] 改进请求封装，用fetch替换axios
- [x] 实现API兼容性（新旧Trip模型共存）
- [x] 添加导航栏、隐藏API文档链接

---

## 📝 关键决策

### ✅ 已确定
1. 使用现有架构（Django + Vue）
2. 配置驱动的内容存储（JSON字段）
3. 组件化编辑器设计（避免冗长代码）
4. 模块可选的灵活性
5. 使用原生fetch替换axios
6. 支持新旧Trip模型API兼容
7. 图片和视频压缩策略（图片1920px，质量85）

### ⏳ 待讨论
1. AI服务选型（OpenAI vs 国内大模型）
2. 富文本编辑器选择（Quill vs TipTap）
3. 图片上传和管理方案
4. 初期是否需要移动端适配
5. 草稿自动保存策略

## 🎉 已完成功能
1. ✅ 完整的编辑器UI和布局
2. ✅ 所有内容编辑组件（基本信息、亮点、行程、预算、提示）
3. ✅ 模块选择和预览功能
4. ✅ 保存和发布功能
5. ✅ 我的旅行列表页面
6. ✅ 新旧API兼容
7. ✅ 代码优化和重构

---

## 💡 成功关键

1. **快速迭代** - 不追求完美，先上线后优化
2. **用户反馈** - 每个阶段都要收集真实用户意见
3. **数据积累** - 为AI训练积累高质量数据
4. **社区运营** - 早期种子用户很重要
5. **技术债控制** - 保持代码质量，方便后续扩展

---

**当前状态**：✨ 阶段一基本完成，可以开始阶段二（模板市场）

**已完成**：
- ✅ 编辑器核心功能
- ✅ 后端Trip模型和API
- ✅ 前端组件化和代码优化
- ✅ API兼容性处理

**下一步**：开始阶段二 - 模板市场
1. 设计模板数据结构
2. 创建官方模板数据
3. 实现模板市场页面
4. 添加复制/克隆功能

继续推进第二阶段！🚀

---

## 🔧 最新完成的工作（2025年10月）

### 代码架构优化
- ✅ **viewsets 重构**：将605行的 `viewsets.py` 拆分为5个独立模块
  - `auth_viewset.py` - 认证相关
  - `user_viewset.py` - 用户管理
  - `comment_viewset.py` - 评论管理
  - `trip_viewset.py` - 旅行页面
  - `trip_plan_viewset.py` - 旅行计划管理
  - 提升代码可维护性和清晰度

### UserProfile 扩展
- ✅ **新增字段**：
  - `bio` - 个人简介（最多500字）
  - `tags` - 个人标签（逗号分隔，最多10个，每个最多20字）
  - `visited_countries` - 访问过的国家
  - `level` - 用户等级（新手/探索者/漫游者/冒险家/旅行大师）
- ✅ **自动计算等级**：
  - 根据旅行数量和评论数量自动计算
  - 访问个人中心时自动更新等级
- ✅ **个人中心页面**：
  - 基本信息编辑（用户名、邮箱）
  - 旅行者资料编辑（简介、标签、访问国家）
  - 统计信息展示
  - 精美的UI设计

### 错误信息中文化
- ✅ **登录/注册错误**：所有错误信息改为中文提示
- ✅ **前端错误处理**：优化错误信息显示逻辑
- ✅ **后端验证**：完整的字段验证和中文错误消息

### 旅行数据完善
- ✅ **数据迁移**：为所有旅行补充完整数据
  - 厦门三天两晚游
  - 三岔河一日游
  - 曲靖二日游
  - 昆明旅行
  - 长沙三天两夜慢旅行
- ✅ **数据结构优化**：统一前端模板数据结构
- ✅ **预算修复**：修正并统一预算字段

### 功能增强
- ✅ **自动计算等级**：访问个人中心时自动计算并更新用户等级
- ✅ **前端UI改进**：内容区域使用卡片布局，更清晰美观
- ✅ **代码兼容性**：移除旧用户兼容代码，简化逻辑

